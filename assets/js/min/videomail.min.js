var VideomailClient=require("videomail-client"),VideomailFieldController=Marionette.Object.extend({initialize:function(){this.listenTo(Backbone.Radio.channel("videomail"),"init:model",this.register),Backbone.Radio.channel("videomail").reply("get:submitData",this.getSubmitData),Backbone.Radio.channel("videomail").reply("validate:required",this.validateRequired)},register:function(e){var i=this,t="form-"+e.get("formID");this.videomailClient=new VideomailClient({siteName:e.get("site_name"),video:{limitSeconds:e.get("limit_seconds")||80,width:e.get("width")||320,countdown:e.get("countdown")||!1},audio:{enabled:e.get("audio_enabled")||!1},verbose:e.get("verbose")||!1}),this.videomailClient.on(this.videomailClient.events.COUNTDOWN,function(){i.disableSubmit(t)}),this.videomailClient.on(this.videomailClient.events.RECORDING,function(){i.disableSubmit(t)}),this.videomailClient.on(this.videomailClient.events.SUBMITTED,function(a){e.set("value",a.url),e.set("videomail-url",a.url),e.set("videomail-webm",a.webm),e.set("videomail-mp4",a.mp4),e.set("videomail-poster",a.poster),e.set("videomail-alias",a.alias),e.set("videomail-key",a.key),i.enableSubmit(t)}),this.videomailClient.show()},enableSubmit:function(e){Backbone.Radio.channel(e).trigger("enable:submit")},disableSubmit:function(e){Backbone.Radio.channel(e).trigger("disable:submit")},validateRequired:function(){return!0},getSubmitData:function(e,i){return e.value=i.get("videomail-url"),e.url=i.get("videomail-url"),e.webm=i.get("videomail-webm"),e.mp4=i.get("videomail-mp4"),e.poster=i.get("videomail-poster"),e.alias=i.get("videomail-alias"),e.key=i.get("videomail-key"),e},onBeforeDestroy:function(){this.videomailClient.unload()}});jQuery(document).ready(function(){new VideomailFieldController});