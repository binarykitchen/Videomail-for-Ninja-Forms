var VideomailClient=require("videomail-client"),DEBUG=!1,VideomailFieldController=Marionette.Object.extend({formId:null,submitButtonId:null,videomailClient:null,fieldModel:null,initialize:function(){Backbone.Radio.DEBUG=DEBUG;var i=Backbone.Radio.channel("submit"),e=Backbone.Radio.channel("videomail");this.listenTo(i,"init:model",this.registerSubmit),this.listenTo(e,"init:model",this.registerVideomailClient),e.reply("get:submitData",this.getSubmitData.bind(this)),e.reply("validate:modelData",this.validateModelData.bind(this)),e.reply("validate:required",this.validateRequired.bind(this))},registerVideomailClient:function(i){this.fieldModel=i},registerSubmit:function(i){this.formID="form-"+i.get("formID"),this.submitButtonId="nf-field-"+i.get("id"),this.fieldModel?this.loadVideomailClient():console.error("Videomail field has not been initialized.")},getOption:function(i,e){return this.fieldModel.get(i)||e},loadVideomailClient:function(){this.videomailClient=new VideomailClient({siteName:this.getOption("site_name"),video:{limitSeconds:this.getOption("limit_seconds",80),width:this.getOption("width",320),countdown:this.getOption("countdown",!1)},selectors:{submitButtonId:this.submitButtonId},audio:{enabled:this.getOption("audio_enabled",!1)},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePosting},defaults:{to:null},verbose:this.getOption("verbose",DEBUG)}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.setVideomailKey.bind(this)),this.videomailClient.show()},setVideomailKey:function(i){this.fieldModel.set("videomail-key",i)},validateModelData:function(){var i=this.fieldModel.get("videomail-key");return!!i},getVideomailFieldName:function(i){return this.fieldModel.get(i)},adjustFormDataBeforePosting:function(i,e){this.getVideomailFieldName("email_from"),this.getVideomailFieldName("email_to"),this.getVideomailFieldName("email_subject"),this.getVideomailFieldName("email_body");e(null,i)},validateRequired:function(){return!0},getSubmitData:function(i,e){return i.value=e.get("videomail-key"),i.key=e.get("videomail-key"),i.url=e.get("videomail-url"),i.webm=e.get("videomail-webm"),i.mp4=e.get("videomail-mp4"),i.poster=e.get("videomail-poster"),i.alias=e.get("videomail-alias"),i},onBeforeDestroy:function(){this.videomailClient.unload()}});jQuery(document).ready(function(){new VideomailFieldController});