var VideomailClient=require("videomail-client"),VideomailFieldController=Marionette.Object.extend({initialize:function(){this.listenTo(Backbone.Radio.channel("videomail"),"init:model",this.register),Backbone.Radio.channel("videomail").reply("get:submitData",this.getSubmitData),Backbone.Radio.channel("videomail").reply("validate:required",this.validateRequired)},register:function(e){var i=this,t="form-"+e.get("formID"),l=function(i){return e.get(i)},o=function(e,i){l("email_from"),l("email_to"),l("email_subject"),l("email_body");i(null,e)};this.videomailClient=new VideomailClient({siteName:e.get("site_name"),video:{limitSeconds:e.get("limit_seconds")||80,width:e.get("width")||320,countdown:e.get("countdown")||!1},selectors:{submitButtonId:null},audio:{enabled:e.get("audio_enabled")||!1},callbacks:{adjustFormDataBeforePosting:o},defaults:{from:null},verbose:e.get("verbose")||!1}),this.videomailClient.on(this.videomailClient.events.COUNTDOWN,function(){i.disableSubmit("form-"+t)}),this.videomailClient.on(this.videomailClient.events.RECORDING,function(){i.disableSubmit("form-"+t)}),this.videomailClient.on(this.videomailClient.events.SUBMITTED,function(l){e.set("value",l.url),e.set("videomail-url",l.url),e.set("videomail-webm",l.webm),e.set("videomail-mp4",l.mp4),e.set("videomail-poster",l.poster),e.set("videomail-alias",l.alias),e.set("videomail-key",l.key),i.enableSubmit(t)}),this.videomailClient.show()},enableSubmit:function(e){Backbone.Radio.channel(e).trigger("enable:submit")},disableSubmit:function(e){Backbone.Radio.channel(e).trigger("disable:submit")},validateRequired:function(){return!0},getSubmitData:function(e,i){return e.value=i.get("videomail-url"),e.url=i.get("videomail-url"),e.webm=i.get("videomail-webm"),e.mp4=i.get("videomail-mp4"),e.poster=i.get("videomail-poster"),e.alias=i.get("videomail-alias"),e.key=i.get("videomail-key"),e},onBeforeDestroy:function(){this.videomailClient.unload()}});jQuery(document).ready(function(){new VideomailFieldController});