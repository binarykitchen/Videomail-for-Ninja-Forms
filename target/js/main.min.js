var DEBUG=!0,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,channel:nfRadio.channel("videomail"),initialize:function(){nfRadio.DEBUG=DEBUG,this.listenTo(nfRadio.channel("global"),"all",function(e){console.log("Global event triggered:",e),this.listenTo(this.channel,"init:model",this.registerVideomailField)}),this.listenTo(nfRadio.channel("app"),"all",function(e){console.log("App event triggered:",e),this.listenTo(this.channel,"init:model",this.registerVideomailField)}),this.listenTo(nfRadio.channel("form"),"all",function(e){console.log("Form event triggered:",e),this.listenTo(this.channel,"init:model",this.registerVideomailField)}),this.listenTo(nfRadio.channel("forms"),"all",function(e){console.log("Forms event triggered:",e),this.listenTo(this.channel,"init:model",this.registerVideomailField)}),this.listenTo(this.channel,"all",function(e,i){console.log("Videomail event triggered:",e,i),this.listenTo(this.channel,"init:model",this.registerVideomailField)})},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(console.log("registerVideomailField!",e),this.fieldModel=e,this.loadVideomailClient(),this.channel.reply("validate:required",this.validateRequired,this),this.channel.reply("validate:modelData",this.validateVideomail,this),nfRadio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1),this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:this.fieldModel.get("verbose")||DEBUG}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),nfRadio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=nfRadio.channel("app").request("get:form",this.getFormId());nfRadio.channel("form-"+i.get("id")).request("add:extra","videomail",e),nfRadio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){i=this.validateVideomail(i);return i||this.invalidate(),i},invalidate:function(){nfRadio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),l=this.validateVideomail(),e=this.hasErrors(e);return t||e||!l||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t=this.fieldModel.get(e);return t&&("{wp:admin_email}"===t?t=window.nfVideomail.admin_email:(e=(e=t.match(/{field:(.*)}/i))&&e[1])!==t&&(t=t.replace(/{field:(.*)}/i,i[e]))),t},getFormValues:function(){return nfRadio.channel("app").request("get:form",this.getFormId()).get("fields").reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSB0cnVlXG5cbi8vIGdvb2QgZG9jdW1lbnRhdGlvbiBvbiBiYWNrYm9uZSBldmVudCBoYW5kbGluZ1xuLy8gaHR0cDovL2JhY2tib25lanMub3JnLyNFdmVudHNcblxudmFyIFZpZGVvbWFpbEZpZWxkQ29udHJvbGxlciA9IE1hcmlvbmV0dGUuT2JqZWN0LmV4dGVuZCh7XG4gIHZpZGVvbWFpbENsaWVudDogbnVsbCxcblxuICAvLyBub3Qgc3VyZSBpZiB0aGlzIGlzIGEgZ29vZCBpZGVhLCBidXQgaSBuZWVkIGEgcmVmZXJlbmNlIHRvIGl0XG4gIGZpZWxkTW9kZWw6IG51bGwsXG5cbiAgY2hhbm5lbDogbmZSYWRpby5jaGFubmVsKCd2aWRlb21haWwnKSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgbmZSYWRpby5ERUJVRyA9IERFQlVHXG5cbiAgICB0aGlzLmxpc3RlblRvKG5mUmFkaW8uY2hhbm5lbCgnZ2xvYmFsJyksICdhbGwnLCBmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBjb25zb2xlLmxvZygnR2xvYmFsIGV2ZW50IHRyaWdnZXJlZDonLCBldmVudE5hbWUpXG5cbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5jaGFubmVsLCAnaW5pdDptb2RlbCcsIHRoaXMucmVnaXN0ZXJWaWRlb21haWxGaWVsZClcbiAgICB9KVxuXG4gICAgdGhpcy5saXN0ZW5UbyhuZlJhZGlvLmNoYW5uZWwoJ2FwcCcpLCAnYWxsJywgZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgY29uc29sZS5sb2coJ0FwcCBldmVudCB0cmlnZ2VyZWQ6JywgZXZlbnROYW1lKVxuXG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2luaXQ6bW9kZWwnLCB0aGlzLnJlZ2lzdGVyVmlkZW9tYWlsRmllbGQpXG4gICAgfSlcblxuICAgIHRoaXMubGlzdGVuVG8obmZSYWRpby5jaGFubmVsKCdmb3JtJyksICdhbGwnLCBmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBjb25zb2xlLmxvZygnRm9ybSBldmVudCB0cmlnZ2VyZWQ6JywgZXZlbnROYW1lKVxuXG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2luaXQ6bW9kZWwnLCB0aGlzLnJlZ2lzdGVyVmlkZW9tYWlsRmllbGQpXG4gICAgfSlcblxuICAgIHRoaXMubGlzdGVuVG8obmZSYWRpby5jaGFubmVsKCdmb3JtcycpLCAnYWxsJywgZnVuY3Rpb24gKGV2ZW50TmFtZSkge1xuICAgICAgY29uc29sZS5sb2coJ0Zvcm1zIGV2ZW50IHRyaWdnZXJlZDonLCBldmVudE5hbWUpXG5cbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5jaGFubmVsLCAnaW5pdDptb2RlbCcsIHRoaXMucmVnaXN0ZXJWaWRlb21haWxGaWVsZClcbiAgICB9KVxuXG4gICAgdGhpcy5saXN0ZW5Ubyh0aGlzLmNoYW5uZWwsICdhbGwnLCBmdW5jdGlvbiAoZXZlbnROYW1lLCBiKSB7XG4gICAgICBjb25zb2xlLmxvZygnVmlkZW9tYWlsIGV2ZW50IHRyaWdnZXJlZDonLCBldmVudE5hbWUsIGIpXG5cbiAgICAgIHRoaXMubGlzdGVuVG8odGhpcy5jaGFubmVsLCAnaW5pdDptb2RlbCcsIHRoaXMucmVnaXN0ZXJWaWRlb21haWxGaWVsZClcbiAgICB9KVxuICB9LFxuXG4gIGdldEZvcm1JZDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdmb3JtSUQnKVxuICB9LFxuXG4gIHJlZ2lzdGVyVmlkZW9tYWlsRmllbGQ6IGZ1bmN0aW9uIChmaWVsZE1vZGVsKSB7XG4gICAgLy8gd29ya2Fyb3VuZCBmb3IgaHR0cHM6Ly9naXRodWIuY29tL3dwbmluamFzL25pbmphLWZvcm1zL2lzc3Vlcy8yNjc1XG4gICAgLy8gYWxzbyBwcmV2ZW50cyBmcm9tIGV2ZW50IGVtaXR0ZXIgbGVha3MgdW5kZXIgcmFjZSBjb25kaXRpb25zXG4gICAgaWYgKCF0aGlzLnZpZGVvbWFpbENsaWVudCkge1xuICAgICAgY29uc29sZS5sb2coJ3JlZ2lzdGVyVmlkZW9tYWlsRmllbGQhJywgZmllbGRNb2RlbClcblxuICAgICAgdGhpcy5maWVsZE1vZGVsID0gZmllbGRNb2RlbFxuXG4gICAgICB0aGlzLmxvYWRWaWRlb21haWxDbGllbnQoKVxuXG4gICAgICAvLyBjdXN0b20gZmllbGQgdmFsaWRhdGlvbiwgc2luY2Ugd2UgYXJlbid0IHVzaW5nIGEgc3RhbmRhcmQgYHZhbHVlYFxuICAgICAgLy8gZm9yIHRoZSB2aWRlb21haWwgaW5wdXRcbiAgICAgIHRoaXMuY2hhbm5lbC5yZXBseSgndmFsaWRhdGU6cmVxdWlyZWQnLCB0aGlzLnZhbGlkYXRlUmVxdWlyZWQsIHRoaXMpXG5cbiAgICAgIHRoaXMuY2hhbm5lbC5yZXBseSgndmFsaWRhdGU6bW9kZWxEYXRhJywgdGhpcy52YWxpZGF0ZVZpZGVvbWFpbCwgdGhpcylcblxuICAgICAgLy8gY29udHJvbCBzdWJtaXNzaW9uIHByb2dyZXNzLFxuICAgICAgLy8gc28gdGhhdCB3ZSBjYW4gUE9TVCB0byB0aGUgVmlkZW9tYWlsIHNlcnZlciBmaXJzdFxuICAgICAgbmZSYWRpb1xuICAgICAgICAuY2hhbm5lbCgnZm9ybS0nICsgdGhpcy5nZXRGb3JtSWQoKSlcbiAgICAgICAgLnJlcGx5KCdtYXliZTpzdWJtaXQnLCB0aGlzLm1heWJlU3VibWl0LCB0aGlzLCBmaWVsZE1vZGVsKVxuICAgIH1cbiAgfSxcblxuICBsb2FkVmlkZW9tYWlsQ2xpZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpbWFnZV9xdWFsaXR5JykgfHwgNDBcblxuICAgIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlID4gMTAwKSB7XG4gICAgICBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gMTAwXG4gICAgfSBlbHNlIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlIDwgMSkge1xuICAgICAgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IDFcbiAgICB9XG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudCA9IG5ldyBWaWRlb21haWxDbGllbnQoe1xuICAgICAgc2l0ZU5hbWU6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3NpdGVfbmFtZScpLFxuICAgICAgdmlkZW86IHtcbiAgICAgICAgbGltaXRTZWNvbmRzOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdsaW1pdF9zZWNvbmRzJykgfHwgOTAsXG4gICAgICAgIHdpZHRoOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCd3aWR0aCcpIHx8IDMyMCxcbiAgICAgICAgY291bnRkb3duOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdjb3VudGRvd24nKSB8fCBmYWxzZVxuICAgICAgfSxcbiAgICAgIGF1ZGlvOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2F1ZGlvX2VuYWJsZWQnKVxuICAgICAgfSxcbiAgICAgIGltYWdlOiB7XG4gICAgICAgIHF1YWxpdHk6IGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgLyAxMDAgLy8gbXVzdCBiZSBhIGZsb2F0XG4gICAgICB9LFxuICAgICAgc2VsZWN0b3JzOiB7XG4gICAgICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLnN1Ym1pdC13cmFwIGlucHV0J1xuICAgICAgfSxcbiAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAvLyB1Z2x5IG5hbWUgZWg/XG4gICAgICAgIGFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZzogdGhpcy5hZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmdUb1ZpZGVvbWFpbFNlcnZlci5iaW5kKFxuICAgICAgICAgIHRoaXNcbiAgICAgICAgKVxuICAgICAgfSxcbiAgICAgIC8vIGxlYXZlIGl0IHRvIG5pbmphIGZvcm0gdG8gdmFsaWRhdGUgdGhlIGlucHV0c1xuICAgICAgZW5hYmxlQXV0b1ZhbGlkYXRpb246IGZhbHNlLFxuICAgICAgLy8gbGVhdmUgaXQgdG8gbmluamEgZm9ybSB0byBkZWFsIHdpdGggZm9ybSBzdWJtaXNzaW9uc1xuICAgICAgZW5hYmxlQXV0b1N1Ym1pc3Npb246IGZhbHNlLFxuICAgICAgLy8gbG9nIGFjdGlvbnMvZXZlbnRzIHRvIGNvbnNvbGVcbiAgICAgIHZlcmJvc2U6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3ZlcmJvc2UnKSB8fCBERUJVR1xuICAgIH0pXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5QUkVWSUVXLFxuICAgICAgdGhpcy5vblByZXZpZXcuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlNVQk1JVFRFRCxcbiAgICAgIHRoaXMub25TdWJtaXR0ZWQuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLkdPSU5HX0JBQ0ssXG4gICAgICB0aGlzLm9uR29pbmdCYWNrLmJpbmQodGhpcylcbiAgICApXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5zaG93KClcbiAgfSxcblxuICAvLyBuZWVkZWQgdG8gZ2V0IHRoZSB2aWRlb21haWwga2V5IHdoaWNoIGlzIHJlcXVpcmVkIGJlZm9yZVxuICAvLyBzdWJtaXR0aW5nIHRvIHRoZSB2aWRlb21haWwgc2VydmVyXG4gIG9uUHJldmlldzogZnVuY3Rpb24gKGtleSkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBrZXkpXG4gICAgbmZSYWRpb1xuICAgICAgLmNoYW5uZWwoJ2ZpZWxkcycpXG4gICAgICAvLyBjbGVhcnMgYW55IHByZXZpb3VzIGVycm9yc1xuICAgICAgLnJlcXVlc3QoJ3JlbW92ZTplcnJvcicsIHRoaXMuZmllbGRNb2RlbC5nZXQoJ2lkJyksICdyZXF1aXJlZC1lcnJvcicpXG4gIH0sXG5cbiAgb25TdWJtaXR0ZWQ6IGZ1bmN0aW9uICh2aWRlb21haWwpIHtcbiAgICB2YXIgZm9ybU1vZGVsID0gbmZSYWRpby5jaGFubmVsKCdhcHAnKS5yZXF1ZXN0KCdnZXQ6Zm9ybScsIHRoaXMuZ2V0Rm9ybUlkKCkpXG5cbiAgICAvLyB0b2RvIGlzbid0ICdmb3JtLScgKyBmb3JtTW9kZWwuZ2V0KCdpZCcpIHRoZSBzYW1lIGFzIHRoZSBmb3JtSUQgYWxyZWFkeT9cbiAgICBuZlJhZGlvXG4gICAgICAuY2hhbm5lbCgnZm9ybS0nICsgZm9ybU1vZGVsLmdldCgnaWQnKSlcbiAgICAgIC5yZXF1ZXN0KCdhZGQ6ZXh0cmEnLCAndmlkZW9tYWlsJywgdmlkZW9tYWlsKVxuXG4gICAgLy8gcmVzdGFydCBzdWJtaXNzaW9uIGFnYWluLCB0aGlzIHRpbWUgdG8gdGhlIHJlYWwgd3Agc2l0ZVxuICAgIG5mUmFkaW8uY2hhbm5lbCgnZm9ybS0nICsgdGhpcy5nZXRGb3JtSWQoKSkucmVxdWVzdCgnc3VibWl0JywgZm9ybU1vZGVsKVxuICB9LFxuXG4gIG9uR29pbmdCYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgndmlkZW9tYWlsLWtleScsIG51bGwpXG4gICAgdGhpcy5pbnZhbGlkYXRlKClcbiAgfSxcblxuICB2YWxpZGF0ZVJlcXVpcmVkOiBmdW5jdGlvbiAoZWwsIGZpZWxkTW9kZWwpIHtcbiAgICB2YXIgdmFsaWQgPSB0aGlzLnZhbGlkYXRlVmlkZW9tYWlsKGZpZWxkTW9kZWwpXG5cbiAgICBpZiAoIXZhbGlkKSB7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKVxuICAgIH1cblxuICAgIHJldHVybiB2YWxpZFxuICB9LFxuXG4gIGludmFsaWRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBvdmVycmlkZSBkZWZhdWx0IGJlaGF2aW91ciBzbyB0aGF0IHdlIGNhbiBzZXQgb3VyIG93biBlcnJvciB0ZXh0IGhlcmVcbiAgICBuZlJhZGlvXG4gICAgICAuY2hhbm5lbCgnZmllbGRzJylcbiAgICAgIC5yZXF1ZXN0KFxuICAgICAgICAnYWRkOmVycm9yJyxcbiAgICAgICAgdGhpcy5maWVsZE1vZGVsLmdldCgnaWQnKSxcbiAgICAgICAgJ3JlcXVpcmVkLWVycm9yJyxcbiAgICAgICAgJ1JlY29yZCBhbmQgY2xpY2sgb24gc3RvcCB0byBzZWUgYSBwcmV2aWV3IHZpZGVvLidcbiAgICAgIClcbiAgfSxcblxuICB2YWxpZGF0ZVZpZGVvbWFpbDogZnVuY3Rpb24gKGZpZWxkTW9kZWwpIHtcbiAgICBmaWVsZE1vZGVsID0gZmllbGRNb2RlbCB8fCB0aGlzLmZpZWxkTW9kZWxcbiAgICByZXR1cm4gZmllbGRNb2RlbC5nZXQoJ3ZpZGVvbWFpbC1rZXknKSB8fCBmYWxzZVxuICB9LFxuXG4gIGhhc0Vycm9yczogZnVuY3Rpb24gKGZvcm1Nb2RlbCkge1xuICAgIHJldHVybiBmb3JtTW9kZWwuZ2V0KCdlcnJvcnMnKS5sZW5ndGggPiAwXG4gIH0sXG5cbiAgbWF5YmVTdWJtaXQ6IGZ1bmN0aW9uIChmb3JtTW9kZWwpIHtcbiAgICB2YXIgbWF5YmUgPSB0cnVlXG4gICAgdmFyIHZpZGVvbWFpbFN1Ym1pdHRlZCA9IGZvcm1Nb2RlbC5nZXRFeHRyYSgndmlkZW9tYWlsJylcbiAgICB2YXIgdmlkZW9tYWlsUmVjb3JkZWQgPSB0aGlzLnZhbGlkYXRlVmlkZW9tYWlsKClcbiAgICB2YXIgZXJyb3JuZW91cyA9IHRoaXMuaGFzRXJyb3JzKGZvcm1Nb2RlbClcblxuICAgIC8vIGhvbGQgb24gd2l0aCBmaW5hbCBmb3JtIHN1Ym1pc3Npb24gd2hlbiBvbmUgd2FzIHJlY29yZGVkXG4gICAgLy8gYnV0IGhhc24ndCBiZWVuIHN1Ym1pdHRlZCB0byB0aGUgdmlkZW9tYWlsIHNlcnZlciB5ZXRcbiAgICBpZiAoIXZpZGVvbWFpbFN1Ym1pdHRlZCAmJiAhZXJyb3JuZW91cyAmJiB2aWRlb21haWxSZWNvcmRlZCkge1xuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuc3VibWl0KClcbiAgICAgIG1heWJlID0gZmFsc2VcbiAgICB9XG5cbiAgICByZXR1cm4gbWF5YmVcbiAgfSxcblxuICBnZXRNZXJnZVRhZ1ZhbHVlOiBmdW5jdGlvbiAoZmllbGRLZXksIGZvcm1WYWx1ZXMpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KGZpZWxkS2V5KVxuXG4gICAgLy8gaXQgY2FuIGhhcHBlbiB0aGF0IHRoZSB1c2VyIGhhcyBjb25maWd1cmVkIHNvbWV0aGluZyB3cm9uZyxcbiAgICAvLyBpLkUuIGFuIGVtcHR5IGVtYWlsX2Zyb20uIGluIHRoYXQgY2FzZSBqdXN0IGlnbm9yZSAuLi5cbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIC8vIGFkbWluIGVtYWlsIGxvY2FsaXplZCBmcm9tIGJhY2tlbmQsIGEgYml0IHVnbHlcbiAgICAgIC8vIHRvZG8gYXNrIGZvciBhbiBlbmRwb2ludCB0byBwcm9jZXNzIHRob3NlIHNwZWNpYWwgbWVyZ2UgdGFnc1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2JpbmFyeWtpdGNoZW4vdmlkZW9tYWlsLWZvci1uaW5qYS1mb3Jtcy9pc3N1ZXMvMzBcbiAgICAgIGlmICh2YWx1ZSA9PT0gJ3t3cDphZG1pbl9lbWFpbH0nKSB7XG4gICAgICAgIHZhbHVlID0gd2luZG93Lm5mVmlkZW9tYWlsLmFkbWluX2VtYWlsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcmF3RmllbGRLZXlNYXRjaGVzID0gdmFsdWUubWF0Y2goL3tmaWVsZDooLiopfS9pKVxuICAgICAgICB2YXIgcmF3RmllbGRLZXkgPSByYXdGaWVsZEtleU1hdGNoZXMgJiYgcmF3RmllbGRLZXlNYXRjaGVzWzFdXG5cbiAgICAgICAgaWYgKHJhd0ZpZWxkS2V5ICE9PSB2YWx1ZSkge1xuICAgICAgICAgIC8vIHllcyBpdCB3YXMgYSBtZXJnZSB0YWcsIHNvIHVzZSBpdFxuICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgve2ZpZWxkOiguKil9L2ksIGZvcm1WYWx1ZXNbcmF3RmllbGRLZXldKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlXG4gIH0sXG5cbiAgZ2V0Rm9ybVZhbHVlczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBmb3JtTW9kZWwgPSBuZlJhZGlvLmNoYW5uZWwoJ2FwcCcpLnJlcXVlc3QoJ2dldDpmb3JtJywgdGhpcy5nZXRGb3JtSWQoKSlcbiAgICB2YXIgZmllbGRzQ29sbGVjdGlvbiA9IGZvcm1Nb2RlbC5nZXQoJ2ZpZWxkcycpXG5cbiAgICByZXR1cm4gZmllbGRzQ29sbGVjdGlvbi5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGZpZWxkKSB7XG4gICAgICBtZW1vW2ZpZWxkLmdldCgna2V5JyldID0gZmllbGQuZ2V0KCd2YWx1ZScpXG4gICAgICByZXR1cm4gbWVtb1xuICAgIH0sIHt9KVxuICB9LFxuXG4gIGFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyOiBmdW5jdGlvbiAodmlkZW9tYWlsLCBjYikge1xuICAgIHZhciBmb3JtVmFsdWVzID0gdGhpcy5nZXRGb3JtVmFsdWVzKClcblxuICAgIHZpZGVvbWFpbC5mcm9tID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9mcm9tJywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwudG8gPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX3RvJywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwuc3ViamVjdCA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfc3ViamVjdCcsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLmJvZHkgPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX2JvZHknLCBmb3JtVmFsdWVzKVxuXG4gICAgY2IobnVsbCwgdmlkZW9tYWlsKVxuICB9LFxuXG4gIG9uQmVmb3JlRGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LnVubG9hZCgpXG4gICAgZGVsZXRlIHRoaXMudmlkZW9tYWlsQ2xpZW50XG4gIH1cbn0pXG5cbmpRdWVyeShkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gbmV3IFZpZGVvbWFpbEZpZWxkQ29udHJvbGxlcigpXG59KVxuIl0sIm5hbWVzIjpbIkRFQlVHIiwiVmlkZW9tYWlsRmllbGRDb250cm9sbGVyIiwiTWFyaW9uZXR0ZSIsIk9iamVjdCIsImV4dGVuZCIsInZpZGVvbWFpbENsaWVudCIsImZpZWxkTW9kZWwiLCJjaGFubmVsIiwibmZSYWRpbyIsImluaXRpYWxpemUiLCJ0aGlzIiwibGlzdGVuVG8iLCJldmVudE5hbWUiLCJjb25zb2xlIiwibG9nIiwicmVnaXN0ZXJWaWRlb21haWxGaWVsZCIsImIiLCJnZXRGb3JtSWQiLCJnZXQiLCJsb2FkVmlkZW9tYWlsQ2xpZW50IiwicmVwbHkiLCJ2YWxpZGF0ZVJlcXVpcmVkIiwidmFsaWRhdGVWaWRlb21haWwiLCJtYXliZVN1Ym1pdCIsImltYWdlUXVhbGl0eVBlcmNlbnRhZ2UiLCJWaWRlb21haWxDbGllbnQiLCJzaXRlTmFtZSIsInZpZGVvIiwibGltaXRTZWNvbmRzIiwid2lkdGgiLCJjb3VudGRvd24iLCJhdWRpbyIsImVuYWJsZWQiLCJpbWFnZSIsInF1YWxpdHkiLCJzZWxlY3RvcnMiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImNhbGxiYWNrcyIsImFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZyIsImFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyIiwiYmluZCIsImVuYWJsZUF1dG9WYWxpZGF0aW9uIiwiZW5hYmxlQXV0b1N1Ym1pc3Npb24iLCJ2ZXJib3NlIiwib24iLCJldmVudHMiLCJQUkVWSUVXIiwib25QcmV2aWV3IiwiU1VCTUlUVEVEIiwib25TdWJtaXR0ZWQiLCJHT0lOR19CQUNLIiwib25Hb2luZ0JhY2siLCJzaG93Iiwia2V5Iiwic2V0IiwicmVxdWVzdCIsInZpZGVvbWFpbCIsImZvcm1Nb2RlbCIsImludmFsaWRhdGUiLCJlbCIsInZhbGlkIiwiaGFzRXJyb3JzIiwibGVuZ3RoIiwibWF5YmUiLCJ2aWRlb21haWxTdWJtaXR0ZWQiLCJnZXRFeHRyYSIsInZpZGVvbWFpbFJlY29yZGVkIiwiZXJyb3JuZW91cyIsInN1Ym1pdCIsImdldE1lcmdlVGFnVmFsdWUiLCJmaWVsZEtleSIsImZvcm1WYWx1ZXMiLCJ2YWx1ZSIsIndpbmRvdyIsIm5mVmlkZW9tYWlsIiwiYWRtaW5fZW1haWwiLCJyYXdGaWVsZEtleSIsInJhd0ZpZWxkS2V5TWF0Y2hlcyIsIm1hdGNoIiwicmVwbGFjZSIsImdldEZvcm1WYWx1ZXMiLCJyZWR1Y2UiLCJtZW1vIiwiZmllbGQiLCJjYiIsImZyb20iLCJ0byIsInN1YmplY3QiLCJib2R5Iiwib25CZWZvcmVEZXN0cm95IiwidW5sb2FkIiwialF1ZXJ5IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBSUEsT0FBUSxFQUtSQyx5QkFBMkJDLFdBQVdDLE9BQU9DLE9BQU8sQ0FDdERDLGdCQUFpQixLQUdqQkMsV0FBWSxLQUVaQyxRQUFTQyxRQUFRRCxRQUFRLGFBRXpCRSxXQUFZLFdBQ1ZELFFBQVFSLE1BQVFBLE1BRWhCVSxLQUFLQyxTQUFTSCxRQUFRRCxRQUFRLFVBQVcsTUFBTyxTQUFVSyxHQUN4REMsUUFBUUMsSUFBSSwwQkFBMkJGLEdBRXZDRixLQUFLQyxTQUFTRCxLQUFLSCxRQUFTLGFBQWNHLEtBQUtLLDBCQUdqREwsS0FBS0MsU0FBU0gsUUFBUUQsUUFBUSxPQUFRLE1BQU8sU0FBVUssR0FDckRDLFFBQVFDLElBQUksdUJBQXdCRixHQUVwQ0YsS0FBS0MsU0FBU0QsS0FBS0gsUUFBUyxhQUFjRyxLQUFL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
