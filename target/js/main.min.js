var DEBUG=!0,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,initialize:function(){Backbone.Radio.DEBUG=DEBUG,this.listenTo(Backbone.Radio.channel("videomail"),"all",function(e,i){console.log("Videomail event triggered:",e,i)}),this.listenTo(Backbone.Radio.channel("fields"),"all",function(e,i){console.log("Fields event triggered:",e,i)}),this.listenTo(Backbone.Radio.channel("videomail"),"init:model",this.registerVideomailField)},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(this.fieldModel=e,this.loadVideomailClient(),Backbone.Radio.channel("videomail").reply("validate:required",this.validateRequired,this),Backbone.Radio.channel("videomail").reply("validate:modelData",this.validateVideomail,this),Backbone.Radio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1),this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:this.fieldModel.get("verbose")||DEBUG}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),Backbone.Radio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=nfRadio.channel("app").request("get:form",this.getFormId());nfRadio.channel("form-"+i.get("id")).request("add:extra","videomail",e),nfRadio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){i=this.validateVideomail(i);return i||this.invalidate(),i},invalidate:function(){Backbone.Radio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),o=this.validateVideomail(),e=this.hasErrors(e);return t||e||!o||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t=this.fieldModel.get(e);return t&&("{wp:admin_email}"===t?t=window.nfVideomail.admin_email:(e=(e=t.match(/{field:(.*)}/i))&&e[1])!==t&&(t=t.replace(/{field:(.*)}/i,i[e]))),t},getFormValues:function(){return Backbone.Radio.channel("app").request("get:form",this.getFormId()).get("fields").reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSB0cnVlXG5cbi8vIGdvb2QgZG9jdW1lbnRhdGlvbiBvbiBiYWNrYm9uZSBldmVudCBoYW5kbGluZ1xuLy8gaHR0cDovL2JhY2tib25lanMub3JnLyNFdmVudHNcblxudmFyIFZpZGVvbWFpbEZpZWxkQ29udHJvbGxlciA9IE1hcmlvbmV0dGUuT2JqZWN0LmV4dGVuZCh7XG4gIHZpZGVvbWFpbENsaWVudDogbnVsbCxcblxuICAvLyBub3Qgc3VyZSBpZiB0aGlzIGlzIGEgZ29vZCBpZGVhLCBidXQgaSBuZWVkIGEgcmVmZXJlbmNlIHRvIGl0XG4gIGZpZWxkTW9kZWw6IG51bGwsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkge1xuICAgIEJhY2tib25lLlJhZGlvLkRFQlVHID0gREVCVUdcblxuICAgIC8vIGlmIChERUJVRykge1xuICAgIHRoaXMubGlzdGVuVG8oQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgndmlkZW9tYWlsJyksICdhbGwnLCBmdW5jdGlvbiAoZXZlbnROYW1lLCBiKSB7XG4gICAgICBjb25zb2xlLmxvZygnVmlkZW9tYWlsIGV2ZW50IHRyaWdnZXJlZDonLCBldmVudE5hbWUsIGIpXG4gICAgfSlcblxuICAgIHRoaXMubGlzdGVuVG8oQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZmllbGRzJyksICdhbGwnLCBmdW5jdGlvbiAoZXZlbnROYW1lLCBiKSB7XG4gICAgICBjb25zb2xlLmxvZygnRmllbGRzIGV2ZW50IHRyaWdnZXJlZDonLCBldmVudE5hbWUsIGIpXG4gICAgfSlcbiAgICAvLyB9XG5cbiAgICB0aGlzLmxpc3RlblRvKFxuICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgndmlkZW9tYWlsJyksXG4gICAgICAnaW5pdDptb2RlbCcsXG4gICAgICB0aGlzLnJlZ2lzdGVyVmlkZW9tYWlsRmllbGRcbiAgICApXG4gIH0sXG5cbiAgZ2V0Rm9ybUlkOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmllbGRNb2RlbC5nZXQoJ2Zvcm1JRCcpXG4gIH0sXG5cbiAgcmVnaXN0ZXJWaWRlb21haWxGaWVsZDogZnVuY3Rpb24gKGZpZWxkTW9kZWwpIHtcbiAgICAvLyB3b3JrYXJvdW5kIGZvciBodHRwczovL2dpdGh1Yi5jb20vd3BuaW5qYXMvbmluamEtZm9ybXMvaXNzdWVzLzI2NzVcbiAgICAvLyBhbHNvIHByZXZlbnRzIGZyb20gZXZlbnQgZW1pdHRlciBsZWFrcyB1bmRlciByYWNlIGNvbmRpdGlvbnNcbiAgICBpZiAoIXRoaXMudmlkZW9tYWlsQ2xpZW50KSB7XG4gICAgICB0aGlzLmZpZWxkTW9kZWwgPSBmaWVsZE1vZGVsXG5cbiAgICAgIHRoaXMubG9hZFZpZGVvbWFpbENsaWVudCgpXG5cbiAgICAgIC8vIGN1c3RvbSBmaWVsZCB2YWxpZGF0aW9uLCBzaW5jZSB3ZSBhcmVuJ3QgdXNpbmcgYSBzdGFuZGFyZCBgdmFsdWVgXG4gICAgICAvLyBmb3IgdGhlIHZpZGVvbWFpbCBpbnB1dFxuICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgndmlkZW9tYWlsJykucmVwbHkoXG4gICAgICAgICd2YWxpZGF0ZTpyZXF1aXJlZCcsXG4gICAgICAgIHRoaXMudmFsaWRhdGVSZXF1aXJlZCxcbiAgICAgICAgdGhpc1xuICAgICAgKVxuXG4gICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKS5yZXBseShcbiAgICAgICAgJ3ZhbGlkYXRlOm1vZGVsRGF0YScsXG4gICAgICAgIHRoaXMudmFsaWRhdGVWaWRlb21haWwsXG4gICAgICAgIHRoaXNcbiAgICAgIClcblxuICAgICAgLy8gY29udHJvbCBzdWJtaXNzaW9uIHByb2dyZXNzLFxuICAgICAgLy8gc28gdGhhdCB3ZSBjYW4gUE9TVCB0byB0aGUgVmlkZW9tYWlsIHNlcnZlciBmaXJzdFxuICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZm9ybS0nICsgdGhpcy5nZXRGb3JtSWQoKSkucmVwbHkoXG4gICAgICAgICdtYXliZTpzdWJtaXQnLFxuICAgICAgICB0aGlzLm1heWJlU3VibWl0LFxuICAgICAgICB0aGlzLFxuICAgICAgICBmaWVsZE1vZGVsXG4gICAgICApXG4gICAgfVxuICB9LFxuXG4gIGxvYWRWaWRlb21haWxDbGllbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2ltYWdlX3F1YWxpdHknKSB8fCA0MFxuXG4gICAgaWYgKGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPiAxMDApIHtcbiAgICAgIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSAxMDBcbiAgICB9IGVsc2UgaWYgKGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPCAxKSB7XG4gICAgICBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gMVxuICAgIH1cblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50ID0gbmV3IFZpZGVvbWFpbENsaWVudCh7XG4gICAgICBzaXRlTmFtZTogdGhpcy5maWVsZE1vZGVsLmdldCgnc2l0ZV9uYW1lJyksXG4gICAgICB2aWRlbzoge1xuICAgICAgICBsaW1pdFNlY29uZHM6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2xpbWl0X3NlY29uZHMnKSB8fCA5MCxcbiAgICAgICAgd2lkdGg6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3dpZHRoJykgfHwgMzIwLFxuICAgICAgICBjb3VudGRvd246IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2NvdW50ZG93bicpIHx8IGZhbHNlXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgZW5hYmxlZDogdGhpcy5maWVsZE1vZGVsLmdldCgnYXVkaW9fZW5hYmxlZCcpXG4gICAgICB9LFxuICAgICAgaW1hZ2U6IHtcbiAgICAgICAgcXVhbGl0eTogaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSAvIDEwMCAvLyBtdXN0IGJlIGEgZmxvYXRcbiAgICAgIH0sXG4gICAgICBzZWxlY3RvcnM6IHtcbiAgICAgICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcuc3VibWl0LXdyYXAgaW5wdXQnXG4gICAgICB9LFxuICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgIC8vIHVnbHkgbmFtZSBlaD9cbiAgICAgICAgYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nOiB0aGlzLmFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyLmJpbmQoXG4gICAgICAgICAgdGhpc1xuICAgICAgICApXG4gICAgICB9LFxuICAgICAgLy8gbGVhdmUgaXQgdG8gbmluamEgZm9ybSB0byB2YWxpZGF0ZSB0aGUgaW5wdXRzXG4gICAgICBlbmFibGVBdXRvVmFsaWRhdGlvbjogZmFsc2UsXG4gICAgICAvLyBsZWF2ZSBpdCB0byBuaW5qYSBmb3JtIHRvIGRlYWwgd2l0aCBmb3JtIHN1Ym1pc3Npb25zXG4gICAgICBlbmFibGVBdXRvU3VibWlzc2lvbjogZmFsc2UsXG4gICAgICAvLyBsb2cgYWN0aW9ucy9ldmVudHMgdG8gY29uc29sZVxuICAgICAgdmVyYm9zZTogdGhpcy5maWVsZE1vZGVsLmdldCgndmVyYm9zZScpIHx8IERFQlVHXG4gICAgfSlcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlBSRVZJRVcsXG4gICAgICB0aGlzLm9uUHJldmlldy5iaW5kKHRoaXMpXG4gICAgKVxuXG4gICAgdGhpcy52aWRlb21haWxDbGllbnQub24oXG4gICAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5ldmVudHMuU1VCTUlUVEVELFxuICAgICAgdGhpcy5vblN1Ym1pdHRlZC5iaW5kKHRoaXMpXG4gICAgKVxuXG4gICAgdGhpcy52aWRlb21haWxDbGllbnQub24oXG4gICAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5ldmVudHMuR09JTkdfQkFDSyxcbiAgICAgIHRoaXMub25Hb2luZ0JhY2suYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LnNob3coKVxuICB9LFxuXG4gIC8vIG5lZWRlZCB0byBnZXQgdGhlIHZpZGVvbWFpbCBrZXkgd2hpY2ggaXMgcmVxdWlyZWQgYmVmb3JlXG4gIC8vIHN1Ym1pdHRpbmcgdG8gdGhlIHZpZGVvbWFpbCBzZXJ2ZXJcbiAgb25QcmV2aWV3OiBmdW5jdGlvbiAoa2V5KSB7XG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgndmlkZW9tYWlsLWtleScsIGtleSlcbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmaWVsZHMnKVxuICAgICAgLy8gY2xlYXJzIGFueSBwcmV2aW91cyBlcnJvcnNcbiAgICAgIC5yZXF1ZXN0KCdyZW1vdmU6ZXJyb3InLCB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpZCcpLCAncmVxdWlyZWQtZXJyb3InKVxuICB9LFxuXG4gIG9uU3VibWl0dGVkOiBmdW5jdGlvbiAodmlkZW9tYWlsKSB7XG4gICAgdmFyIGZvcm1Nb2RlbCA9IG5mUmFkaW8uY2hhbm5lbCgnYXBwJykucmVxdWVzdCgnZ2V0OmZvcm0nLCB0aGlzLmdldEZvcm1JZCgpKVxuXG4gICAgLy8gdG9kbyBpc24ndCAnZm9ybS0nICsgZm9ybU1vZGVsLmdldCgnaWQnKSB0aGUgc2FtZSBhcyB0aGUgZm9ybUlEIGFscmVhZHk/XG4gICAgbmZSYWRpb1xuICAgICAgLmNoYW5uZWwoJ2Zvcm0tJyArIGZvcm1Nb2RlbC5nZXQoJ2lkJykpXG4gICAgICAucmVxdWVzdCgnYWRkOmV4dHJhJywgJ3ZpZGVvbWFpbCcsIHZpZGVvbWFpbClcblxuICAgIC8vIHJlc3RhcnQgc3VibWlzc2lvbiBhZ2FpbiwgdGhpcyB0aW1lIHRvIHRoZSByZWFsIHdwIHNpdGVcbiAgICBuZlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIHRoaXMuZ2V0Rm9ybUlkKCkpLnJlcXVlc3QoJ3N1Ym1pdCcsIGZvcm1Nb2RlbClcbiAgfSxcblxuICBvbkdvaW5nQmFjazogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBudWxsKVxuICAgIHRoaXMuaW52YWxpZGF0ZSgpXG4gIH0sXG5cbiAgdmFsaWRhdGVSZXF1aXJlZDogZnVuY3Rpb24gKGVsLCBmaWVsZE1vZGVsKSB7XG4gICAgdmFyIHZhbGlkID0gdGhpcy52YWxpZGF0ZVZpZGVvbWFpbChmaWVsZE1vZGVsKVxuXG4gICAgaWYgKCF2YWxpZCkge1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKClcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRcbiAgfSxcblxuICBpbnZhbGlkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gb3ZlcnJpZGUgZGVmYXVsdCBiZWhhdmlvdXIgc28gdGhhdCB3ZSBjYW4gc2V0IG91ciBvd24gZXJyb3IgdGV4dCBoZXJlXG4gICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZmllbGRzJykucmVxdWVzdChcbiAgICAgICdhZGQ6ZXJyb3InLFxuICAgICAgdGhpcy5maWVsZE1vZGVsLmdldCgnaWQnKSxcbiAgICAgICdyZXF1aXJlZC1lcnJvcicsXG4gICAgICAnUmVjb3JkIGFuZCBjbGljayBvbiBzdG9wIHRvIHNlZSBhIHByZXZpZXcgdmlkZW8uJ1xuICAgIClcbiAgfSxcblxuICB2YWxpZGF0ZVZpZGVvbWFpbDogZnVuY3Rpb24gKGZpZWxkTW9kZWwpIHtcbiAgICBmaWVsZE1vZGVsID0gZmllbGRNb2RlbCB8fCB0aGlzLmZpZWxkTW9kZWxcbiAgICByZXR1cm4gZmllbGRNb2RlbC5nZXQoJ3ZpZGVvbWFpbC1rZXknKSB8fCBmYWxzZVxuICB9LFxuXG4gIGhhc0Vycm9yczogZnVuY3Rpb24gKGZvcm1Nb2RlbCkge1xuICAgIHJldHVybiBmb3JtTW9kZWwuZ2V0KCdlcnJvcnMnKS5sZW5ndGggPiAwXG4gIH0sXG5cbiAgbWF5YmVTdWJtaXQ6IGZ1bmN0aW9uIChmb3JtTW9kZWwpIHtcbiAgICB2YXIgbWF5YmUgPSB0cnVlXG4gICAgdmFyIHZpZGVvbWFpbFN1Ym1pdHRlZCA9IGZvcm1Nb2RlbC5nZXRFeHRyYSgndmlkZW9tYWlsJylcbiAgICB2YXIgdmlkZW9tYWlsUmVjb3JkZWQgPSB0aGlzLnZhbGlkYXRlVmlkZW9tYWlsKClcbiAgICB2YXIgZXJyb3JuZW91cyA9IHRoaXMuaGFzRXJyb3JzKGZvcm1Nb2RlbClcblxuICAgIC8vIGhvbGQgb24gd2l0aCBmaW5hbCBmb3JtIHN1Ym1pc3Npb24gd2hlbiBvbmUgd2FzIHJlY29yZGVkXG4gICAgLy8gYnV0IGhhc24ndCBiZWVuIHN1Ym1pdHRlZCB0byB0aGUgdmlkZW9tYWlsIHNlcnZlciB5ZXRcbiAgICBpZiAoIXZpZGVvbWFpbFN1Ym1pdHRlZCAmJiAhZXJyb3JuZW91cyAmJiB2aWRlb21haWxSZWNvcmRlZCkge1xuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuc3VibWl0KClcbiAgICAgIG1heWJlID0gZmFsc2VcbiAgICB9XG5cbiAgICByZXR1cm4gbWF5YmVcbiAgfSxcblxuICBnZXRNZXJnZVRhZ1ZhbHVlOiBmdW5jdGlvbiAoZmllbGRLZXksIGZvcm1WYWx1ZXMpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KGZpZWxkS2V5KVxuXG4gICAgLy8gaXQgY2FuIGhhcHBlbiB0aGF0IHRoZSB1c2VyIGhhcyBjb25maWd1cmVkIHNvbWV0aGluZyB3cm9uZyxcbiAgICAvLyBpLkUuIGFuIGVtcHR5IGVtYWlsX2Zyb20uIGluIHRoYXQgY2FzZSBqdXN0IGlnbm9yZSAuLi5cbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIC8vIGFkbWluIGVtYWlsIGxvY2FsaXplZCBmcm9tIGJhY2tlbmQsIGEgYml0IHVnbHlcbiAgICAgIC8vIHRvZG8gYXNrIGZvciBhbiBlbmRwb2ludCB0byBwcm9jZXNzIHRob3NlIHNwZWNpYWwgbWVyZ2UgdGFnc1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2JpbmFyeWtpdGNoZW4vdmlkZW9tYWlsLWZvci1uaW5qYS1mb3Jtcy9pc3N1ZXMvMzBcbiAgICAgIGlmICh2YWx1ZSA9PT0gJ3t3cDphZG1pbl9lbWFpbH0nKSB7XG4gICAgICAgIHZhbHVlID0gd2luZG93Lm5mVmlkZW9tYWlsLmFkbWluX2VtYWlsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcmF3RmllbGRLZXlNYXRjaGVzID0gdmFsdWUubWF0Y2goL3tmaWVsZDooLiopfS9pKVxuICAgICAgICB2YXIgcmF3RmllbGRLZXkgPSByYXdGaWVsZEtleU1hdGNoZXMgJiYgcmF3RmllbGRLZXlNYXRjaGVzWzFdXG5cbiAgICAgICAgaWYgKHJhd0ZpZWxkS2V5ICE9PSB2YWx1ZSkge1xuICAgICAgICAgIC8vIHllcyBpdCB3YXMgYSBtZXJnZSB0YWcsIHNvIHVzZSBpdFxuICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgve2ZpZWxkOiguKil9L2ksIGZvcm1WYWx1ZXNbcmF3RmllbGRLZXldKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlXG4gIH0sXG5cbiAgZ2V0Rm9ybVZhbHVlczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBmb3JtTW9kZWwgPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdhcHAnKS5yZXF1ZXN0KCdnZXQ6Zm9ybScsIHRoaXMuZ2V0Rm9ybUlkKCkpXG4gICAgdmFyIGZpZWxkc0NvbGxlY3Rpb24gPSBmb3JtTW9kZWwuZ2V0KCdmaWVsZHMnKVxuXG4gICAgcmV0dXJuIGZpZWxkc0NvbGxlY3Rpb24ucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBmaWVsZCkge1xuICAgICAgbWVtb1tmaWVsZC5nZXQoJ2tleScpXSA9IGZpZWxkLmdldCgndmFsdWUnKVxuICAgICAgcmV0dXJuIG1lbW9cbiAgICB9LCB7fSlcbiAgfSxcblxuICBhZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmdUb1ZpZGVvbWFpbFNlcnZlcjogZnVuY3Rpb24gKHZpZGVvbWFpbCwgY2IpIHtcbiAgICB2YXIgZm9ybVZhbHVlcyA9IHRoaXMuZ2V0Rm9ybVZhbHVlcygpXG5cbiAgICB2aWRlb21haWwuZnJvbSA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfZnJvbScsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLnRvID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF90bycsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLnN1YmplY3QgPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX3N1YmplY3QnLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC5ib2R5ID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9ib2R5JywgZm9ybVZhbHVlcylcblxuICAgIGNiKG51bGwsIHZpZGVvbWFpbClcbiAgfSxcblxuICBvbkJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC51bmxvYWQoKVxuICAgIGRlbGV0ZSB0aGlzLnZpZGVvbWFpbENsaWVudFxuICB9XG59KVxuXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIG5ldyBWaWRlb21haWxGaWVsZENvbnRyb2xsZXIoKVxufSlcbiJdLCJuYW1lcyI6WyJERUJVRyIsIlZpZGVvbWFpbEZpZWxkQ29udHJvbGxlciIsIk1hcmlvbmV0dGUiLCJPYmplY3QiLCJleHRlbmQiLCJ2aWRlb21haWxDbGllbnQiLCJmaWVsZE1vZGVsIiwiaW5pdGlhbGl6ZSIsIkJhY2tib25lIiwiUmFkaW8iLCJ0aGlzIiwibGlzdGVuVG8iLCJjaGFubmVsIiwiZXZlbnROYW1lIiwiYiIsImNvbnNvbGUiLCJsb2ciLCJyZWdpc3RlclZpZGVvbWFpbEZpZWxkIiwiZ2V0Rm9ybUlkIiwiZ2V0IiwibG9hZFZpZGVvbWFpbENsaWVudCIsInJlcGx5IiwidmFsaWRhdGVSZXF1aXJlZCIsInZhbGlkYXRlVmlkZW9tYWlsIiwibWF5YmVTdWJtaXQiLCJpbWFnZVF1YWxpdHlQZXJjZW50YWdlIiwiVmlkZW9tYWlsQ2xpZW50Iiwic2l0ZU5hbWUiLCJ2aWRlbyIsImxpbWl0U2Vjb25kcyIsIndpZHRoIiwiY291bnRkb3duIiwiYXVkaW8iLCJlbmFibGVkIiwiaW1hZ2UiLCJxdWFsaXR5Iiwic2VsZWN0b3JzIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJjYWxsYmFja3MiLCJhZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmciLCJhZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmdUb1ZpZGVvbWFpbFNlcnZlciIsImJpbmQiLCJlbmFibGVBdXRvVmFsaWRhdGlvbiIsImVuYWJsZUF1dG9TdWJtaXNzaW9uIiwidmVyYm9zZSIsIm9uIiwiZXZlbnRzIiwiUFJFVklFVyIsIm9uUHJldmlldyIsIlNVQk1JVFRFRCIsIm9uU3VibWl0dGVkIiwiR09JTkdfQkFDSyIsIm9uR29pbmdCYWNrIiwic2hvdyIsImtleSIsInNldCIsInJlcXVlc3QiLCJ2aWRlb21haWwiLCJmb3JtTW9kZWwiLCJuZlJhZGlvIiwiaW52YWxpZGF0ZSIsImVsIiwidmFsaWQiLCJoYXNFcnJvcnMiLCJsZW5ndGgiLCJtYXliZSIsInZpZGVvbWFpbFN1Ym1pdHRlZCIsImdldEV4dHJhIiwidmlkZW9tYWlsUmVjb3JkZWQiLCJlcnJvcm5lb3VzIiwic3VibWl0IiwiZ2V0TWVyZ2VUYWdWYWx1ZSIsImZpZWxkS2V5IiwiZm9ybVZhbHVlcyIsInZhbHVlIiwid2luZG93IiwibmZWaWRlb21haWwiLCJhZG1pbl9lbWFpbCIsInJhd0ZpZWxkS2V5IiwicmF3RmllbGRLZXlNYXRjaGVzIiwibWF0Y2giLCJyZXBsYWNlIiwiZ2V0Rm9ybVZhbHVlcyIsInJlZHVjZSIsIm1lbW8iLCJmaWVsZCIsImNiIiwiZnJvbSIsInRvIiwic3ViamVjdCIsImJvZHkiLCJvbkJlZm9yZURlc3Ryb3kiLCJ1bmxvYWQiLCJqUXVlcnkiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiQUFDQSxJQUFJQSxPQUFR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
