var DEBUG=!1,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,channel:Backbone.Radio.channel("videomail"),initialize:function(){Backbone.Radio.DEBUG=DEBUG,this.listenTo(this.channel,"all",function(e){DEBUG&&console.log("Videomail channel event triggered:",e),this.listenTo(this.channel,"init:model",this.registerVideomailField)})},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(this.fieldModel=e,this.loadVideomailClient(),this.channel.reply("validate:required",this.validateRequired,this),this.channel.reply("validate:modelData",this.validateVideomail,this),Backbone.Radio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1);var i=this.fieldModel.get("verbose")||DEBUG;DEBUG=DEBUG||i,Backbone.Radio.DEBUG=Backbone.Radio.DEBUG||i,this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:i}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),this.fieldModel.set("value",e),Backbone.Radio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=(i=Backbone.Radio.channel("app").request("get:form",this.getFormId()))||this.fieldModel.collection.options.formModel;Backbone.Radio.channel("form-"+i.get("id")).request("add:extra","videomail",e),Backbone.Radio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){i=this.validateVideomail(i);return i||this.invalidate(),i},invalidate:function(){Backbone.Radio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),o=this.validateVideomail(),e=this.hasErrors(e);return t||e||!o||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t=this.fieldModel.get(e);return t&&("{wp:admin_email}"===t?t=window.nfVideomail.admin_email:(e=(e=t.match(/{field:(.*)}/i))&&e[1])!==t&&(t=t.replace(/{field:(.*)}/i,i[e]))),t},getFormValues:function(){var e,i=Backbone.Radio.channel("app").request("get:form",this.getFormId());return i?e=i.get("fields"):this.fieldModel.collection.options.formModel.get("fields").models&&(e=this.fieldModel.collection.options.formModel.get("fields").models),e.reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSBmYWxzZVxuXG4vLyBnb29kIGRvY3VtZW50YXRpb24gb24gYmFja2JvbmUgZXZlbnQgaGFuZGxpbmdcbi8vIGh0dHA6Ly9iYWNrYm9uZWpzLm9yZy8jRXZlbnRzXG5cbnZhciBWaWRlb21haWxGaWVsZENvbnRyb2xsZXIgPSBNYXJpb25ldHRlLk9iamVjdC5leHRlbmQoe1xuICB2aWRlb21haWxDbGllbnQ6IG51bGwsXG5cbiAgZmllbGRNb2RlbDogbnVsbCxcblxuICBjaGFubmVsOiBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgQmFja2JvbmUuUmFkaW8uREVCVUcgPSBERUJVR1xuXG4gICAgLy8gdWdseSB3b3JrYXJvdW5kIHRvIG1ha2UgaXQgd29yayB3aXRoIHRoZSBjb25kaXRpb25hbCBwbHVnaW5cbiAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2FsbCcsIGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIERFQlVHICYmIGNvbnNvbGUubG9nKCdWaWRlb21haWwgY2hhbm5lbCBldmVudCB0cmlnZ2VyZWQ6JywgZXZlbnROYW1lKVxuXG4gICAgICAvLyBvbmx5IHN0YXJ0IGxpc3RlbmluZyBhdCB0aGlzIHBvaW50LiBiZWNhdXNlIHRoZSBjb25kaXRpb25hbCBwbHVnaW5cbiAgICAgIC8vIGlzIHJlc2V0dGluZyBldmVudCBoYW5kbGVycy4gd2l0aG91dCB0aGUgYWJvdmUsIHdlJ2QgYmUgcmVnaXN0ZXJpbmdcbiAgICAgIC8vIHRvbyBlYXJseSBhbmQgdGhlIGNvbmRpdGlvbmFsIHBsdWdpbiBvdmVycmlkZXMuXG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2luaXQ6bW9kZWwnLCB0aGlzLnJlZ2lzdGVyVmlkZW9tYWlsRmllbGQpXG4gICAgfSlcbiAgfSxcblxuICBnZXRGb3JtSWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5maWVsZE1vZGVsLmdldCgnZm9ybUlEJylcbiAgfSxcblxuICByZWdpc3RlclZpZGVvbWFpbEZpZWxkOiBmdW5jdGlvbiAoZmllbGRNb2RlbCkge1xuICAgIC8vIHdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS93cG5pbmphcy9uaW5qYS1mb3Jtcy9pc3N1ZXMvMjY3NVxuICAgIC8vIGFsc28gcHJldmVudHMgZnJvbSBldmVudCBlbWl0dGVyIGxlYWtzIHVuZGVyIHJhY2UgY29uZGl0aW9uc1xuICAgIGlmICghdGhpcy52aWRlb21haWxDbGllbnQpIHtcbiAgICAgIHRoaXMuZmllbGRNb2RlbCA9IGZpZWxkTW9kZWxcblxuICAgICAgdGhpcy5sb2FkVmlkZW9tYWlsQ2xpZW50KClcblxuICAgICAgLy8gY3VzdG9tIGZpZWxkIHZhbGlkYXRpb24sIHNpbmNlIHdlIGFyZW4ndCB1c2luZyBhIHN0YW5kYXJkIGB2YWx1ZWBcbiAgICAgIC8vIGZvciB0aGUgdmlkZW9tYWlsIGlucHV0XG4gICAgICB0aGlzLmNoYW5uZWwucmVwbHkoJ3ZhbGlkYXRlOnJlcXVpcmVkJywgdGhpcy52YWxpZGF0ZVJlcXVpcmVkLCB0aGlzKVxuXG4gICAgICB0aGlzLmNoYW5uZWwucmVwbHkoJ3ZhbGlkYXRlOm1vZGVsRGF0YScsIHRoaXMudmFsaWRhdGVWaWRlb21haWwsIHRoaXMpXG5cbiAgICAgIC8vIGNvbnRyb2wgc3VibWlzc2lvbiBwcm9ncmVzcyxcbiAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIFBPU1QgdG8gdGhlIFZpZGVvbWFpbCBzZXJ2ZXIgZmlyc3RcbiAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIHRoaXMuZ2V0Rm9ybUlkKCkpLnJlcGx5KFxuICAgICAgICAnbWF5YmU6c3VibWl0JyxcbiAgICAgICAgdGhpcy5tYXliZVN1Ym1pdCxcbiAgICAgICAgdGhpcyxcbiAgICAgICAgZmllbGRNb2RlbFxuICAgICAgKVxuICAgIH1cbiAgfSxcblxuICBsb2FkVmlkZW9tYWlsQ2xpZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpbWFnZV9xdWFsaXR5JykgfHwgNDBcblxuICAgIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlID4gMTAwKSB7XG4gICAgICBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gMTAwXG4gICAgfSBlbHNlIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlIDwgMSkge1xuICAgICAgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IDFcbiAgICB9XG5cbiAgICB2YXIgdmVyYm9zZSA9IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3ZlcmJvc2UnKSB8fCBERUJVR1xuXG4gICAgLy8gbGF0ZSBvdmVycmlkZXNcbiAgICBERUJVRyA9IERFQlVHIHx8IHZlcmJvc2VcbiAgICBCYWNrYm9uZS5SYWRpby5ERUJVRyA9IEJhY2tib25lLlJhZGlvLkRFQlVHIHx8IHZlcmJvc2VcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50ID0gbmV3IFZpZGVvbWFpbENsaWVudCh7XG4gICAgICBzaXRlTmFtZTogdGhpcy5maWVsZE1vZGVsLmdldCgnc2l0ZV9uYW1lJyksXG4gICAgICB2aWRlbzoge1xuICAgICAgICBsaW1pdFNlY29uZHM6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2xpbWl0X3NlY29uZHMnKSB8fCA5MCxcbiAgICAgICAgd2lkdGg6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3dpZHRoJykgfHwgMzIwLFxuICAgICAgICBjb3VudGRvd246IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2NvdW50ZG93bicpIHx8IGZhbHNlXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgZW5hYmxlZDogdGhpcy5maWVsZE1vZGVsLmdldCgnYXVkaW9fZW5hYmxlZCcpXG4gICAgICB9LFxuICAgICAgaW1hZ2U6IHtcbiAgICAgICAgcXVhbGl0eTogaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSAvIDEwMCAvLyBtdXN0IGJlIGEgZmxvYXRcbiAgICAgIH0sXG4gICAgICBzZWxlY3RvcnM6IHtcbiAgICAgICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcuc3VibWl0LXdyYXAgaW5wdXQnXG4gICAgICB9LFxuICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgIC8vIHVnbHkgbmFtZSBlaD9cbiAgICAgICAgYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nOiB0aGlzLmFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyLmJpbmQoXG4gICAgICAgICAgdGhpc1xuICAgICAgICApXG4gICAgICB9LFxuICAgICAgLy8gbGVhdmUgaXQgdG8gbmluamEgZm9ybSB0byB2YWxpZGF0ZSB0aGUgaW5wdXRzXG4gICAgICBlbmFibGVBdXRvVmFsaWRhdGlvbjogZmFsc2UsXG4gICAgICAvLyBsZWF2ZSBpdCB0byBuaW5qYSBmb3JtIHRvIGRlYWwgd2l0aCBmb3JtIHN1Ym1pc3Npb25zXG4gICAgICBlbmFibGVBdXRvU3VibWlzc2lvbjogZmFsc2UsXG4gICAgICAvLyBsb2cgYWN0aW9ucy9ldmVudHMgdG8gY29uc29sZVxuICAgICAgdmVyYm9zZTogdmVyYm9zZVxuICAgIH0pXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5QUkVWSUVXLFxuICAgICAgdGhpcy5vblByZXZpZXcuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlNVQk1JVFRFRCxcbiAgICAgIHRoaXMub25TdWJtaXR0ZWQuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLkdPSU5HX0JBQ0ssXG4gICAgICB0aGlzLm9uR29pbmdCYWNrLmJpbmQodGhpcylcbiAgICApXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5zaG93KClcbiAgfSxcblxuICAvLyBuZWVkZWQgdG8gZ2V0IHRoZSB2aWRlb21haWwga2V5IHdoaWNoIGlzIHJlcXVpcmVkIGJlZm9yZVxuICAvLyBzdWJtaXR0aW5nIHRvIHRoZSB2aWRlb21haWwgc2VydmVyXG4gIG9uUHJldmlldzogZnVuY3Rpb24gKGtleSkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBrZXkpXG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgndmFsdWUnLCBrZXkpXG5cbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmaWVsZHMnKVxuICAgICAgLy8gY2xlYXJzIGFueSBwcmV2aW91cyBlcnJvcnNcbiAgICAgIC5yZXF1ZXN0KCdyZW1vdmU6ZXJyb3InLCB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpZCcpLCAncmVxdWlyZWQtZXJyb3InKVxuICB9LFxuXG4gIG9uU3VibWl0dGVkOiBmdW5jdGlvbiAodmlkZW9tYWlsKSB7XG4gICAgdmFyIGZvcm1Nb2RlbCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2FwcCcpLnJlcXVlc3QoJ2dldDpmb3JtJywgdGhpcy5nZXRGb3JtSWQoKSlcblxuICAgIGlmICghZm9ybU1vZGVsKSB7XG4gICAgICAvLyBmYWxsYmFjayBmb3Igb2xkZXIgdmVyc2lvbnNcbiAgICAgIGZvcm1Nb2RlbCA9IHRoaXMuZmllbGRNb2RlbC5jb2xsZWN0aW9uLm9wdGlvbnMuZm9ybU1vZGVsXG4gICAgfVxuXG4gICAgLy8gdG9kbyBpc24ndCAnZm9ybS0nICsgZm9ybU1vZGVsLmdldCgnaWQnKSB0aGUgc2FtZSBhcyB0aGUgZm9ybUlEIGFscmVhZHk/XG4gICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZm9ybS0nICsgZm9ybU1vZGVsLmdldCgnaWQnKSkucmVxdWVzdChcbiAgICAgICdhZGQ6ZXh0cmEnLFxuICAgICAgJ3ZpZGVvbWFpbCcsXG4gICAgICB2aWRlb21haWxcbiAgICApXG5cbiAgICAvLyByZXN0YXJ0IHN1Ym1pc3Npb24gYWdhaW4sIHRoaXMgdGltZSB0byB0aGUgcmVhbCB3cCBzaXRlXG4gICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZm9ybS0nICsgdGhpcy5nZXRGb3JtSWQoKSkucmVxdWVzdCgnc3VibWl0JywgZm9ybU1vZGVsKVxuICB9LFxuXG4gIG9uR29pbmdCYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgndmlkZW9tYWlsLWtleScsIG51bGwpXG4gICAgdGhpcy5pbnZhbGlkYXRlKClcbiAgfSxcblxuICB2YWxpZGF0ZVJlcXVpcmVkOiBmdW5jdGlvbiAoZWwsIGZpZWxkTW9kZWwpIHtcbiAgICB2YXIgdmFsaWQgPSB0aGlzLnZhbGlkYXRlVmlkZW9tYWlsKGZpZWxkTW9kZWwpXG5cbiAgICBpZiAoIXZhbGlkKSB7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKVxuICAgIH1cblxuICAgIHJldHVybiB2YWxpZFxuICB9LFxuXG4gIGludmFsaWRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBvdmVycmlkZSBkZWZhdWx0IGJlaGF2aW91ciBzbyB0aGF0IHdlIGNhbiBzZXQgb3VyIG93biBlcnJvciB0ZXh0IGhlcmVcbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmaWVsZHMnKS5yZXF1ZXN0KFxuICAgICAgJ2FkZDplcnJvcicsXG4gICAgICB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpZCcpLFxuICAgICAgJ3JlcXVpcmVkLWVycm9yJyxcbiAgICAgICdSZWNvcmQgYW5kIGNsaWNrIG9uIHN0b3AgdG8gc2VlIGEgcHJldmlldyB2aWRlby4nXG4gICAgKVxuICB9LFxuXG4gIHZhbGlkYXRlVmlkZW9tYWlsOiBmdW5jdGlvbiAoZmllbGRNb2RlbCkge1xuICAgIGZpZWxkTW9kZWwgPSBmaWVsZE1vZGVsIHx8IHRoaXMuZmllbGRNb2RlbFxuICAgIHJldHVybiBmaWVsZE1vZGVsLmdldCgndmlkZW9tYWlsLWtleScpIHx8IGZhbHNlXG4gIH0sXG5cbiAgaGFzRXJyb3JzOiBmdW5jdGlvbiAoZm9ybU1vZGVsKSB7XG4gICAgcmV0dXJuIGZvcm1Nb2RlbC5nZXQoJ2Vycm9ycycpLmxlbmd0aCA+IDBcbiAgfSxcblxuICBtYXliZVN1Ym1pdDogZnVuY3Rpb24gKGZvcm1Nb2RlbCkge1xuICAgIHZhciBtYXliZSA9IHRydWVcbiAgICB2YXIgdmlkZW9tYWlsU3VibWl0dGVkID0gZm9ybU1vZGVsLmdldEV4dHJhKCd2aWRlb21haWwnKVxuICAgIHZhciB2aWRlb21haWxSZWNvcmRlZCA9IHRoaXMudmFsaWRhdGVWaWRlb21haWwoKVxuICAgIHZhciBlcnJvcm5lb3VzID0gdGhpcy5oYXNFcnJvcnMoZm9ybU1vZGVsKVxuXG4gICAgLy8gaG9sZCBvbiB3aXRoIGZpbmFsIGZvcm0gc3VibWlzc2lvbiB3aGVuIG9uZSB3YXMgcmVjb3JkZWRcbiAgICAvLyBidXQgaGFzbid0IGJlZW4gc3VibWl0dGVkIHRvIHRoZSB2aWRlb21haWwgc2VydmVyIHlldFxuICAgIGlmICghdmlkZW9tYWlsU3VibWl0dGVkICYmICFlcnJvcm5lb3VzICYmIHZpZGVvbWFpbFJlY29yZGVkKSB7XG4gICAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5zdWJtaXQoKVxuICAgICAgbWF5YmUgPSBmYWxzZVxuICAgIH1cblxuICAgIHJldHVybiBtYXliZVxuICB9LFxuXG4gIGdldE1lcmdlVGFnVmFsdWU6IGZ1bmN0aW9uIChmaWVsZEtleSwgZm9ybVZhbHVlcykge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMuZmllbGRNb2RlbC5nZXQoZmllbGRLZXkpXG5cbiAgICAvLyBpdCBjYW4gaGFwcGVuIHRoYXQgdGhlIHVzZXIgaGFzIGNvbmZpZ3VyZWQgc29tZXRoaW5nIHdyb25nLFxuICAgIC8vIGkuRS4gYW4gZW1wdHkgZW1haWxfZnJvbS4gaW4gdGhhdCBjYXNlIGp1c3QgaWdub3JlIC4uLlxuICAgIGlmICh2YWx1ZSkge1xuICAgICAgLy8gYWRtaW4gZW1haWwgbG9jYWxpemVkIGZyb20gYmFja2VuZCwgYSBiaXQgdWdseVxuICAgICAgLy8gdG9kbyBhc2sgZm9yIGFuIGVuZHBvaW50IHRvIHByb2Nlc3MgdGhvc2Ugc3BlY2lhbCBtZXJnZSB0YWdzXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYmluYXJ5a2l0Y2hlbi92aWRlb21haWwtZm9yLW5pbmphLWZvcm1zL2lzc3Vlcy8zMFxuICAgICAgaWYgKHZhbHVlID09PSAne3dwOmFkbWluX2VtYWlsfScpIHtcbiAgICAgICAgdmFsdWUgPSB3aW5kb3cubmZWaWRlb21haWwuYWRtaW5fZW1haWxcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciByYXdGaWVsZEtleU1hdGNoZXMgPSB2YWx1ZS5tYXRjaCgve2ZpZWxkOiguKil9L2kpXG4gICAgICAgIHZhciByYXdGaWVsZEtleSA9IHJhd0ZpZWxkS2V5TWF0Y2hlcyAmJiByYXdGaWVsZEtleU1hdGNoZXNbMV1cblxuICAgICAgICBpZiAocmF3RmllbGRLZXkgIT09IHZhbHVlKSB7XG4gICAgICAgICAgLy8geWVzIGl0IHdhcyBhIG1lcmdlIHRhZywgc28gdXNlIGl0XG4gICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC97ZmllbGQ6KC4qKX0vaSwgZm9ybVZhbHVlc1tyYXdGaWVsZEtleV0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWVcbiAgfSxcblxuICAvLyByZXR1cm5zIGEgbWFwIGxpa2UgdGhpczpcbiAgLy8ge1xuICAvLyAgIGZyb21fZW1haWw6IFwibWljS0BkZWFmb256LmVoXCJcbiAgLy8gICBmcm9tX25hbWU6IFwiTUhcIlxuICAvLyAgIG1lc3NhZ2U6IFwic2Rmc2Rmc2RmXCJcbiAgLy8gICBzdWJqZWN0OiBcInNkZnNkZlwiXG4gIC8vICAgc3VibWl0OiBcIlwiXG4gIC8vICAgdmlkZW9fbWVzc2FnZTogXCIxMWViLTYxZDctZGQ1ODMzMjAtYWU2MS0yYjgyYmU2YzZlM2VcIlxuICAvLyB9XG4gIGdldEZvcm1WYWx1ZXM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgY29sbGVjdGlvblxuICAgIHZhciBmb3JtTW9kZWwgPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdhcHAnKS5yZXF1ZXN0KCdnZXQ6Zm9ybScsIHRoaXMuZ2V0Rm9ybUlkKCkpXG5cbiAgICBpZiAoZm9ybU1vZGVsKSB7XG4gICAgICBjb2xsZWN0aW9uID0gZm9ybU1vZGVsLmdldCgnZmllbGRzJylcbiAgICAgIC8vIGZhbGxiYWNrIGZvciBvbGRlciB2ZXJzaW9uc1xuICAgIH0gZWxzZSBpZiAodGhpcy5maWVsZE1vZGVsLmNvbGxlY3Rpb24ub3B0aW9ucy5mb3JtTW9kZWwuZ2V0KCdmaWVsZHMnKS5tb2RlbHMpIHtcbiAgICAgIGNvbGxlY3Rpb24gPSB0aGlzLmZpZWxkTW9kZWwuY29sbGVjdGlvbi5vcHRpb25zLmZvcm1Nb2RlbC5nZXQoJ2ZpZWxkcycpLm1vZGVsc1xuICAgIH1cblxuICAgIHJldHVybiBjb2xsZWN0aW9uLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZmllbGQpIHtcbiAgICAgIG1lbW9bZmllbGQuZ2V0KCdrZXknKV0gPSBmaWVsZC5nZXQoJ3ZhbHVlJylcbiAgICAgIHJldHVybiBtZW1vXG4gICAgfSwge30pXG4gIH0sXG5cbiAgYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nVG9WaWRlb21haWxTZXJ2ZXI6IGZ1bmN0aW9uICh2aWRlb21haWwsIGNiKSB7XG4gICAgdmFyIGZvcm1WYWx1ZXMgPSB0aGlzLmdldEZvcm1WYWx1ZXMoKVxuXG4gICAgdmlkZW9tYWlsLmZyb20gPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX2Zyb20nLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC50byA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfdG8nLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC5zdWJqZWN0ID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9zdWJqZWN0JywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwuYm9keSA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfYm9keScsIGZvcm1WYWx1ZXMpXG5cbiAgICBjYihudWxsLCB2aWRlb21haWwpXG4gIH0sXG5cbiAgb25CZWZvcmVEZXN0cm95OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy52aWRlb21haWxDbGllbnQudW5sb2FkKClcbiAgICBkZWxldGUgdGhpcy52aWRlb21haWxDbGllbnRcbiAgfVxufSlcblxualF1ZXJ5KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBuZXcgVmlkZW9tYWlsRmllbGRDb250cm9sbGVyKClcbn0pXG4iXSwibmFtZXMiOlsiREVCVUciLCJWaWRlb21haWxGaWVsZENvbnRyb2xsZXIiLCJNYXJpb25ldHRlIiwiT2JqZWN0IiwiZXh0ZW5kIiwidmlkZW9tYWlsQ2xpZW50IiwiZmllbGRNb2RlbCIsImNoYW5uZWwiLCJCYWNrYm9uZSIsIlJhZGlvIiwiaW5pdGlhbGl6ZSIsInRoaXMiLCJsaXN0ZW5UbyIsImV2ZW50TmFtZSIsImNvbnNvbGUiLCJsb2ciLCJyZWdpc3RlclZpZGVvbWFpbEZpZWxkIiwiZ2V0Rm9ybUlkIiwiZ2V0IiwibG9hZFZpZGVvbWFpbENsaWVudCIsInJlcGx5IiwidmFsaWRhdGVSZXF1aXJlZCIsInZhbGlkYXRlVmlkZW9tYWlsIiwibWF5YmVTdWJtaXQiLCJpbWFnZVF1YWxpdHlQZXJjZW50YWdlIiwidmVyYm9zZSIsIlZpZGVvbWFpbENsaWVudCIsInNpdGVOYW1lIiwidmlkZW8iLCJsaW1pdFNlY29uZHMiLCJ3aWR0aCIsImNvdW50ZG93biIsImF1ZGlvIiwiZW5hYmxlZCIsImltYWdlIiwicXVhbGl0eSIsInNlbGVjdG9ycyIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiY2FsbGJhY2tzIiwiYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nIiwiYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nVG9WaWRlb21haWxTZXJ2ZXIiLCJiaW5kIiwiZW5hYmxlQXV0b1ZhbGlkYXRpb24iLCJlbmFibGVBdXRvU3VibWlzc2lvbiIsIm9uIiwiZXZlbnRzIiwiUFJFVklFVyIsIm9uUHJldmlldyIsIlNVQk1JVFRFRCIsIm9uU3VibWl0dGVkIiwiR09JTkdfQkFDSyIsIm9uR29pbmdCYWNrIiwic2hvdyIsImtleSIsInNldCIsInJlcXVlc3QiLCJ2aWRlb21haWwiLCJmb3JtTW9kZWwiLCJjb2xsZWN0aW9uIiwib3B0aW9ucyIsImludmFsaWRhdGUiLCJlbCIsInZhbGlkIiwiaGFzRXJyb3JzIiwibGVuZ3RoIiwibWF5YmUiLCJ2aWRlb21haWxTdWJtaXR0ZWQiLCJnZXRFeHRyYSIsInZpZGVvbWFpbFJlY29yZGVkIiwiZXJyb3JuZW91cyIsInN1Ym1pdCIsImdldE1lcmdlVGFnVmFsdWUiLCJmaWVsZEtleSIsImZvcm1WYWx1ZXMiLCJ2YWx1ZSIsIndpbmRvdyIsIm5mVmlkZW9tYWlsIiwiYWRtaW5fZW1haWwiLCJyYXdGaWVsZEtleSIsInJhd0ZpZWxkS2V5TWF0Y2hlcyIsIm1hdGNoIiwicmVwbGFjZSIsImdldEZvcm1WYWx1ZXMiLCJtb2RlbHMiLCJyZWR1Y2UiLCJtZW1vIiwiZmllbGQiLCJjYiIsImZyb20iLCJ0byIsInN1YmplY3QiLCJib2R5Iiwib25CZWZvcmVEZXN0cm95IiwidW5sb2FkIiwialF1ZXJ5IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBSUEsT0FBUSxFQUtSQyx5QkFBMkJDLFdBQVdDLE9BQU9DLE9BQU8sQ0FDdERDLGdCQUFpQixLQUVqQkMsV0FBWSxLQUVaQyxRQUFTQyxTQUFTQyxNQUFNRixRQUFRLGFBRWhDRyxXQUFZLFdBQ1ZGLFNBQVNDLE1BQU1ULE1BQVFBLE1BR3ZC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
