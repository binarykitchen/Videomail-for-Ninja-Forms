var DEBUG=!1,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,channel:Backbone.Radio.channel("videomail"),initialize:function(){Backbone.Radio.DEBUG=DEBUG,this.listenTo(this.channel,"all",function(e){DEBUG&&console.log("Videomail channel event triggered:",e),this.listenTo(this.channel,"init:model",this.registerVideomailField)})},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(this.fieldModel=e,this.loadVideomailClient(),this.channel.reply("validate:required",this.validateRequired,this),this.channel.reply("validate:modelData",this.validateVideomail,this),Backbone.Radio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1);var i=this.fieldModel.get("verbose")||DEBUG;DEBUG=DEBUG||i,Backbone.Radio.DEBUG=Backbone.Radio.DEBUG||i,this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:i}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),this.fieldModel.set("value",e),Backbone.Radio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=i||this.fieldModel.collection.options.formModel;Backbone.Radio.channel("form-"+i.get("id")).request("add:extra","videomail",e),Backbone.Radio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){i=this.validateVideomail(i);return i||this.invalidate(),i},invalidate:function(){Backbone.Radio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),o=this.validateVideomail(),e=this.hasErrors(e);return t||e||!o||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t=this.fieldModel.get(e);return t&&("{wp:admin_email}"===t?t=window.nfVideomail.admin_email:(e=(e=t.match(/{field:(.*)}/i))&&e[1])!==t&&(t=t.replace(/{field:(.*)}/i,i[e]))),t},getFormValues:function(){var e,i=Backbone.Radio.channel("app").request("get:form",this.getFormId());return i?e=i.get("fields"):this.fieldModel.collection.options.formModel.get("fields").models&&(e=this.fieldModel.collection.options.formModel.get("fields").models),e.reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSBmYWxzZVxuXG4vLyBnb29kIGRvY3VtZW50YXRpb24gb24gYmFja2JvbmUgZXZlbnQgaGFuZGxpbmdcbi8vIGh0dHA6Ly9iYWNrYm9uZWpzLm9yZy8jRXZlbnRzXG5cbnZhciBWaWRlb21haWxGaWVsZENvbnRyb2xsZXIgPSBNYXJpb25ldHRlLk9iamVjdC5leHRlbmQoe1xuICB2aWRlb21haWxDbGllbnQ6IG51bGwsXG5cbiAgZmllbGRNb2RlbDogbnVsbCxcblxuICBjaGFubmVsOiBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgQmFja2JvbmUuUmFkaW8uREVCVUcgPSBERUJVR1xuXG4gICAgLy8gdWdseSB3b3JrYXJvdW5kIHRvIG1ha2UgaXQgd29yayB3aXRoIHRoZSBjb25kaXRpb25hbCBwbHVnaW5cbiAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2FsbCcsIGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIERFQlVHICYmIGNvbnNvbGUubG9nKCdWaWRlb21haWwgY2hhbm5lbCBldmVudCB0cmlnZ2VyZWQ6JywgZXZlbnROYW1lKVxuXG4gICAgICAvLyBvbmx5IHN0YXJ0IGxpc3RlbmluZyBhdCB0aGlzIHBvaW50LiBiZWNhdXNlIHRoZSBjb25kaXRpb25hbCBwbHVnaW5cbiAgICAgIC8vIGlzIHJlc2V0dGluZyBldmVudCBoYW5kbGVycy4gd2l0aG91dCB0aGUgYWJvdmUsIHdlJ2QgYmUgcmVnaXN0ZXJpbmdcbiAgICAgIC8vIHRvbyBlYXJseSBhbmQgdGhlIGNvbmRpdGlvbmFsIHBsdWdpbiBvdmVycmlkZXMuXG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2luaXQ6bW9kZWwnLCB0aGlzLnJlZ2lzdGVyVmlkZW9tYWlsRmllbGQpXG4gICAgfSlcbiAgfSxcblxuICBnZXRGb3JtSWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5maWVsZE1vZGVsLmdldCgnZm9ybUlEJylcbiAgfSxcblxuICByZWdpc3RlclZpZGVvbWFpbEZpZWxkOiBmdW5jdGlvbiAoZmllbGRNb2RlbCkge1xuICAgIC8vIHdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS93cG5pbmphcy9uaW5qYS1mb3Jtcy9pc3N1ZXMvMjY3NVxuICAgIC8vIGFsc28gcHJldmVudHMgZnJvbSBldmVudCBlbWl0dGVyIGxlYWtzIHVuZGVyIHJhY2UgY29uZGl0aW9uc1xuICAgIGlmICghdGhpcy52aWRlb21haWxDbGllbnQpIHtcbiAgICAgIHRoaXMuZmllbGRNb2RlbCA9IGZpZWxkTW9kZWxcblxuICAgICAgdGhpcy5sb2FkVmlkZW9tYWlsQ2xpZW50KClcblxuICAgICAgLy8gY3VzdG9tIGZpZWxkIHZhbGlkYXRpb24sIHNpbmNlIHdlIGFyZW4ndCB1c2luZyBhIHN0YW5kYXJkIGB2YWx1ZWBcbiAgICAgIC8vIGZvciB0aGUgdmlkZW9tYWlsIGlucHV0XG4gICAgICB0aGlzLmNoYW5uZWwucmVwbHkoJ3ZhbGlkYXRlOnJlcXVpcmVkJywgdGhpcy52YWxpZGF0ZVJlcXVpcmVkLCB0aGlzKVxuXG4gICAgICB0aGlzLmNoYW5uZWwucmVwbHkoJ3ZhbGlkYXRlOm1vZGVsRGF0YScsIHRoaXMudmFsaWRhdGVWaWRlb21haWwsIHRoaXMpXG5cbiAgICAgIC8vIGNvbnRyb2wgc3VibWlzc2lvbiBwcm9ncmVzcyxcbiAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIFBPU1QgdG8gdGhlIFZpZGVvbWFpbCBzZXJ2ZXIgZmlyc3RcbiAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIHRoaXMuZ2V0Rm9ybUlkKCkpLnJlcGx5KFxuICAgICAgICAnbWF5YmU6c3VibWl0JyxcbiAgICAgICAgdGhpcy5tYXliZVN1Ym1pdCxcbiAgICAgICAgdGhpcyxcbiAgICAgICAgZmllbGRNb2RlbFxuICAgICAgKVxuICAgIH1cbiAgfSxcblxuICBsb2FkVmlkZW9tYWlsQ2xpZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpbWFnZV9xdWFsaXR5JykgfHwgNDBcblxuICAgIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlID4gMTAwKSB7XG4gICAgICBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gMTAwXG4gICAgfSBlbHNlIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlIDwgMSkge1xuICAgICAgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IDFcbiAgICB9XG5cbiAgICB2YXIgdmVyYm9zZSA9IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3ZlcmJvc2UnKSB8fCBERUJVR1xuXG4gICAgLy8gbGF0ZSBvdmVycmlkZXNcbiAgICBERUJVRyA9IERFQlVHIHx8IHZlcmJvc2VcbiAgICBCYWNrYm9uZS5SYWRpby5ERUJVRyA9IEJhY2tib25lLlJhZGlvLkRFQlVHIHx8IHZlcmJvc2VcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50ID0gbmV3IFZpZGVvbWFpbENsaWVudCh7XG4gICAgICBzaXRlTmFtZTogdGhpcy5maWVsZE1vZGVsLmdldCgnc2l0ZV9uYW1lJyksXG4gICAgICB2aWRlbzoge1xuICAgICAgICBsaW1pdFNlY29uZHM6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2xpbWl0X3NlY29uZHMnKSB8fCA5MCxcbiAgICAgICAgd2lkdGg6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3dpZHRoJykgfHwgMzIwLFxuICAgICAgICBjb3VudGRvd246IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2NvdW50ZG93bicpIHx8IGZhbHNlXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgZW5hYmxlZDogdGhpcy5maWVsZE1vZGVsLmdldCgnYXVkaW9fZW5hYmxlZCcpXG4gICAgICB9LFxuICAgICAgaW1hZ2U6IHtcbiAgICAgICAgcXVhbGl0eTogaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSAvIDEwMCAvLyBtdXN0IGJlIGEgZmxvYXRcbiAgICAgIH0sXG4gICAgICBzZWxlY3RvcnM6IHtcbiAgICAgICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcuc3VibWl0LXdyYXAgaW5wdXQnXG4gICAgICB9LFxuICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgIC8vIHVnbHkgbmFtZSBlaD9cbiAgICAgICAgYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nOiB0aGlzLmFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyLmJpbmQoXG4gICAgICAgICAgdGhpc1xuICAgICAgICApXG4gICAgICB9LFxuICAgICAgLy8gbGVhdmUgaXQgdG8gbmluamEgZm9ybSB0byB2YWxpZGF0ZSB0aGUgaW5wdXRzXG4gICAgICBlbmFibGVBdXRvVmFsaWRhdGlvbjogZmFsc2UsXG4gICAgICAvLyBsZWF2ZSBpdCB0byBuaW5qYSBmb3JtIHRvIGRlYWwgd2l0aCBmb3JtIHN1Ym1pc3Npb25zXG4gICAgICBlbmFibGVBdXRvU3VibWlzc2lvbjogZmFsc2UsXG4gICAgICAvLyBsb2cgYWN0aW9ucy9ldmVudHMgdG8gY29uc29sZVxuICAgICAgdmVyYm9zZTogdmVyYm9zZVxuICAgIH0pXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5QUkVWSUVXLFxuICAgICAgdGhpcy5vblByZXZpZXcuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlNVQk1JVFRFRCxcbiAgICAgIHRoaXMub25TdWJtaXR0ZWQuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLkdPSU5HX0JBQ0ssXG4gICAgICB0aGlzLm9uR29pbmdCYWNrLmJpbmQodGhpcylcbiAgICApXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5zaG93KClcbiAgfSxcblxuICAvLyBuZWVkZWQgdG8gZ2V0IHRoZSB2aWRlb21haWwga2V5IHdoaWNoIGlzIHJlcXVpcmVkIGJlZm9yZVxuICAvLyBzdWJtaXR0aW5nIHRvIHRoZSB2aWRlb21haWwgc2VydmVyXG4gIG9uUHJldmlldzogZnVuY3Rpb24gKGtleSkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBrZXkpXG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgndmFsdWUnLCBrZXkpXG5cbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmaWVsZHMnKVxuICAgICAgLy8gY2xlYXJzIGFueSBwcmV2aW91cyBlcnJvcnNcbiAgICAgIC5yZXF1ZXN0KCdyZW1vdmU6ZXJyb3InLCB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpZCcpLCAncmVxdWlyZWQtZXJyb3InKVxuICB9LFxuXG4gIG9uU3VibWl0dGVkOiBmdW5jdGlvbiAodmlkZW9tYWlsKSB7XG4gICAgdmFyIGZvcm1Nb2RlbCAvLz0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnYXBwJykucmVxdWVzdCgnZ2V0OmZvcm0nLCB0aGlzLmdldEZvcm1JZCgpKVxuXG4gICAgaWYgKCFmb3JtTW9kZWwpIHtcbiAgICAgIC8vIGZhbGxiYWNrIGZvciBvbGRlciB2ZXJzaW9uc1xuICAgICAgZm9ybU1vZGVsID0gdGhpcy5maWVsZE1vZGVsLmNvbGxlY3Rpb24ub3B0aW9ucy5mb3JtTW9kZWxcbiAgICB9XG5cbiAgICAvLyB0b2RvIGlzbid0ICdmb3JtLScgKyBmb3JtTW9kZWwuZ2V0KCdpZCcpIHRoZSBzYW1lIGFzIHRoZSBmb3JtSUQgYWxyZWFkeT9cbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmb3JtLScgKyBmb3JtTW9kZWwuZ2V0KCdpZCcpKS5yZXF1ZXN0KFxuICAgICAgJ2FkZDpleHRyYScsXG4gICAgICAndmlkZW9tYWlsJyxcbiAgICAgIHZpZGVvbWFpbFxuICAgIClcblxuICAgIC8vIHJlc3RhcnQgc3VibWlzc2lvbiBhZ2FpbiwgdGhpcyB0aW1lIHRvIHRoZSByZWFsIHdwIHNpdGVcbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmb3JtLScgKyB0aGlzLmdldEZvcm1JZCgpKS5yZXF1ZXN0KCdzdWJtaXQnLCBmb3JtTW9kZWwpXG4gIH0sXG5cbiAgb25Hb2luZ0JhY2s6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZpZWxkTW9kZWwuc2V0KCd2aWRlb21haWwta2V5JywgbnVsbClcbiAgICB0aGlzLmludmFsaWRhdGUoKVxuICB9LFxuXG4gIHZhbGlkYXRlUmVxdWlyZWQ6IGZ1bmN0aW9uIChlbCwgZmllbGRNb2RlbCkge1xuICAgIHZhciB2YWxpZCA9IHRoaXMudmFsaWRhdGVWaWRlb21haWwoZmllbGRNb2RlbClcblxuICAgIGlmICghdmFsaWQpIHtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpXG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbGlkXG4gIH0sXG5cbiAgaW52YWxpZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIC8vIG92ZXJyaWRlIGRlZmF1bHQgYmVoYXZpb3VyIHNvIHRoYXQgd2UgY2FuIHNldCBvdXIgb3duIGVycm9yIHRleHQgaGVyZVxuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2ZpZWxkcycpLnJlcXVlc3QoXG4gICAgICAnYWRkOmVycm9yJyxcbiAgICAgIHRoaXMuZmllbGRNb2RlbC5nZXQoJ2lkJyksXG4gICAgICAncmVxdWlyZWQtZXJyb3InLFxuICAgICAgJ1JlY29yZCBhbmQgY2xpY2sgb24gc3RvcCB0byBzZWUgYSBwcmV2aWV3IHZpZGVvLidcbiAgICApXG4gIH0sXG5cbiAgdmFsaWRhdGVWaWRlb21haWw6IGZ1bmN0aW9uIChmaWVsZE1vZGVsKSB7XG4gICAgZmllbGRNb2RlbCA9IGZpZWxkTW9kZWwgfHwgdGhpcy5maWVsZE1vZGVsXG4gICAgcmV0dXJuIGZpZWxkTW9kZWwuZ2V0KCd2aWRlb21haWwta2V5JykgfHwgZmFsc2VcbiAgfSxcblxuICBoYXNFcnJvcnM6IGZ1bmN0aW9uIChmb3JtTW9kZWwpIHtcbiAgICByZXR1cm4gZm9ybU1vZGVsLmdldCgnZXJyb3JzJykubGVuZ3RoID4gMFxuICB9LFxuXG4gIG1heWJlU3VibWl0OiBmdW5jdGlvbiAoZm9ybU1vZGVsKSB7XG4gICAgdmFyIG1heWJlID0gdHJ1ZVxuICAgIHZhciB2aWRlb21haWxTdWJtaXR0ZWQgPSBmb3JtTW9kZWwuZ2V0RXh0cmEoJ3ZpZGVvbWFpbCcpXG4gICAgdmFyIHZpZGVvbWFpbFJlY29yZGVkID0gdGhpcy52YWxpZGF0ZVZpZGVvbWFpbCgpXG4gICAgdmFyIGVycm9ybmVvdXMgPSB0aGlzLmhhc0Vycm9ycyhmb3JtTW9kZWwpXG5cbiAgICAvLyBob2xkIG9uIHdpdGggZmluYWwgZm9ybSBzdWJtaXNzaW9uIHdoZW4gb25lIHdhcyByZWNvcmRlZFxuICAgIC8vIGJ1dCBoYXNuJ3QgYmVlbiBzdWJtaXR0ZWQgdG8gdGhlIHZpZGVvbWFpbCBzZXJ2ZXIgeWV0XG4gICAgaWYgKCF2aWRlb21haWxTdWJtaXR0ZWQgJiYgIWVycm9ybmVvdXMgJiYgdmlkZW9tYWlsUmVjb3JkZWQpIHtcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LnN1Ym1pdCgpXG4gICAgICBtYXliZSA9IGZhbHNlXG4gICAgfVxuXG4gICAgcmV0dXJuIG1heWJlXG4gIH0sXG5cbiAgZ2V0TWVyZ2VUYWdWYWx1ZTogZnVuY3Rpb24gKGZpZWxkS2V5LCBmb3JtVmFsdWVzKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5maWVsZE1vZGVsLmdldChmaWVsZEtleSlcblxuICAgIC8vIGl0IGNhbiBoYXBwZW4gdGhhdCB0aGUgdXNlciBoYXMgY29uZmlndXJlZCBzb21ldGhpbmcgd3JvbmcsXG4gICAgLy8gaS5FLiBhbiBlbXB0eSBlbWFpbF9mcm9tLiBpbiB0aGF0IGNhc2UganVzdCBpZ25vcmUgLi4uXG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICAvLyBhZG1pbiBlbWFpbCBsb2NhbGl6ZWQgZnJvbSBiYWNrZW5kLCBhIGJpdCB1Z2x5XG4gICAgICAvLyB0b2RvIGFzayBmb3IgYW4gZW5kcG9pbnQgdG8gcHJvY2VzcyB0aG9zZSBzcGVjaWFsIG1lcmdlIHRhZ3NcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9iaW5hcnlraXRjaGVuL3ZpZGVvbWFpbC1mb3ItbmluamEtZm9ybXMvaXNzdWVzLzMwXG4gICAgICBpZiAodmFsdWUgPT09ICd7d3A6YWRtaW5fZW1haWx9Jykge1xuICAgICAgICB2YWx1ZSA9IHdpbmRvdy5uZlZpZGVvbWFpbC5hZG1pbl9lbWFpbFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHJhd0ZpZWxkS2V5TWF0Y2hlcyA9IHZhbHVlLm1hdGNoKC97ZmllbGQ6KC4qKX0vaSlcbiAgICAgICAgdmFyIHJhd0ZpZWxkS2V5ID0gcmF3RmllbGRLZXlNYXRjaGVzICYmIHJhd0ZpZWxkS2V5TWF0Y2hlc1sxXVxuXG4gICAgICAgIGlmIChyYXdGaWVsZEtleSAhPT0gdmFsdWUpIHtcbiAgICAgICAgICAvLyB5ZXMgaXQgd2FzIGEgbWVyZ2UgdGFnLCBzbyB1c2UgaXRcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3tmaWVsZDooLiopfS9pLCBmb3JtVmFsdWVzW3Jhd0ZpZWxkS2V5XSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZVxuICB9LFxuXG4gIC8vIHJldHVybnMgYSBtYXAgbGlrZSB0aGlzOlxuICAvLyB7XG4gIC8vICAgZnJvbV9lbWFpbDogXCJtaWNLQGRlYWZvbnouZWhcIlxuICAvLyAgIGZyb21fbmFtZTogXCJNSFwiXG4gIC8vICAgbWVzc2FnZTogXCJzZGZzZGZzZGZcIlxuICAvLyAgIHN1YmplY3Q6IFwic2Rmc2RmXCJcbiAgLy8gICBzdWJtaXQ6IFwiXCJcbiAgLy8gICB2aWRlb19tZXNzYWdlOiBcIjExZWItNjFkNy1kZDU4MzMyMC1hZTYxLTJiODJiZTZjNmUzZVwiXG4gIC8vIH1cbiAgZ2V0Rm9ybVZhbHVlczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBjb2xsZWN0aW9uXG4gICAgdmFyIGZvcm1Nb2RlbCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2FwcCcpLnJlcXVlc3QoJ2dldDpmb3JtJywgdGhpcy5nZXRGb3JtSWQoKSlcblxuICAgIGlmIChmb3JtTW9kZWwpIHtcbiAgICAgIGNvbGxlY3Rpb24gPSBmb3JtTW9kZWwuZ2V0KCdmaWVsZHMnKVxuICAgICAgLy8gZmFsbGJhY2sgZm9yIG9sZGVyIHZlcnNpb25zXG4gICAgfSBlbHNlIGlmICh0aGlzLmZpZWxkTW9kZWwuY29sbGVjdGlvbi5vcHRpb25zLmZvcm1Nb2RlbC5nZXQoJ2ZpZWxkcycpLm1vZGVscykge1xuICAgICAgY29sbGVjdGlvbiA9IHRoaXMuZmllbGRNb2RlbC5jb2xsZWN0aW9uLm9wdGlvbnMuZm9ybU1vZGVsLmdldCgnZmllbGRzJykubW9kZWxzXG4gICAgfVxuXG4gICAgcmV0dXJuIGNvbGxlY3Rpb24ucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBmaWVsZCkge1xuICAgICAgbWVtb1tmaWVsZC5nZXQoJ2tleScpXSA9IGZpZWxkLmdldCgndmFsdWUnKVxuICAgICAgcmV0dXJuIG1lbW9cbiAgICB9LCB7fSlcbiAgfSxcblxuICBhZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmdUb1ZpZGVvbWFpbFNlcnZlcjogZnVuY3Rpb24gKHZpZGVvbWFpbCwgY2IpIHtcbiAgICB2YXIgZm9ybVZhbHVlcyA9IHRoaXMuZ2V0Rm9ybVZhbHVlcygpXG5cbiAgICB2aWRlb21haWwuZnJvbSA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfZnJvbScsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLnRvID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF90bycsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLnN1YmplY3QgPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX3N1YmplY3QnLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC5ib2R5ID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9ib2R5JywgZm9ybVZhbHVlcylcblxuICAgIGNiKG51bGwsIHZpZGVvbWFpbClcbiAgfSxcblxuICBvbkJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC51bmxvYWQoKVxuICAgIGRlbGV0ZSB0aGlzLnZpZGVvbWFpbENsaWVudFxuICB9XG59KVxuXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIG5ldyBWaWRlb21haWxGaWVsZENvbnRyb2xsZXIoKVxufSlcbiJdLCJuYW1lcyI6WyJERUJVRyIsIlZpZGVvbWFpbEZpZWxkQ29udHJvbGxlciIsIk1hcmlvbmV0dGUiLCJPYmplY3QiLCJleHRlbmQiLCJ2aWRlb21haWxDbGllbnQiLCJmaWVsZE1vZGVsIiwiY2hhbm5lbCIsIkJhY2tib25lIiwiUmFkaW8iLCJpbml0aWFsaXplIiwidGhpcyIsImxpc3RlblRvIiwiZXZlbnROYW1lIiwiY29uc29sZSIsImxvZyIsInJlZ2lzdGVyVmlkZW9tYWlsRmllbGQiLCJnZXRGb3JtSWQiLCJnZXQiLCJsb2FkVmlkZW9tYWlsQ2xpZW50IiwicmVwbHkiLCJ2YWxpZGF0ZVJlcXVpcmVkIiwidmFsaWRhdGVWaWRlb21haWwiLCJtYXliZVN1Ym1pdCIsImltYWdlUXVhbGl0eVBlcmNlbnRhZ2UiLCJ2ZXJib3NlIiwiVmlkZW9tYWlsQ2xpZW50Iiwic2l0ZU5hbWUiLCJ2aWRlbyIsImxpbWl0U2Vjb25kcyIsIndpZHRoIiwiY291bnRkb3duIiwiYXVkaW8iLCJlbmFibGVkIiwiaW1hZ2UiLCJxdWFsaXR5Iiwic2VsZWN0b3JzIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJjYWxsYmFja3MiLCJhZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmciLCJhZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmdUb1ZpZGVvbWFpbFNlcnZlciIsImJpbmQiLCJlbmFibGVBdXRvVmFsaWRhdGlvbiIsImVuYWJsZUF1dG9TdWJtaXNzaW9uIiwib24iLCJldmVudHMiLCJQUkVWSUVXIiwib25QcmV2aWV3IiwiU1VCTUlUVEVEIiwib25TdWJtaXR0ZWQiLCJHT0lOR19CQUNLIiwib25Hb2luZ0JhY2siLCJzaG93Iiwia2V5Iiwic2V0IiwicmVxdWVzdCIsInZpZGVvbWFpbCIsImZvcm1Nb2RlbCIsImNvbGxlY3Rpb24iLCJvcHRpb25zIiwiaW52YWxpZGF0ZSIsImVsIiwidmFsaWQiLCJoYXNFcnJvcnMiLCJsZW5ndGgiLCJtYXliZSIsInZpZGVvbWFpbFN1Ym1pdHRlZCIsImdldEV4dHJhIiwidmlkZW9tYWlsUmVjb3JkZWQiLCJlcnJvcm5lb3VzIiwic3VibWl0IiwiZ2V0TWVyZ2VUYWdWYWx1ZSIsImZpZWxkS2V5IiwiZm9ybVZhbHVlcyIsInZhbHVlIiwid2luZG93IiwibmZWaWRlb21haWwiLCJhZG1pbl9lbWFpbCIsInJhd0ZpZWxkS2V5IiwicmF3RmllbGRLZXlNYXRjaGVzIiwibWF0Y2giLCJyZXBsYWNlIiwiZ2V0Rm9ybVZhbHVlcyIsIm1vZGVscyIsInJlZHVjZSIsIm1lbW8iLCJmaWVsZCIsImNiIiwiZnJvbSIsInRvIiwic3ViamVjdCIsImJvZHkiLCJvbkJlZm9yZURlc3Ryb3kiLCJ1bmxvYWQiLCJqUXVlcnkiLCJkb2N1bWVudCIsInJlYWR5Il0sIm1hcHBpbmdzIjoiQUFDQSxJQUFJQSxPQUFRLEVBS1JDLHlCQUEyQkMsV0FBV0MsT0FBT0MsT0FBTyxDQUN0REMsZ0JBQWlCLEtBRWpCQyxXQUFZLEtBRVpDLFFBQVNDLFNBQVNDLE1BQU1GLFFBQVEsYUFFaENHLFdBQVksV0FDVkYsU0FBU0MsTUFBTVQsTUFBUUEsTUFH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
