var DEBUG=!0,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,initialize:function(){Backbone.Radio.DEBUG=DEBUG,this.listenTo(Backbone.Radio.channel("videomail"),"all",function(e){console.log("Event triggered:",e)}),this.listenTo(Backbone.Radio.channel("videomail"),"init:model",this.registerVideomailField)},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(this.fieldModel=e,this.loadVideomailClient(),Backbone.Radio.channel("videomail").reply("validate:required",this.validateRequired,this),Backbone.Radio.channel("videomail").reply("validate:modelData",this.validateVideomail,this),Backbone.Radio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1),this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:this.fieldModel.get("verbose")||DEBUG}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),Backbone.Radio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=nfRadio.channel("app").request("get:form",this.getFormId());nfRadio.channel("form-"+i.get("id")).request("add:extra","videomail",e),nfRadio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){i=this.validateVideomail(i);return i||this.invalidate(),i},invalidate:function(){Backbone.Radio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),o=this.validateVideomail(),e=this.hasErrors(e);return t||e||!o||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t=this.fieldModel.get(e);return t&&("{wp:admin_email}"===t?t=window.nfVideomail.admin_email:(e=(e=t.match(/{field:(.*)}/i))&&e[1])!==t&&(t=t.replace(/{field:(.*)}/i,i[e]))),t},getFormValues:function(){return Backbone.Radio.channel("app").request("get:form",this.getFormId()).get("fields").reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSB0cnVlXG5cbi8vIGdvb2QgZG9jdW1lbnRhdGlvbiBvbiBiYWNrYm9uZSBldmVudCBoYW5kbGluZ1xuLy8gaHR0cDovL2JhY2tib25lanMub3JnLyNFdmVudHNcblxudmFyIFZpZGVvbWFpbEZpZWxkQ29udHJvbGxlciA9IE1hcmlvbmV0dGUuT2JqZWN0LmV4dGVuZCh7XG4gIHZpZGVvbWFpbENsaWVudDogbnVsbCxcblxuICAvLyBub3Qgc3VyZSBpZiB0aGlzIGlzIGEgZ29vZCBpZGVhLCBidXQgaSBuZWVkIGEgcmVmZXJlbmNlIHRvIGl0XG4gIGZpZWxkTW9kZWw6IG51bGwsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkge1xuICAgIEJhY2tib25lLlJhZGlvLkRFQlVHID0gREVCVUdcblxuICAgIC8vIGlmIChERUJVRykge1xuICAgIHRoaXMubGlzdGVuVG8oQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgndmlkZW9tYWlsJyksICdhbGwnLCBmdW5jdGlvbiAoZXZlbnROYW1lKSB7XG4gICAgICBjb25zb2xlLmxvZygnRXZlbnQgdHJpZ2dlcmVkOicsIGV2ZW50TmFtZSlcbiAgICB9KVxuICAgIC8vIH1cblxuICAgIHRoaXMubGlzdGVuVG8oXG4gICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKSxcbiAgICAgICdpbml0Om1vZGVsJyxcbiAgICAgIHRoaXMucmVnaXN0ZXJWaWRlb21haWxGaWVsZFxuICAgIClcbiAgfSxcblxuICBnZXRGb3JtSWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5maWVsZE1vZGVsLmdldCgnZm9ybUlEJylcbiAgfSxcblxuICByZWdpc3RlclZpZGVvbWFpbEZpZWxkOiBmdW5jdGlvbiAoZmllbGRNb2RlbCkge1xuICAgIC8vIHdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS93cG5pbmphcy9uaW5qYS1mb3Jtcy9pc3N1ZXMvMjY3NVxuICAgIC8vIGFsc28gcHJldmVudHMgZnJvbSBldmVudCBlbWl0dGVyIGxlYWtzIHVuZGVyIHJhY2UgY29uZGl0aW9uc1xuICAgIGlmICghdGhpcy52aWRlb21haWxDbGllbnQpIHtcbiAgICAgIHRoaXMuZmllbGRNb2RlbCA9IGZpZWxkTW9kZWxcblxuICAgICAgdGhpcy5sb2FkVmlkZW9tYWlsQ2xpZW50KClcblxuICAgICAgLy8gY3VzdG9tIGZpZWxkIHZhbGlkYXRpb24sIHNpbmNlIHdlIGFyZW4ndCB1c2luZyBhIHN0YW5kYXJkIGB2YWx1ZWBcbiAgICAgIC8vIGZvciB0aGUgdmlkZW9tYWlsIGlucHV0XG4gICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKS5yZXBseShcbiAgICAgICAgJ3ZhbGlkYXRlOnJlcXVpcmVkJyxcbiAgICAgICAgdGhpcy52YWxpZGF0ZVJlcXVpcmVkLFxuICAgICAgICB0aGlzXG4gICAgICApXG5cbiAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ3ZpZGVvbWFpbCcpLnJlcGx5KFxuICAgICAgICAndmFsaWRhdGU6bW9kZWxEYXRhJyxcbiAgICAgICAgdGhpcy52YWxpZGF0ZVZpZGVvbWFpbCxcbiAgICAgICAgdGhpc1xuICAgICAgKVxuXG4gICAgICAvLyBjb250cm9sIHN1Ym1pc3Npb24gcHJvZ3Jlc3MsXG4gICAgICAvLyBzbyB0aGF0IHdlIGNhbiBQT1NUIHRvIHRoZSBWaWRlb21haWwgc2VydmVyIGZpcnN0XG4gICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmb3JtLScgKyB0aGlzLmdldEZvcm1JZCgpKS5yZXBseShcbiAgICAgICAgJ21heWJlOnN1Ym1pdCcsXG4gICAgICAgIHRoaXMubWF5YmVTdWJtaXQsXG4gICAgICAgIHRoaXMsXG4gICAgICAgIGZpZWxkTW9kZWxcbiAgICAgIClcbiAgICB9XG4gIH0sXG5cbiAgbG9hZFZpZGVvbWFpbENsaWVudDogZnVuY3Rpb24gKCkge1xuICAgIHZhciBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gdGhpcy5maWVsZE1vZGVsLmdldCgnaW1hZ2VfcXVhbGl0eScpIHx8IDQwXG5cbiAgICBpZiAoaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA+IDEwMCkge1xuICAgICAgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IDEwMFxuICAgIH0gZWxzZSBpZiAoaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA8IDEpIHtcbiAgICAgIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSAxXG4gICAgfVxuXG4gICAgdGhpcy52aWRlb21haWxDbGllbnQgPSBuZXcgVmlkZW9tYWlsQ2xpZW50KHtcbiAgICAgIHNpdGVOYW1lOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdzaXRlX25hbWUnKSxcbiAgICAgIHZpZGVvOiB7XG4gICAgICAgIGxpbWl0U2Vjb25kczogdGhpcy5maWVsZE1vZGVsLmdldCgnbGltaXRfc2Vjb25kcycpIHx8IDkwLFxuICAgICAgICB3aWR0aDogdGhpcy5maWVsZE1vZGVsLmdldCgnd2lkdGgnKSB8fCAzMjAsXG4gICAgICAgIGNvdW50ZG93bjogdGhpcy5maWVsZE1vZGVsLmdldCgnY291bnRkb3duJykgfHwgZmFsc2VcbiAgICAgIH0sXG4gICAgICBhdWRpbzoge1xuICAgICAgICBlbmFibGVkOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdhdWRpb19lbmFibGVkJylcbiAgICAgIH0sXG4gICAgICBpbWFnZToge1xuICAgICAgICBxdWFsaXR5OiBpbWFnZVF1YWxpdHlQZXJjZW50YWdlIC8gMTAwIC8vIG11c3QgYmUgYSBmbG9hdFxuICAgICAgfSxcbiAgICAgIHNlbGVjdG9yczoge1xuICAgICAgICBzdWJtaXRCdXR0b25TZWxlY3RvcjogJy5zdWJtaXQtd3JhcCBpbnB1dCdcbiAgICAgIH0sXG4gICAgICBjYWxsYmFja3M6IHtcbiAgICAgICAgLy8gdWdseSBuYW1lIGVoP1xuICAgICAgICBhZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3Rpbmc6IHRoaXMuYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nVG9WaWRlb21haWxTZXJ2ZXIuYmluZChcbiAgICAgICAgICB0aGlzXG4gICAgICAgIClcbiAgICAgIH0sXG4gICAgICAvLyBsZWF2ZSBpdCB0byBuaW5qYSBmb3JtIHRvIHZhbGlkYXRlIHRoZSBpbnB1dHNcbiAgICAgIGVuYWJsZUF1dG9WYWxpZGF0aW9uOiBmYWxzZSxcbiAgICAgIC8vIGxlYXZlIGl0IHRvIG5pbmphIGZvcm0gdG8gZGVhbCB3aXRoIGZvcm0gc3VibWlzc2lvbnNcbiAgICAgIGVuYWJsZUF1dG9TdWJtaXNzaW9uOiBmYWxzZSxcbiAgICAgIC8vIGxvZyBhY3Rpb25zL2V2ZW50cyB0byBjb25zb2xlXG4gICAgICB2ZXJib3NlOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCd2ZXJib3NlJykgfHwgREVCVUdcbiAgICB9KVxuXG4gICAgdGhpcy52aWRlb21haWxDbGllbnQub24oXG4gICAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5ldmVudHMuUFJFVklFVyxcbiAgICAgIHRoaXMub25QcmV2aWV3LmJpbmQodGhpcylcbiAgICApXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5TVUJNSVRURUQsXG4gICAgICB0aGlzLm9uU3VibWl0dGVkLmJpbmQodGhpcylcbiAgICApXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5HT0lOR19CQUNLLFxuICAgICAgdGhpcy5vbkdvaW5nQmFjay5iaW5kKHRoaXMpXG4gICAgKVxuXG4gICAgdGhpcy52aWRlb21haWxDbGllbnQuc2hvdygpXG4gIH0sXG5cbiAgLy8gbmVlZGVkIHRvIGdldCB0aGUgdmlkZW9tYWlsIGtleSB3aGljaCBpcyByZXF1aXJlZCBiZWZvcmVcbiAgLy8gc3VibWl0dGluZyB0byB0aGUgdmlkZW9tYWlsIHNlcnZlclxuICBvblByZXZpZXc6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICB0aGlzLmZpZWxkTW9kZWwuc2V0KCd2aWRlb21haWwta2V5Jywga2V5KVxuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2ZpZWxkcycpXG4gICAgICAvLyBjbGVhcnMgYW55IHByZXZpb3VzIGVycm9yc1xuICAgICAgLnJlcXVlc3QoJ3JlbW92ZTplcnJvcicsIHRoaXMuZmllbGRNb2RlbC5nZXQoJ2lkJyksICdyZXF1aXJlZC1lcnJvcicpXG4gIH0sXG5cbiAgb25TdWJtaXR0ZWQ6IGZ1bmN0aW9uICh2aWRlb21haWwpIHtcbiAgICB2YXIgZm9ybU1vZGVsID0gbmZSYWRpby5jaGFubmVsKCdhcHAnKS5yZXF1ZXN0KCdnZXQ6Zm9ybScsIHRoaXMuZ2V0Rm9ybUlkKCkpXG5cbiAgICAvLyB0b2RvIGlzbid0ICdmb3JtLScgKyBmb3JtTW9kZWwuZ2V0KCdpZCcpIHRoZSBzYW1lIGFzIHRoZSBmb3JtSUQgYWxyZWFkeT9cbiAgICBuZlJhZGlvXG4gICAgICAuY2hhbm5lbCgnZm9ybS0nICsgZm9ybU1vZGVsLmdldCgnaWQnKSlcbiAgICAgIC5yZXF1ZXN0KCdhZGQ6ZXh0cmEnLCAndmlkZW9tYWlsJywgdmlkZW9tYWlsKVxuXG4gICAgLy8gcmVzdGFydCBzdWJtaXNzaW9uIGFnYWluLCB0aGlzIHRpbWUgdG8gdGhlIHJlYWwgd3Agc2l0ZVxuICAgIG5mUmFkaW8uY2hhbm5lbCgnZm9ybS0nICsgdGhpcy5nZXRGb3JtSWQoKSkucmVxdWVzdCgnc3VibWl0JywgZm9ybU1vZGVsKVxuICB9LFxuXG4gIG9uR29pbmdCYWNrOiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgndmlkZW9tYWlsLWtleScsIG51bGwpXG4gICAgdGhpcy5pbnZhbGlkYXRlKClcbiAgfSxcblxuICB2YWxpZGF0ZVJlcXVpcmVkOiBmdW5jdGlvbiAoZWwsIGZpZWxkTW9kZWwpIHtcbiAgICB2YXIgdmFsaWQgPSB0aGlzLnZhbGlkYXRlVmlkZW9tYWlsKGZpZWxkTW9kZWwpXG5cbiAgICBpZiAoIXZhbGlkKSB7XG4gICAgICB0aGlzLmludmFsaWRhdGUoKVxuICAgIH1cblxuICAgIHJldHVybiB2YWxpZFxuICB9LFxuXG4gIGludmFsaWRhdGU6IGZ1bmN0aW9uICgpIHtcbiAgICAvLyBvdmVycmlkZSBkZWZhdWx0IGJlaGF2aW91ciBzbyB0aGF0IHdlIGNhbiBzZXQgb3VyIG93biBlcnJvciB0ZXh0IGhlcmVcbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmaWVsZHMnKS5yZXF1ZXN0KFxuICAgICAgJ2FkZDplcnJvcicsXG4gICAgICB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpZCcpLFxuICAgICAgJ3JlcXVpcmVkLWVycm9yJyxcbiAgICAgICdSZWNvcmQgYW5kIGNsaWNrIG9uIHN0b3AgdG8gc2VlIGEgcHJldmlldyB2aWRlby4nXG4gICAgKVxuICB9LFxuXG4gIHZhbGlkYXRlVmlkZW9tYWlsOiBmdW5jdGlvbiAoZmllbGRNb2RlbCkge1xuICAgIGZpZWxkTW9kZWwgPSBmaWVsZE1vZGVsIHx8IHRoaXMuZmllbGRNb2RlbFxuICAgIHJldHVybiBmaWVsZE1vZGVsLmdldCgndmlkZW9tYWlsLWtleScpIHx8IGZhbHNlXG4gIH0sXG5cbiAgaGFzRXJyb3JzOiBmdW5jdGlvbiAoZm9ybU1vZGVsKSB7XG4gICAgcmV0dXJuIGZvcm1Nb2RlbC5nZXQoJ2Vycm9ycycpLmxlbmd0aCA+IDBcbiAgfSxcblxuICBtYXliZVN1Ym1pdDogZnVuY3Rpb24gKGZvcm1Nb2RlbCkge1xuICAgIHZhciBtYXliZSA9IHRydWVcbiAgICB2YXIgdmlkZW9tYWlsU3VibWl0dGVkID0gZm9ybU1vZGVsLmdldEV4dHJhKCd2aWRlb21haWwnKVxuICAgIHZhciB2aWRlb21haWxSZWNvcmRlZCA9IHRoaXMudmFsaWRhdGVWaWRlb21haWwoKVxuICAgIHZhciBlcnJvcm5lb3VzID0gdGhpcy5oYXNFcnJvcnMoZm9ybU1vZGVsKVxuXG4gICAgLy8gaG9sZCBvbiB3aXRoIGZpbmFsIGZvcm0gc3VibWlzc2lvbiB3aGVuIG9uZSB3YXMgcmVjb3JkZWRcbiAgICAvLyBidXQgaGFzbid0IGJlZW4gc3VibWl0dGVkIHRvIHRoZSB2aWRlb21haWwgc2VydmVyIHlldFxuICAgIGlmICghdmlkZW9tYWlsU3VibWl0dGVkICYmICFlcnJvcm5lb3VzICYmIHZpZGVvbWFpbFJlY29yZGVkKSB7XG4gICAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5zdWJtaXQoKVxuICAgICAgbWF5YmUgPSBmYWxzZVxuICAgIH1cblxuICAgIHJldHVybiBtYXliZVxuICB9LFxuXG4gIGdldE1lcmdlVGFnVmFsdWU6IGZ1bmN0aW9uIChmaWVsZEtleSwgZm9ybVZhbHVlcykge1xuICAgIHZhciB2YWx1ZSA9IHRoaXMuZmllbGRNb2RlbC5nZXQoZmllbGRLZXkpXG5cbiAgICAvLyBpdCBjYW4gaGFwcGVuIHRoYXQgdGhlIHVzZXIgaGFzIGNvbmZpZ3VyZWQgc29tZXRoaW5nIHdyb25nLFxuICAgIC8vIGkuRS4gYW4gZW1wdHkgZW1haWxfZnJvbS4gaW4gdGhhdCBjYXNlIGp1c3QgaWdub3JlIC4uLlxuICAgIGlmICh2YWx1ZSkge1xuICAgICAgLy8gYWRtaW4gZW1haWwgbG9jYWxpemVkIGZyb20gYmFja2VuZCwgYSBiaXQgdWdseVxuICAgICAgLy8gdG9kbyBhc2sgZm9yIGFuIGVuZHBvaW50IHRvIHByb2Nlc3MgdGhvc2Ugc3BlY2lhbCBtZXJnZSB0YWdzXG4gICAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vYmluYXJ5a2l0Y2hlbi92aWRlb21haWwtZm9yLW5pbmphLWZvcm1zL2lzc3Vlcy8zMFxuICAgICAgaWYgKHZhbHVlID09PSAne3dwOmFkbWluX2VtYWlsfScpIHtcbiAgICAgICAgdmFsdWUgPSB3aW5kb3cubmZWaWRlb21haWwuYWRtaW5fZW1haWxcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHZhciByYXdGaWVsZEtleU1hdGNoZXMgPSB2YWx1ZS5tYXRjaCgve2ZpZWxkOiguKil9L2kpXG4gICAgICAgIHZhciByYXdGaWVsZEtleSA9IHJhd0ZpZWxkS2V5TWF0Y2hlcyAmJiByYXdGaWVsZEtleU1hdGNoZXNbMV1cblxuICAgICAgICBpZiAocmF3RmllbGRLZXkgIT09IHZhbHVlKSB7XG4gICAgICAgICAgLy8geWVzIGl0IHdhcyBhIG1lcmdlIHRhZywgc28gdXNlIGl0XG4gICAgICAgICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC97ZmllbGQ6KC4qKX0vaSwgZm9ybVZhbHVlc1tyYXdGaWVsZEtleV0pXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG5cbiAgICByZXR1cm4gdmFsdWVcbiAgfSxcblxuICBnZXRGb3JtVmFsdWVzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGZvcm1Nb2RlbCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2FwcCcpLnJlcXVlc3QoJ2dldDpmb3JtJywgdGhpcy5nZXRGb3JtSWQoKSlcbiAgICB2YXIgZmllbGRzQ29sbGVjdGlvbiA9IGZvcm1Nb2RlbC5nZXQoJ2ZpZWxkcycpXG5cbiAgICByZXR1cm4gZmllbGRzQ29sbGVjdGlvbi5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGZpZWxkKSB7XG4gICAgICBtZW1vW2ZpZWxkLmdldCgna2V5JyldID0gZmllbGQuZ2V0KCd2YWx1ZScpXG4gICAgICByZXR1cm4gbWVtb1xuICAgIH0sIHt9KVxuICB9LFxuXG4gIGFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyOiBmdW5jdGlvbiAodmlkZW9tYWlsLCBjYikge1xuICAgIHZhciBmb3JtVmFsdWVzID0gdGhpcy5nZXRGb3JtVmFsdWVzKClcblxuICAgIHZpZGVvbWFpbC5mcm9tID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9mcm9tJywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwudG8gPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX3RvJywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwuc3ViamVjdCA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfc3ViamVjdCcsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLmJvZHkgPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX2JvZHknLCBmb3JtVmFsdWVzKVxuXG4gICAgY2IobnVsbCwgdmlkZW9tYWlsKVxuICB9LFxuXG4gIG9uQmVmb3JlRGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LnVubG9hZCgpXG4gICAgZGVsZXRlIHRoaXMudmlkZW9tYWlsQ2xpZW50XG4gIH1cbn0pXG5cbmpRdWVyeShkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gbmV3IFZpZGVvbWFpbEZpZWxkQ29udHJvbGxlcigpXG59KVxuIl0sIm5hbWVzIjpbIkRFQlVHIiwiVmlkZW9tYWlsRmllbGRDb250cm9sbGVyIiwiTWFyaW9uZXR0ZSIsIk9iamVjdCIsImV4dGVuZCIsInZpZGVvbWFpbENsaWVudCIsImZpZWxkTW9kZWwiLCJpbml0aWFsaXplIiwiQmFja2JvbmUiLCJSYWRpbyIsInRoaXMiLCJsaXN0ZW5UbyIsImNoYW5uZWwiLCJldmVudE5hbWUiLCJjb25zb2xlIiwibG9nIiwicmVnaXN0ZXJWaWRlb21haWxGaWVsZCIsImdldEZvcm1JZCIsImdldCIsImxvYWRWaWRlb21haWxDbGllbnQiLCJyZXBseSIsInZhbGlkYXRlUmVxdWlyZWQiLCJ2YWxpZGF0ZVZpZGVvbWFpbCIsIm1heWJlU3VibWl0IiwiaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSIsIlZpZGVvbWFpbENsaWVudCIsInNpdGVOYW1lIiwidmlkZW8iLCJsaW1pdFNlY29uZHMiLCJ3aWR0aCIsImNvdW50ZG93biIsImF1ZGlvIiwiZW5hYmxlZCIsImltYWdlIiwicXVhbGl0eSIsInNlbGVjdG9ycyIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiY2FsbGJhY2tzIiwiYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nIiwiYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nVG9WaWRlb21haWxTZXJ2ZXIiLCJiaW5kIiwiZW5hYmxlQXV0b1ZhbGlkYXRpb24iLCJlbmFibGVBdXRvU3VibWlzc2lvbiIsInZlcmJvc2UiLCJvbiIsImV2ZW50cyIsIlBSRVZJRVciLCJvblByZXZpZXciLCJTVUJNSVRURUQiLCJvblN1Ym1pdHRlZCIsIkdPSU5HX0JBQ0siLCJvbkdvaW5nQmFjayIsInNob3ciLCJrZXkiLCJzZXQiLCJyZXF1ZXN0IiwidmlkZW9tYWlsIiwiZm9ybU1vZGVsIiwibmZSYWRpbyIsImludmFsaWRhdGUiLCJlbCIsInZhbGlkIiwiaGFzRXJyb3JzIiwibGVuZ3RoIiwibWF5YmUiLCJ2aWRlb21haWxTdWJtaXR0ZWQiLCJnZXRFeHRyYSIsInZpZGVvbWFpbFJlY29yZGVkIiwiZXJyb3JuZW91cyIsInN1Ym1pdCIsImdldE1lcmdlVGFnVmFsdWUiLCJmaWVsZEtleSIsImZvcm1WYWx1ZXMiLCJ2YWx1ZSIsIndpbmRvdyIsIm5mVmlkZW9tYWlsIiwiYWRtaW5fZW1haWwiLCJyYXdGaWVsZEtleSIsInJhd0ZpZWxkS2V5TWF0Y2hlcyIsIm1hdGNoIiwicmVwbGFjZSIsImdldEZvcm1WYWx1ZXMiLCJyZWR1Y2UiLCJtZW1vIiwiZmllbGQiLCJjYiIsImZyb20iLCJ0byIsInN1YmplY3QiLCJib2R5Iiwib25CZWZvcmVEZXN0cm95IiwidW5sb2FkIiwialF1ZXJ5IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBSUEsT0FBUSxFQUtSQyx5QkFBMkJDLFdBQVdDLE9BQU9DLE9BQU8sQ0FDdERDLGdCQUFpQixLQUdqQkMsV0FBWSxLQUVaQyxXQUFZLFdBQ1ZDLFNBQVNDLE1BQU1ULE1BQVFBLE1BR3ZCVSxLQUFLQyxTQUFTSCxTQUFTQyxNQUFNRyxRQUFRLGFBQWMsTUFBTyxTQUFVQyxHQUNsRUMsUUFBUUMsSUFBSSxtQkFBb0JGLEtBSWxD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
