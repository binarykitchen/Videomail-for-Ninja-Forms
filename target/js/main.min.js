var DEBUG=!1,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,initialize:function(){Backbone.Radio.DEBUG=DEBUG,this.listenTo(Backbone.Radio.channel("videomail"),"init:model",this.registerVideomailField)},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(this.fieldModel=e,this.loadVideomailClient(),Backbone.Radio.channel("videomail").reply("validate:required",this.validateRequired,this),Backbone.Radio.channel("videomail").reply("validate:modelData",this.validateVideomail,this),Backbone.Radio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1),this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:this.fieldModel.get("verbose")||DEBUG}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),Backbone.Radio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=nfRadio.channel("app").request("get:form",this.getFormId());nfRadio.channel("form-"+i.get("id")).request("add:extra","videomail",e),nfRadio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){var t=this.validateVideomail(i);return t||this.invalidate(),t},invalidate:function(){Backbone.Radio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),o=this.validateVideomail(),l=this.hasErrors(e);return t||l||!o||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t,o,l=this.fieldModel.get(e);return l&&("{wp:admin_email}"===l?l=window.nfVideomail.admin_email:(o=(t=l.match(/{field:(.*)}/i))&&t[1])!==l&&(l=l.replace(/{field:(.*)}/i,i[o]))),l},getFormValues:function(){return Backbone.Radio.channel("app").request("get:form",this.getFormId()).get("fields").reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSBmYWxzZVxuXG4vLyBnb29kIGRvY3VtZW50YXRpb24gb24gYmFja2JvbmUgZXZlbnQgaGFuZGxpbmdcbi8vIGh0dHA6Ly9iYWNrYm9uZWpzLm9yZy8jRXZlbnRzXG5cbnZhciBWaWRlb21haWxGaWVsZENvbnRyb2xsZXIgPSBNYXJpb25ldHRlLk9iamVjdC5leHRlbmQoe1xuICB2aWRlb21haWxDbGllbnQ6IG51bGwsXG5cbiAgLy8gbm90IHN1cmUgaWYgdGhpcyBpcyBhIGdvb2QgaWRlYSwgYnV0IGkgbmVlZCBhIHJlZmVyZW5jZSB0byBpdFxuICBmaWVsZE1vZGVsOiBudWxsLFxuXG4gIGluaXRpYWxpemU6IGZ1bmN0aW9uICgpIHtcbiAgICBCYWNrYm9uZS5SYWRpby5ERUJVRyA9IERFQlVHXG5cbiAgICB0aGlzLmxpc3RlblRvKFxuICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgndmlkZW9tYWlsJyksXG4gICAgICAnaW5pdDptb2RlbCcsXG4gICAgICB0aGlzLnJlZ2lzdGVyVmlkZW9tYWlsRmllbGRcbiAgICApXG4gIH0sXG5cbiAgZ2V0Rm9ybUlkOiBmdW5jdGlvbiAoKSB7XG4gICAgcmV0dXJuIHRoaXMuZmllbGRNb2RlbC5nZXQoJ2Zvcm1JRCcpXG4gIH0sXG5cbiAgcmVnaXN0ZXJWaWRlb21haWxGaWVsZDogZnVuY3Rpb24gKGZpZWxkTW9kZWwpIHtcbiAgICAvLyB3b3JrYXJvdW5kIGZvciBodHRwczovL2dpdGh1Yi5jb20vd3BuaW5qYXMvbmluamEtZm9ybXMvaXNzdWVzLzI2NzVcbiAgICAvLyBhbHNvIHByZXZlbnRzIGZyb20gZXZlbnQgZW1pdHRlciBsZWFrcyB1bmRlciByYWNlIGNvbmRpdGlvbnNcbiAgICBpZiAoIXRoaXMudmlkZW9tYWlsQ2xpZW50KSB7XG4gICAgICB0aGlzLmZpZWxkTW9kZWwgPSBmaWVsZE1vZGVsXG5cbiAgICAgIHRoaXMubG9hZFZpZGVvbWFpbENsaWVudCgpXG5cbiAgICAgIC8vIGN1c3RvbSBmaWVsZCB2YWxpZGF0aW9uLCBzaW5jZSB3ZSBhcmVuJ3QgdXNpbmcgYSBzdGFuZGFyZCBgdmFsdWVgXG4gICAgICAvLyBmb3IgdGhlIHZpZGVvbWFpbCBpbnB1dFxuICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgndmlkZW9tYWlsJykucmVwbHkoXG4gICAgICAgICd2YWxpZGF0ZTpyZXF1aXJlZCcsXG4gICAgICAgIHRoaXMudmFsaWRhdGVSZXF1aXJlZCxcbiAgICAgICAgdGhpc1xuICAgICAgKVxuXG4gICAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKS5yZXBseShcbiAgICAgICAgJ3ZhbGlkYXRlOm1vZGVsRGF0YScsXG4gICAgICAgIHRoaXMudmFsaWRhdGVWaWRlb21haWwsXG4gICAgICAgIHRoaXNcbiAgICAgIClcblxuICAgICAgLy8gY29udHJvbCBzdWJtaXNzaW9uIHByb2dyZXNzLFxuICAgICAgLy8gc28gdGhhdCB3ZSBjYW4gUE9TVCB0byB0aGUgVmlkZW9tYWlsIHNlcnZlciBmaXJzdFxuICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZm9ybS0nICsgdGhpcy5nZXRGb3JtSWQoKSkucmVwbHkoXG4gICAgICAgICdtYXliZTpzdWJtaXQnLFxuICAgICAgICB0aGlzLm1heWJlU3VibWl0LFxuICAgICAgICB0aGlzLFxuICAgICAgICBmaWVsZE1vZGVsXG4gICAgICApXG4gICAgfVxuICB9LFxuXG4gIGxvYWRWaWRlb21haWxDbGllbnQ6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2ltYWdlX3F1YWxpdHknKSB8fCA0MFxuXG4gICAgaWYgKGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPiAxMDApIHtcbiAgICAgIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSAxMDBcbiAgICB9IGVsc2UgaWYgKGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPCAxKSB7XG4gICAgICBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gMVxuICAgIH1cblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50ID0gbmV3IFZpZGVvbWFpbENsaWVudCh7XG4gICAgICBzaXRlTmFtZTogdGhpcy5maWVsZE1vZGVsLmdldCgnc2l0ZV9uYW1lJyksXG4gICAgICB2aWRlbzoge1xuICAgICAgICBsaW1pdFNlY29uZHM6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2xpbWl0X3NlY29uZHMnKSB8fCA5MCxcbiAgICAgICAgd2lkdGg6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3dpZHRoJykgfHwgMzIwLFxuICAgICAgICBjb3VudGRvd246IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2NvdW50ZG93bicpIHx8IGZhbHNlXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgZW5hYmxlZDogdGhpcy5maWVsZE1vZGVsLmdldCgnYXVkaW9fZW5hYmxlZCcpXG4gICAgICB9LFxuICAgICAgaW1hZ2U6IHtcbiAgICAgICAgcXVhbGl0eTogaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSAvIDEwMCAvLyBtdXN0IGJlIGEgZmxvYXRcbiAgICAgIH0sXG4gICAgICBzZWxlY3RvcnM6IHtcbiAgICAgICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcuc3VibWl0LXdyYXAgaW5wdXQnXG4gICAgICB9LFxuICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgIC8vIHVnbHkgbmFtZSBlaD9cbiAgICAgICAgYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nOiB0aGlzLmFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyLmJpbmQoXG4gICAgICAgICAgdGhpc1xuICAgICAgICApXG4gICAgICB9LFxuICAgICAgLy8gbGVhdmUgaXQgdG8gbmluamEgZm9ybSB0byB2YWxpZGF0ZSB0aGUgaW5wdXRzXG4gICAgICBlbmFibGVBdXRvVmFsaWRhdGlvbjogZmFsc2UsXG4gICAgICAvLyBsZWF2ZSBpdCB0byBuaW5qYSBmb3JtIHRvIGRlYWwgd2l0aCBmb3JtIHN1Ym1pc3Npb25zXG4gICAgICBlbmFibGVBdXRvU3VibWlzc2lvbjogZmFsc2UsXG4gICAgICAvLyBsb2cgYWN0aW9ucy9ldmVudHMgdG8gY29uc29sZVxuICAgICAgdmVyYm9zZTogdGhpcy5maWVsZE1vZGVsLmdldCgndmVyYm9zZScpIHx8IERFQlVHXG4gICAgfSlcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlBSRVZJRVcsXG4gICAgICB0aGlzLm9uUHJldmlldy5iaW5kKHRoaXMpXG4gICAgKVxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlNVQk1JVFRFRCxcbiAgICAgIHRoaXMub25TdWJtaXR0ZWQuYmluZCh0aGlzKVxuICAgIClcbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5HT0lOR19CQUNLLFxuICAgICAgdGhpcy5vbkdvaW5nQmFjay5iaW5kKHRoaXMpXG4gICAgKVxuXG4gICAgdGhpcy52aWRlb21haWxDbGllbnQuc2hvdygpXG4gIH0sXG5cbiAgLy8gbmVlZGVkIHRvIGdldCB0aGUgdmlkZW9tYWlsIGtleSB3aGljaCBpcyByZXF1aXJlZCBiZWZvcmVcbiAgLy8gc3VibWl0dGluZyB0byB0aGUgdmlkZW9tYWlsIHNlcnZlclxuICBvblByZXZpZXc6IGZ1bmN0aW9uIChrZXkpIHtcbiAgICB0aGlzLmZpZWxkTW9kZWwuc2V0KCd2aWRlb21haWwta2V5Jywga2V5KVxuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2ZpZWxkcycpXG4gICAgICAvLyBjbGVhcnMgYW55IHByZXZpb3VzIGVycm9yc1xuICAgICAgLnJlcXVlc3QoJ3JlbW92ZTplcnJvcicsIHRoaXMuZmllbGRNb2RlbC5nZXQoJ2lkJyksICdyZXF1aXJlZC1lcnJvcicpXG4gIH0sXG5cbiAgb25TdWJtaXR0ZWQ6IGZ1bmN0aW9uICh2aWRlb21haWwpIHtcbiAgICB2YXIgZm9ybU1vZGVsID0gbmZSYWRpby5jaGFubmVsKCdhcHAnKS5yZXF1ZXN0KCdnZXQ6Zm9ybScsIHRoaXMuZ2V0Rm9ybUlkKCkpXG5cbiAgICAvLyB0b2RvIGlzbnQgJ2Zvcm0tJyArIGZvcm1Nb2RlbC5nZXQoJ2lkJykgdGhlIHNhbWUgYXMgdGhlIGZvcm1JRCBhbHJlYWR5P1xuICAgIG5mUmFkaW9cbiAgICAgIC5jaGFubmVsKCdmb3JtLScgKyBmb3JtTW9kZWwuZ2V0KCdpZCcpKVxuICAgICAgLnJlcXVlc3QoJ2FkZDpleHRyYScsICd2aWRlb21haWwnLCB2aWRlb21haWwpXG5cbiAgICAvLyByZXN0YXJ0IHN1Ym1pc3Npb24gYWdhaW4sIHRoaXMgdGltZSB0byB0aGUgcmVhbCB3cCBzaXRlXG4gICAgbmZSYWRpby5jaGFubmVsKCdmb3JtLScgKyB0aGlzLmdldEZvcm1JZCgpKS5yZXF1ZXN0KCdzdWJtaXQnLCBmb3JtTW9kZWwpXG4gIH0sXG5cbiAgb25Hb2luZ0JhY2s6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZpZWxkTW9kZWwuc2V0KCd2aWRlb21haWwta2V5JywgbnVsbClcbiAgICB0aGlzLmludmFsaWRhdGUoKVxuICB9LFxuXG4gIHZhbGlkYXRlUmVxdWlyZWQ6IGZ1bmN0aW9uIChlbCwgZmllbGRNb2RlbCkge1xuICAgIHZhciB2YWxpZCA9IHRoaXMudmFsaWRhdGVWaWRlb21haWwoZmllbGRNb2RlbClcblxuICAgIGlmICghdmFsaWQpIHtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpXG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbGlkXG4gIH0sXG5cbiAgaW52YWxpZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIC8vIG92ZXJyaWRlIGRlZmF1bHQgYmVoYXZpb3VyIHNvIHRoYXQgd2UgY2FuIHNldCBvdXIgb3duIGVycm9yIHRleHQgaGVyZVxuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2ZpZWxkcycpLnJlcXVlc3QoXG4gICAgICAnYWRkOmVycm9yJyxcbiAgICAgIHRoaXMuZmllbGRNb2RlbC5nZXQoJ2lkJyksXG4gICAgICAncmVxdWlyZWQtZXJyb3InLFxuICAgICAgJ1JlY29yZCBhbmQgY2xpY2sgb24gc3RvcCB0byBzZWUgYSBwcmV2aWV3IHZpZGVvLidcbiAgICApXG4gIH0sXG5cbiAgdmFsaWRhdGVWaWRlb21haWw6IGZ1bmN0aW9uIChmaWVsZE1vZGVsKSB7XG4gICAgZmllbGRNb2RlbCA9IGZpZWxkTW9kZWwgfHwgdGhpcy5maWVsZE1vZGVsXG4gICAgcmV0dXJuIGZpZWxkTW9kZWwuZ2V0KCd2aWRlb21haWwta2V5JykgfHwgZmFsc2VcbiAgfSxcblxuICBoYXNFcnJvcnM6IGZ1bmN0aW9uIChmb3JtTW9kZWwpIHtcbiAgICByZXR1cm4gZm9ybU1vZGVsLmdldCgnZXJyb3JzJykubGVuZ3RoID4gMFxuICB9LFxuXG4gIG1heWJlU3VibWl0OiBmdW5jdGlvbiAoZm9ybU1vZGVsKSB7XG4gICAgdmFyIG1heWJlID0gdHJ1ZVxuICAgIHZhciB2aWRlb21haWxTdWJtaXR0ZWQgPSBmb3JtTW9kZWwuZ2V0RXh0cmEoJ3ZpZGVvbWFpbCcpXG4gICAgdmFyIHZpZGVvbWFpbFJlY29yZGVkID0gdGhpcy52YWxpZGF0ZVZpZGVvbWFpbCgpXG4gICAgdmFyIGVycm9ybmVvdXMgPSB0aGlzLmhhc0Vycm9ycyhmb3JtTW9kZWwpXG5cbiAgICAvLyBob2xkIG9uIHdpdGggZmluYWwgZm9ybSBzdWJtaXNzaW9uIHdoZW4gb25lIHdhcyByZWNvcmRlZFxuICAgIC8vIGJ1dCBoYXNuJ3QgYmVlbiBzdWJtaXR0ZWQgdG8gdGhlIHZpZGVvbWFpbCBzZXJ2ZXIgeWV0XG4gICAgaWYgKCF2aWRlb21haWxTdWJtaXR0ZWQgJiYgIWVycm9ybmVvdXMgJiYgdmlkZW9tYWlsUmVjb3JkZWQpIHtcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LnN1Ym1pdCgpXG4gICAgICBtYXliZSA9IGZhbHNlXG4gICAgfVxuXG4gICAgcmV0dXJuIG1heWJlXG4gIH0sXG5cbiAgZ2V0TWVyZ2VUYWdWYWx1ZTogZnVuY3Rpb24gKGZpZWxkS2V5LCBmb3JtVmFsdWVzKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5maWVsZE1vZGVsLmdldChmaWVsZEtleSlcblxuICAgIC8vIGl0IGNhbiBoYXBwZW4gdGhhdCB0aGUgdXNlciBoYXMgY29uZmlndXJlZCBzb21ldGhpbmcgd3JvbmcsXG4gICAgLy8gaS5FLiBhbiBlbXB0eSBlbWFpbF9mcm9tLiBpbiB0aGF0IGNhc2UganVzdCBpZ25vcmUgLi4uXG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICAvLyBhZG1pbiBlbWFpbCBsb2NhbGl6ZWQgZnJvbSBiYWNrZW5kLCBhIGJpdCB1Z2x5XG4gICAgICAvLyB0b2RvIGFzayBmb3IgYW4gZW5kcG9pbnQgdG8gcHJvY2VzcyB0aG9zZSBzcGVjaWFsIG1lcmdlIHRhZ3NcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9iaW5hcnlraXRjaGVuL3ZpZGVvbWFpbC1mb3ItbmluamEtZm9ybXMvaXNzdWVzLzMwXG4gICAgICBpZiAodmFsdWUgPT09ICd7d3A6YWRtaW5fZW1haWx9Jykge1xuICAgICAgICB2YWx1ZSA9IHdpbmRvdy5uZlZpZGVvbWFpbC5hZG1pbl9lbWFpbFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHJhd0ZpZWxkS2V5TWF0Y2hlcyA9IHZhbHVlLm1hdGNoKC97ZmllbGQ6KC4qKX0vaSlcbiAgICAgICAgdmFyIHJhd0ZpZWxkS2V5ID0gcmF3RmllbGRLZXlNYXRjaGVzICYmIHJhd0ZpZWxkS2V5TWF0Y2hlc1sxXVxuXG4gICAgICAgIGlmIChyYXdGaWVsZEtleSAhPT0gdmFsdWUpIHtcbiAgICAgICAgICAvLyB5ZXMgaXQgd2FzIGEgbWVyZ2UgdGFnLCBzbyB1c2UgaXRcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3tmaWVsZDooLiopfS9pLCBmb3JtVmFsdWVzW3Jhd0ZpZWxkS2V5XSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZVxuICB9LFxuXG4gIGdldEZvcm1WYWx1ZXM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZm9ybU1vZGVsID0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnYXBwJykucmVxdWVzdCgnZ2V0OmZvcm0nLCB0aGlzLmdldEZvcm1JZCgpKVxuICAgIHZhciBmaWVsZHNDb2xsZWN0aW9uID0gZm9ybU1vZGVsLmdldCgnZmllbGRzJylcblxuICAgIHJldHVybiBmaWVsZHNDb2xsZWN0aW9uLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZmllbGQpIHtcbiAgICAgIG1lbW9bZmllbGQuZ2V0KCdrZXknKV0gPSBmaWVsZC5nZXQoJ3ZhbHVlJylcbiAgICAgIHJldHVybiBtZW1vXG4gICAgfSwge30pXG4gIH0sXG5cbiAgYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nVG9WaWRlb21haWxTZXJ2ZXI6IGZ1bmN0aW9uICh2aWRlb21haWwsIGNiKSB7XG4gICAgdmFyIGZvcm1WYWx1ZXMgPSB0aGlzLmdldEZvcm1WYWx1ZXMoKVxuXG4gICAgdmlkZW9tYWlsLmZyb20gPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX2Zyb20nLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC50byA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfdG8nLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC5zdWJqZWN0ID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9zdWJqZWN0JywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwuYm9keSA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfYm9keScsIGZvcm1WYWx1ZXMpXG5cbiAgICBjYihudWxsLCB2aWRlb21haWwpXG4gIH0sXG5cbiAgb25CZWZvcmVEZXN0cm95OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy52aWRlb21haWxDbGllbnQudW5sb2FkKClcbiAgICBkZWxldGUgdGhpcy52aWRlb21haWxDbGllbnRcbiAgfVxufSlcblxualF1ZXJ5KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBuZXcgVmlkZW9tYWlsRmllbGRDb250cm9sbGVyKClcbn0pXG4iXSwibmFtZXMiOlsiREVCVUciLCJWaWRlb21haWxGaWVsZENvbnRyb2xsZXIiLCJNYXJpb25ldHRlIiwiT2JqZWN0IiwiZXh0ZW5kIiwidmlkZW9tYWlsQ2xpZW50IiwiZmllbGRNb2RlbCIsImluaXRpYWxpemUiLCJCYWNrYm9uZSIsIlJhZGlvIiwidGhpcyIsImxpc3RlblRvIiwiY2hhbm5lbCIsInJlZ2lzdGVyVmlkZW9tYWlsRmllbGQiLCJnZXRGb3JtSWQiLCJnZXQiLCJsb2FkVmlkZW9tYWlsQ2xpZW50IiwicmVwbHkiLCJ2YWxpZGF0ZVJlcXVpcmVkIiwidmFsaWRhdGVWaWRlb21haWwiLCJtYXliZVN1Ym1pdCIsImltYWdlUXVhbGl0eVBlcmNlbnRhZ2UiLCJWaWRlb21haWxDbGllbnQiLCJzaXRlTmFtZSIsInZpZGVvIiwibGltaXRTZWNvbmRzIiwid2lkdGgiLCJjb3VudGRvd24iLCJhdWRpbyIsImVuYWJsZWQiLCJpbWFnZSIsInF1YWxpdHkiLCJzZWxlY3RvcnMiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImNhbGxiYWNrcyIsImFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZyIsImFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyIiwiYmluZCIsImVuYWJsZUF1dG9WYWxpZGF0aW9uIiwiZW5hYmxlQXV0b1N1Ym1pc3Npb24iLCJ2ZXJib3NlIiwib24iLCJldmVudHMiLCJQUkVWSUVXIiwib25QcmV2aWV3IiwiU1VCTUlUVEVEIiwib25TdWJtaXR0ZWQiLCJHT0lOR19CQUNLIiwib25Hb2luZ0JhY2siLCJzaG93Iiwia2V5Iiwic2V0IiwicmVxdWVzdCIsInZpZGVvbWFpbCIsImZvcm1Nb2RlbCIsIm5mUmFkaW8iLCJpbnZhbGlkYXRlIiwiZWwiLCJ2YWxpZCIsImhhc0Vycm9ycyIsImxlbmd0aCIsIm1heWJlIiwidmlkZW9tYWlsU3VibWl0dGVkIiwiZ2V0RXh0cmEiLCJ2aWRlb21haWxSZWNvcmRlZCIsImVycm9ybmVvdXMiLCJzdWJtaXQiLCJnZXRNZXJnZVRhZ1ZhbHVlIiwiZmllbGRLZXkiLCJmb3JtVmFsdWVzIiwicmF3RmllbGRLZXlNYXRjaGVzIiwicmF3RmllbGRLZXkiLCJ2YWx1ZSIsIndpbmRvdyIsIm5mVmlkZW9tYWlsIiwiYWRtaW5fZW1haWwiLCJtYXRjaCIsInJlcGxhY2UiLCJnZXRGb3JtVmFsdWVzIiwicmVkdWNlIiwibWVtbyIsImZpZWxkIiwiY2IiLCJmcm9tIiwidG8iLCJzdWJqZWN0IiwiYm9keSIsIm9uQmVmb3JlRGVzdHJveSIsInVubG9hZCIsImpRdWVyeSIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiJBQUNBLElBQUlBLE9BQVEsRUFLUkMseUJBQTJCQyxXQUFXQyxPQUFPQyxPQUFPLENBQ3REQyxnQkFBaUIsS0FHakJDLFdBQVksS0FFWkMsV0FBWSxXQUNWQyxTQUFTQyxNQUFNVCxNQUFRQSxNQUV2QlUsS0FBS0MsU0FDSEgsU0FBU0MsTUFBTUcsUUFBUSxhQUN2QixhQUNBRixLQUFLRyx5QkFJVEMsVUFBVyxXQUNULE9BQU9KLEtBQUtKLFdBQVdTLElBQUksV0FHN0JGLHVCQUF3QixTQUFVUCxHQUczQkksS0FBS0wsa0JBQ1JLLEtBQUtKLFdBQWFBLEVBRWxCSSxLQUFLTSxzQkFJTFIsU0FBU0MsTUFBTUcsUUFBUSxhQUFhSyxNQUNsQyxvQkFDQVAsS0FBS1EsaUJBQ0xSLE1BR0ZGLFNBQVNDLE1BQU1HLFFBQVEsYUFBYUssTUFDbEMscUJBQ0FQLEtBQUtTLGtCQUNMVCxNQUtGRixTQUFTQyxNQUFNRyxRQUFR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
