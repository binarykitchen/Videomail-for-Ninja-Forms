var DEBUG=!1,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,channel:Backbone.Radio.channel("videomail"),initialize:function(){Backbone.Radio.DEBUG=DEBUG,this.listenTo(this.channel,"all",function(e){DEBUG&&console.log("Videomail channel event triggered:",e),this.listenTo(this.channel,"init:model",this.registerVideomailField)})},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(this.fieldModel=e,this.loadVideomailClient(),this.channel.reply("validate:required",this.validateRequired,this),this.channel.reply("validate:modelData",this.validateVideomail,this),Backbone.Radio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1),this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:this.fieldModel.get("verbose")||DEBUG}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),this.fieldModel.set("value",e),Backbone.Radio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=Backbone.Radio.channel("app").request("get:form",this.getFormId());Backbone.Radio.channel("form-"+i.get("id")).request("add:extra","videomail",e),Backbone.Radio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){i=this.validateVideomail(i);return i||this.invalidate(),i},invalidate:function(){Backbone.Radio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),o=this.validateVideomail(),e=this.hasErrors(e);return t||e||!o||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t=this.fieldModel.get(e);return t&&("{wp:admin_email}"===t?t=window.nfVideomail.admin_email:(e=(e=t.match(/{field:(.*)}/i))&&e[1])!==t&&(t=t.replace(/{field:(.*)}/i,i[e]))),t},getFormValues:function(){return Backbone.Radio.channel("app").request("get:form",this.getFormId()).get("fields").reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSBmYWxzZVxuXG4vLyBnb29kIGRvY3VtZW50YXRpb24gb24gYmFja2JvbmUgZXZlbnQgaGFuZGxpbmdcbi8vIGh0dHA6Ly9iYWNrYm9uZWpzLm9yZy8jRXZlbnRzXG5cbnZhciBWaWRlb21haWxGaWVsZENvbnRyb2xsZXIgPSBNYXJpb25ldHRlLk9iamVjdC5leHRlbmQoe1xuICB2aWRlb21haWxDbGllbnQ6IG51bGwsXG5cbiAgZmllbGRNb2RlbDogbnVsbCxcblxuICBjaGFubmVsOiBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgQmFja2JvbmUuUmFkaW8uREVCVUcgPSBERUJVR1xuXG4gICAgLy8gdWdseSB3b3JrYXJvdW5kIHRvIG1ha2UgaXQgd29yayB3aXRoIHRoZSBjb25kaXRpb25hbCBwbHVnaW5cbiAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2FsbCcsIGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIERFQlVHICYmIGNvbnNvbGUubG9nKCdWaWRlb21haWwgY2hhbm5lbCBldmVudCB0cmlnZ2VyZWQ6JywgZXZlbnROYW1lKVxuXG4gICAgICAvLyBvbmx5IHN0YXJ0IGxpc3RlbmluZyBhdCB0aGlzIHBvaW50LiBiZWNhdXNlIHRoZSBjb25kaXRpb25hbCBwbHVnaW5cbiAgICAgIC8vIGlzIHJlc2V0dGluZyBldmVudCBoYW5kbGVycy4gd2l0aG91dCB0aGUgYWJvdmUsIHdlJ2QgYmUgcmVnaXN0ZXJpbmdcbiAgICAgIC8vIHRvbyBlYXJseSBhbmQgdGhlIGNvbmRpdGlvbmFsIHBsdWdpbiBvdmVycmlkZXMuXG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2luaXQ6bW9kZWwnLCB0aGlzLnJlZ2lzdGVyVmlkZW9tYWlsRmllbGQpXG4gICAgfSlcbiAgfSxcblxuICBnZXRGb3JtSWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5maWVsZE1vZGVsLmdldCgnZm9ybUlEJylcbiAgfSxcblxuICByZWdpc3RlclZpZGVvbWFpbEZpZWxkOiBmdW5jdGlvbiAoZmllbGRNb2RlbCkge1xuICAgIC8vIHdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS93cG5pbmphcy9uaW5qYS1mb3Jtcy9pc3N1ZXMvMjY3NVxuICAgIC8vIGFsc28gcHJldmVudHMgZnJvbSBldmVudCBlbWl0dGVyIGxlYWtzIHVuZGVyIHJhY2UgY29uZGl0aW9uc1xuICAgIGlmICghdGhpcy52aWRlb21haWxDbGllbnQpIHtcbiAgICAgIHRoaXMuZmllbGRNb2RlbCA9IGZpZWxkTW9kZWxcblxuICAgICAgdGhpcy5sb2FkVmlkZW9tYWlsQ2xpZW50KClcblxuICAgICAgLy8gY3VzdG9tIGZpZWxkIHZhbGlkYXRpb24sIHNpbmNlIHdlIGFyZW4ndCB1c2luZyBhIHN0YW5kYXJkIGB2YWx1ZWBcbiAgICAgIC8vIGZvciB0aGUgdmlkZW9tYWlsIGlucHV0XG4gICAgICB0aGlzLmNoYW5uZWwucmVwbHkoJ3ZhbGlkYXRlOnJlcXVpcmVkJywgdGhpcy52YWxpZGF0ZVJlcXVpcmVkLCB0aGlzKVxuXG4gICAgICB0aGlzLmNoYW5uZWwucmVwbHkoJ3ZhbGlkYXRlOm1vZGVsRGF0YScsIHRoaXMudmFsaWRhdGVWaWRlb21haWwsIHRoaXMpXG5cbiAgICAgIC8vIGNvbnRyb2wgc3VibWlzc2lvbiBwcm9ncmVzcyxcbiAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIFBPU1QgdG8gdGhlIFZpZGVvbWFpbCBzZXJ2ZXIgZmlyc3RcbiAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIHRoaXMuZ2V0Rm9ybUlkKCkpLnJlcGx5KFxuICAgICAgICAnbWF5YmU6c3VibWl0JyxcbiAgICAgICAgdGhpcy5tYXliZVN1Ym1pdCxcbiAgICAgICAgdGhpcyxcbiAgICAgICAgZmllbGRNb2RlbFxuICAgICAgKVxuICAgIH1cbiAgfSxcblxuICBsb2FkVmlkZW9tYWlsQ2xpZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpbWFnZV9xdWFsaXR5JykgfHwgNDBcblxuICAgIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlID4gMTAwKSB7XG4gICAgICBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gMTAwXG4gICAgfSBlbHNlIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlIDwgMSkge1xuICAgICAgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IDFcbiAgICB9XG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudCA9IG5ldyBWaWRlb21haWxDbGllbnQoe1xuICAgICAgc2l0ZU5hbWU6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3NpdGVfbmFtZScpLFxuICAgICAgdmlkZW86IHtcbiAgICAgICAgbGltaXRTZWNvbmRzOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdsaW1pdF9zZWNvbmRzJykgfHwgOTAsXG4gICAgICAgIHdpZHRoOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCd3aWR0aCcpIHx8IDMyMCxcbiAgICAgICAgY291bnRkb3duOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdjb3VudGRvd24nKSB8fCBmYWxzZVxuICAgICAgfSxcbiAgICAgIGF1ZGlvOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2F1ZGlvX2VuYWJsZWQnKVxuICAgICAgfSxcbiAgICAgIGltYWdlOiB7XG4gICAgICAgIHF1YWxpdHk6IGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgLyAxMDAgLy8gbXVzdCBiZSBhIGZsb2F0XG4gICAgICB9LFxuICAgICAgc2VsZWN0b3JzOiB7XG4gICAgICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLnN1Ym1pdC13cmFwIGlucHV0J1xuICAgICAgfSxcbiAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAvLyB1Z2x5IG5hbWUgZWg/XG4gICAgICAgIGFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZzogdGhpcy5hZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmdUb1ZpZGVvbWFpbFNlcnZlci5iaW5kKFxuICAgICAgICAgIHRoaXNcbiAgICAgICAgKVxuICAgICAgfSxcbiAgICAgIC8vIGxlYXZlIGl0IHRvIG5pbmphIGZvcm0gdG8gdmFsaWRhdGUgdGhlIGlucHV0c1xuICAgICAgZW5hYmxlQXV0b1ZhbGlkYXRpb246IGZhbHNlLFxuICAgICAgLy8gbGVhdmUgaXQgdG8gbmluamEgZm9ybSB0byBkZWFsIHdpdGggZm9ybSBzdWJtaXNzaW9uc1xuICAgICAgZW5hYmxlQXV0b1N1Ym1pc3Npb246IGZhbHNlLFxuICAgICAgLy8gbG9nIGFjdGlvbnMvZXZlbnRzIHRvIGNvbnNvbGVcbiAgICAgIHZlcmJvc2U6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3ZlcmJvc2UnKSB8fCBERUJVR1xuICAgIH0pXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5QUkVWSUVXLFxuICAgICAgdGhpcy5vblByZXZpZXcuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlNVQk1JVFRFRCxcbiAgICAgIHRoaXMub25TdWJtaXR0ZWQuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLkdPSU5HX0JBQ0ssXG4gICAgICB0aGlzLm9uR29pbmdCYWNrLmJpbmQodGhpcylcbiAgICApXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5zaG93KClcbiAgfSxcblxuICAvLyBuZWVkZWQgdG8gZ2V0IHRoZSB2aWRlb21haWwga2V5IHdoaWNoIGlzIHJlcXVpcmVkIGJlZm9yZVxuICAvLyBzdWJtaXR0aW5nIHRvIHRoZSB2aWRlb21haWwgc2VydmVyXG4gIG9uUHJldmlldzogZnVuY3Rpb24gKGtleSkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBrZXkpXG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgndmFsdWUnLCBrZXkpXG5cbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmaWVsZHMnKVxuICAgICAgLy8gY2xlYXJzIGFueSBwcmV2aW91cyBlcnJvcnNcbiAgICAgIC5yZXF1ZXN0KCdyZW1vdmU6ZXJyb3InLCB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpZCcpLCAncmVxdWlyZWQtZXJyb3InKVxuICB9LFxuXG4gIG9uU3VibWl0dGVkOiBmdW5jdGlvbiAodmlkZW9tYWlsKSB7XG4gICAgdmFyIGZvcm1Nb2RlbCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2FwcCcpLnJlcXVlc3QoJ2dldDpmb3JtJywgdGhpcy5nZXRGb3JtSWQoKSlcblxuICAgIC8vIHRvZG8gaXNuJ3QgJ2Zvcm0tJyArIGZvcm1Nb2RlbC5nZXQoJ2lkJykgdGhlIHNhbWUgYXMgdGhlIGZvcm1JRCBhbHJlYWR5P1xuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIGZvcm1Nb2RlbC5nZXQoJ2lkJykpLnJlcXVlc3QoXG4gICAgICAnYWRkOmV4dHJhJyxcbiAgICAgICd2aWRlb21haWwnLFxuICAgICAgdmlkZW9tYWlsXG4gICAgKVxuXG4gICAgLy8gcmVzdGFydCBzdWJtaXNzaW9uIGFnYWluLCB0aGlzIHRpbWUgdG8gdGhlIHJlYWwgd3Agc2l0ZVxuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIHRoaXMuZ2V0Rm9ybUlkKCkpLnJlcXVlc3QoJ3N1Ym1pdCcsIGZvcm1Nb2RlbClcbiAgfSxcblxuICBvbkdvaW5nQmFjazogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBudWxsKVxuICAgIHRoaXMuaW52YWxpZGF0ZSgpXG4gIH0sXG5cbiAgdmFsaWRhdGVSZXF1aXJlZDogZnVuY3Rpb24gKGVsLCBmaWVsZE1vZGVsKSB7XG4gICAgdmFyIHZhbGlkID0gdGhpcy52YWxpZGF0ZVZpZGVvbWFpbChmaWVsZE1vZGVsKVxuXG4gICAgaWYgKCF2YWxpZCkge1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKClcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRcbiAgfSxcblxuICBpbnZhbGlkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gb3ZlcnJpZGUgZGVmYXVsdCBiZWhhdmlvdXIgc28gdGhhdCB3ZSBjYW4gc2V0IG91ciBvd24gZXJyb3IgdGV4dCBoZXJlXG4gICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZmllbGRzJykucmVxdWVzdChcbiAgICAgICdhZGQ6ZXJyb3InLFxuICAgICAgdGhpcy5maWVsZE1vZGVsLmdldCgnaWQnKSxcbiAgICAgICdyZXF1aXJlZC1lcnJvcicsXG4gICAgICAnUmVjb3JkIGFuZCBjbGljayBvbiBzdG9wIHRvIHNlZSBhIHByZXZpZXcgdmlkZW8uJ1xuICAgIClcbiAgfSxcblxuICB2YWxpZGF0ZVZpZGVvbWFpbDogZnVuY3Rpb24gKGZpZWxkTW9kZWwpIHtcbiAgICBmaWVsZE1vZGVsID0gZmllbGRNb2RlbCB8fCB0aGlzLmZpZWxkTW9kZWxcbiAgICByZXR1cm4gZmllbGRNb2RlbC5nZXQoJ3ZpZGVvbWFpbC1rZXknKSB8fCBmYWxzZVxuICB9LFxuXG4gIGhhc0Vycm9yczogZnVuY3Rpb24gKGZvcm1Nb2RlbCkge1xuICAgIHJldHVybiBmb3JtTW9kZWwuZ2V0KCdlcnJvcnMnKS5sZW5ndGggPiAwXG4gIH0sXG5cbiAgbWF5YmVTdWJtaXQ6IGZ1bmN0aW9uIChmb3JtTW9kZWwpIHtcbiAgICB2YXIgbWF5YmUgPSB0cnVlXG4gICAgdmFyIHZpZGVvbWFpbFN1Ym1pdHRlZCA9IGZvcm1Nb2RlbC5nZXRFeHRyYSgndmlkZW9tYWlsJylcbiAgICB2YXIgdmlkZW9tYWlsUmVjb3JkZWQgPSB0aGlzLnZhbGlkYXRlVmlkZW9tYWlsKClcbiAgICB2YXIgZXJyb3JuZW91cyA9IHRoaXMuaGFzRXJyb3JzKGZvcm1Nb2RlbClcblxuICAgIC8vIGhvbGQgb24gd2l0aCBmaW5hbCBmb3JtIHN1Ym1pc3Npb24gd2hlbiBvbmUgd2FzIHJlY29yZGVkXG4gICAgLy8gYnV0IGhhc24ndCBiZWVuIHN1Ym1pdHRlZCB0byB0aGUgdmlkZW9tYWlsIHNlcnZlciB5ZXRcbiAgICBpZiAoIXZpZGVvbWFpbFN1Ym1pdHRlZCAmJiAhZXJyb3JuZW91cyAmJiB2aWRlb21haWxSZWNvcmRlZCkge1xuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuc3VibWl0KClcbiAgICAgIG1heWJlID0gZmFsc2VcbiAgICB9XG5cbiAgICByZXR1cm4gbWF5YmVcbiAgfSxcblxuICBnZXRNZXJnZVRhZ1ZhbHVlOiBmdW5jdGlvbiAoZmllbGRLZXksIGZvcm1WYWx1ZXMpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KGZpZWxkS2V5KVxuXG4gICAgLy8gaXQgY2FuIGhhcHBlbiB0aGF0IHRoZSB1c2VyIGhhcyBjb25maWd1cmVkIHNvbWV0aGluZyB3cm9uZyxcbiAgICAvLyBpLkUuIGFuIGVtcHR5IGVtYWlsX2Zyb20uIGluIHRoYXQgY2FzZSBqdXN0IGlnbm9yZSAuLi5cbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIC8vIGFkbWluIGVtYWlsIGxvY2FsaXplZCBmcm9tIGJhY2tlbmQsIGEgYml0IHVnbHlcbiAgICAgIC8vIHRvZG8gYXNrIGZvciBhbiBlbmRwb2ludCB0byBwcm9jZXNzIHRob3NlIHNwZWNpYWwgbWVyZ2UgdGFnc1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2JpbmFyeWtpdGNoZW4vdmlkZW9tYWlsLWZvci1uaW5qYS1mb3Jtcy9pc3N1ZXMvMzBcbiAgICAgIGlmICh2YWx1ZSA9PT0gJ3t3cDphZG1pbl9lbWFpbH0nKSB7XG4gICAgICAgIHZhbHVlID0gd2luZG93Lm5mVmlkZW9tYWlsLmFkbWluX2VtYWlsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcmF3RmllbGRLZXlNYXRjaGVzID0gdmFsdWUubWF0Y2goL3tmaWVsZDooLiopfS9pKVxuICAgICAgICB2YXIgcmF3RmllbGRLZXkgPSByYXdGaWVsZEtleU1hdGNoZXMgJiYgcmF3RmllbGRLZXlNYXRjaGVzWzFdXG5cbiAgICAgICAgaWYgKHJhd0ZpZWxkS2V5ICE9PSB2YWx1ZSkge1xuICAgICAgICAgIC8vIHllcyBpdCB3YXMgYSBtZXJnZSB0YWcsIHNvIHVzZSBpdFxuICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgve2ZpZWxkOiguKil9L2ksIGZvcm1WYWx1ZXNbcmF3RmllbGRLZXldKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlXG4gIH0sXG5cbiAgZ2V0Rm9ybVZhbHVlczogZnVuY3Rpb24gKCkge1xuICAgIHZhciBmb3JtTW9kZWwgPSBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdhcHAnKS5yZXF1ZXN0KCdnZXQ6Zm9ybScsIHRoaXMuZ2V0Rm9ybUlkKCkpXG4gICAgdmFyIGZpZWxkc0NvbGxlY3Rpb24gPSBmb3JtTW9kZWwuZ2V0KCdmaWVsZHMnKVxuXG4gICAgcmV0dXJuIGZpZWxkc0NvbGxlY3Rpb24ucmVkdWNlKGZ1bmN0aW9uIChtZW1vLCBmaWVsZCkge1xuICAgICAgbWVtb1tmaWVsZC5nZXQoJ2tleScpXSA9IGZpZWxkLmdldCgndmFsdWUnKVxuICAgICAgcmV0dXJuIG1lbW9cbiAgICB9LCB7fSlcbiAgfSxcblxuICBhZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmdUb1ZpZGVvbWFpbFNlcnZlcjogZnVuY3Rpb24gKHZpZGVvbWFpbCwgY2IpIHtcbiAgICB2YXIgZm9ybVZhbHVlcyA9IHRoaXMuZ2V0Rm9ybVZhbHVlcygpXG5cbiAgICB2aWRlb21haWwuZnJvbSA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfZnJvbScsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLnRvID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF90bycsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLnN1YmplY3QgPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX3N1YmplY3QnLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC5ib2R5ID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9ib2R5JywgZm9ybVZhbHVlcylcblxuICAgIGNiKG51bGwsIHZpZGVvbWFpbClcbiAgfSxcblxuICBvbkJlZm9yZURlc3Ryb3k6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC51bmxvYWQoKVxuICAgIGRlbGV0ZSB0aGlzLnZpZGVvbWFpbENsaWVudFxuICB9XG59KVxuXG5qUXVlcnkoZG9jdW1lbnQpLnJlYWR5KGZ1bmN0aW9uICgpIHtcbiAgcmV0dXJuIG5ldyBWaWRlb21haWxGaWVsZENvbnRyb2xsZXIoKVxufSlcbiJdLCJuYW1lcyI6WyJERUJVRyIsIlZpZGVvbWFpbEZpZWxkQ29udHJvbGxlciIsIk1hcmlvbmV0dGUiLCJPYmplY3QiLCJleHRlbmQiLCJ2aWRlb21haWxDbGllbnQiLCJmaWVsZE1vZGVsIiwiY2hhbm5lbCIsIkJhY2tib25lIiwiUmFkaW8iLCJpbml0aWFsaXplIiwidGhpcyIsImxpc3RlblRvIiwiZXZlbnROYW1lIiwiY29uc29sZSIsImxvZyIsInJlZ2lzdGVyVmlkZW9tYWlsRmllbGQiLCJnZXRGb3JtSWQiLCJnZXQiLCJsb2FkVmlkZW9tYWlsQ2xpZW50IiwicmVwbHkiLCJ2YWxpZGF0ZVJlcXVpcmVkIiwidmFsaWRhdGVWaWRlb21haWwiLCJtYXliZVN1Ym1pdCIsImltYWdlUXVhbGl0eVBlcmNlbnRhZ2UiLCJWaWRlb21haWxDbGllbnQiLCJzaXRlTmFtZSIsInZpZGVvIiwibGltaXRTZWNvbmRzIiwid2lkdGgiLCJjb3VudGRvd24iLCJhdWRpbyIsImVuYWJsZWQiLCJpbWFnZSIsInF1YWxpdHkiLCJzZWxlY3RvcnMiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImNhbGxiYWNrcyIsImFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZyIsImFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyIiwiYmluZCIsImVuYWJsZUF1dG9WYWxpZGF0aW9uIiwiZW5hYmxlQXV0b1N1Ym1pc3Npb24iLCJ2ZXJib3NlIiwib24iLCJldmVudHMiLCJQUkVWSUVXIiwib25QcmV2aWV3IiwiU1VCTUlUVEVEIiwib25TdWJtaXR0ZWQiLCJHT0lOR19CQUNLIiwib25Hb2luZ0JhY2siLCJzaG93Iiwia2V5Iiwic2V0IiwicmVxdWVzdCIsInZpZGVvbWFpbCIsImZvcm1Nb2RlbCIsImludmFsaWRhdGUiLCJlbCIsInZhbGlkIiwiaGFzRXJyb3JzIiwibGVuZ3RoIiwibWF5YmUiLCJ2aWRlb21haWxTdWJtaXR0ZWQiLCJnZXRFeHRyYSIsInZpZGVvbWFpbFJlY29yZGVkIiwiZXJyb3JuZW91cyIsInN1Ym1pdCIsImdldE1lcmdlVGFnVmFsdWUiLCJmaWVsZEtleSIsImZvcm1WYWx1ZXMiLCJ2YWx1ZSIsIndpbmRvdyIsIm5mVmlkZW9tYWlsIiwiYWRtaW5fZW1haWwiLCJyYXdGaWVsZEtleSIsInJhd0ZpZWxkS2V5TWF0Y2hlcyIsIm1hdGNoIiwicmVwbGFjZSIsImdldEZvcm1WYWx1ZXMiLCJyZWR1Y2UiLCJtZW1vIiwiZmllbGQiLCJjYiIsImZyb20iLCJ0byIsInN1YmplY3QiLCJib2R5Iiwib25CZWZvcmVEZXN0cm95IiwidW5sb2FkIiwialF1ZXJ5IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBSUEsT0FBUSxFQUtSQyx5QkFBMkJDLFdBQVdDLE9BQU9DLE9BQU8sQ0FDdERDLGdC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
