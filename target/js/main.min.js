var DEBUG=!1,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,channel:Backbone.Radio.channel("videomail"),initialize:function(){Backbone.Radio.DEBUG=DEBUG,this.listenTo(this.channel,"all",function(e){DEBUG&&console.log("Videomail channel event triggered:",e),this.listenTo(this.channel,"init:model",this.registerVideomailField)})},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(this.fieldModel=e,this.loadVideomailClient(),this.channel.reply("validate:required",this.validateRequired,this),this.channel.reply("validate:modelData",this.validateVideomail,this),Backbone.Radio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1);var i=this.fieldModel.get("verbose")||DEBUG;DEBUG=DEBUG||i,Backbone.Radio.DEBUG=Backbone.Radio.DEBUG||i,this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:i}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),this.fieldModel.set("value",e),Backbone.Radio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=Backbone.Radio.channel("app").request("get:form",this.getFormId());Backbone.Radio.channel("form-"+i.get("id")).request("add:extra","videomail",e),Backbone.Radio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){i=this.validateVideomail(i);return i||this.invalidate(),i},invalidate:function(){Backbone.Radio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),o=this.validateVideomail(),e=this.hasErrors(e);return t||e||!o||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t=this.fieldModel.get(e);return t&&("{wp:admin_email}"===t?t=window.nfVideomail.admin_email:(e=(e=t.match(/{field:(.*)}/i))&&e[1])!==t&&(t=t.replace(/{field:(.*)}/i,i[e]))),t},getFormValues:function(){var e,i=Backbone.Radio.channel("app").request("get:form",this.getFormId());return i?e=i.get("fields"):this.fieldModel.collection.options.formModel.get("fields").models&&(e=this.fieldModel.collection.options.formModel.get("fields").models),e.reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSBmYWxzZVxuXG4vLyBnb29kIGRvY3VtZW50YXRpb24gb24gYmFja2JvbmUgZXZlbnQgaGFuZGxpbmdcbi8vIGh0dHA6Ly9iYWNrYm9uZWpzLm9yZy8jRXZlbnRzXG5cbnZhciBWaWRlb21haWxGaWVsZENvbnRyb2xsZXIgPSBNYXJpb25ldHRlLk9iamVjdC5leHRlbmQoe1xuICB2aWRlb21haWxDbGllbnQ6IG51bGwsXG5cbiAgZmllbGRNb2RlbDogbnVsbCxcblxuICBjaGFubmVsOiBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKSxcblxuICBpbml0aWFsaXplOiBmdW5jdGlvbiAoKSB7XG4gICAgQmFja2JvbmUuUmFkaW8uREVCVUcgPSBERUJVR1xuXG4gICAgLy8gdWdseSB3b3JrYXJvdW5kIHRvIG1ha2UgaXQgd29yayB3aXRoIHRoZSBjb25kaXRpb25hbCBwbHVnaW5cbiAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2FsbCcsIGZ1bmN0aW9uIChldmVudE5hbWUpIHtcbiAgICAgIERFQlVHICYmIGNvbnNvbGUubG9nKCdWaWRlb21haWwgY2hhbm5lbCBldmVudCB0cmlnZ2VyZWQ6JywgZXZlbnROYW1lKVxuXG4gICAgICAvLyBvbmx5IHN0YXJ0IGxpc3RlbmluZyBhdCB0aGlzIHBvaW50LiBiZWNhdXNlIHRoZSBjb25kaXRpb25hbCBwbHVnaW5cbiAgICAgIC8vIGlzIHJlc2V0dGluZyBldmVudCBoYW5kbGVycy4gd2l0aG91dCB0aGUgYWJvdmUsIHdlJ2QgYmUgcmVnaXN0ZXJpbmdcbiAgICAgIC8vIHRvbyBlYXJseSBhbmQgdGhlIGNvbmRpdGlvbmFsIHBsdWdpbiBvdmVycmlkZXMuXG4gICAgICB0aGlzLmxpc3RlblRvKHRoaXMuY2hhbm5lbCwgJ2luaXQ6bW9kZWwnLCB0aGlzLnJlZ2lzdGVyVmlkZW9tYWlsRmllbGQpXG4gICAgfSlcbiAgfSxcblxuICBnZXRGb3JtSWQ6IGZ1bmN0aW9uICgpIHtcbiAgICByZXR1cm4gdGhpcy5maWVsZE1vZGVsLmdldCgnZm9ybUlEJylcbiAgfSxcblxuICByZWdpc3RlclZpZGVvbWFpbEZpZWxkOiBmdW5jdGlvbiAoZmllbGRNb2RlbCkge1xuICAgIC8vIHdvcmthcm91bmQgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS93cG5pbmphcy9uaW5qYS1mb3Jtcy9pc3N1ZXMvMjY3NVxuICAgIC8vIGFsc28gcHJldmVudHMgZnJvbSBldmVudCBlbWl0dGVyIGxlYWtzIHVuZGVyIHJhY2UgY29uZGl0aW9uc1xuICAgIGlmICghdGhpcy52aWRlb21haWxDbGllbnQpIHtcbiAgICAgIHRoaXMuZmllbGRNb2RlbCA9IGZpZWxkTW9kZWxcblxuICAgICAgdGhpcy5sb2FkVmlkZW9tYWlsQ2xpZW50KClcblxuICAgICAgLy8gY3VzdG9tIGZpZWxkIHZhbGlkYXRpb24sIHNpbmNlIHdlIGFyZW4ndCB1c2luZyBhIHN0YW5kYXJkIGB2YWx1ZWBcbiAgICAgIC8vIGZvciB0aGUgdmlkZW9tYWlsIGlucHV0XG4gICAgICB0aGlzLmNoYW5uZWwucmVwbHkoJ3ZhbGlkYXRlOnJlcXVpcmVkJywgdGhpcy52YWxpZGF0ZVJlcXVpcmVkLCB0aGlzKVxuXG4gICAgICB0aGlzLmNoYW5uZWwucmVwbHkoJ3ZhbGlkYXRlOm1vZGVsRGF0YScsIHRoaXMudmFsaWRhdGVWaWRlb21haWwsIHRoaXMpXG5cbiAgICAgIC8vIGNvbnRyb2wgc3VibWlzc2lvbiBwcm9ncmVzcyxcbiAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIFBPU1QgdG8gdGhlIFZpZGVvbWFpbCBzZXJ2ZXIgZmlyc3RcbiAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIHRoaXMuZ2V0Rm9ybUlkKCkpLnJlcGx5KFxuICAgICAgICAnbWF5YmU6c3VibWl0JyxcbiAgICAgICAgdGhpcy5tYXliZVN1Ym1pdCxcbiAgICAgICAgdGhpcyxcbiAgICAgICAgZmllbGRNb2RlbFxuICAgICAgKVxuICAgIH1cbiAgfSxcblxuICBsb2FkVmlkZW9tYWlsQ2xpZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpbWFnZV9xdWFsaXR5JykgfHwgNDBcblxuICAgIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlID4gMTAwKSB7XG4gICAgICBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gMTAwXG4gICAgfSBlbHNlIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlIDwgMSkge1xuICAgICAgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IDFcbiAgICB9XG5cbiAgICB2YXIgdmVyYm9zZSA9IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3ZlcmJvc2UnKSB8fCBERUJVR1xuXG4gICAgLy8gbGF0ZSBvdmVycmlkZXNcbiAgICBERUJVRyA9IERFQlVHIHx8IHZlcmJvc2VcbiAgICBCYWNrYm9uZS5SYWRpby5ERUJVRyA9IEJhY2tib25lLlJhZGlvLkRFQlVHIHx8IHZlcmJvc2VcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50ID0gbmV3IFZpZGVvbWFpbENsaWVudCh7XG4gICAgICBzaXRlTmFtZTogdGhpcy5maWVsZE1vZGVsLmdldCgnc2l0ZV9uYW1lJyksXG4gICAgICB2aWRlbzoge1xuICAgICAgICBsaW1pdFNlY29uZHM6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2xpbWl0X3NlY29uZHMnKSB8fCA5MCxcbiAgICAgICAgd2lkdGg6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3dpZHRoJykgfHwgMzIwLFxuICAgICAgICBjb3VudGRvd246IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2NvdW50ZG93bicpIHx8IGZhbHNlXG4gICAgICB9LFxuICAgICAgYXVkaW86IHtcbiAgICAgICAgZW5hYmxlZDogdGhpcy5maWVsZE1vZGVsLmdldCgnYXVkaW9fZW5hYmxlZCcpXG4gICAgICB9LFxuICAgICAgaW1hZ2U6IHtcbiAgICAgICAgcXVhbGl0eTogaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSAvIDEwMCAvLyBtdXN0IGJlIGEgZmxvYXRcbiAgICAgIH0sXG4gICAgICBzZWxlY3RvcnM6IHtcbiAgICAgICAgc3VibWl0QnV0dG9uU2VsZWN0b3I6ICcuc3VibWl0LXdyYXAgaW5wdXQnXG4gICAgICB9LFxuICAgICAgY2FsbGJhY2tzOiB7XG4gICAgICAgIC8vIHVnbHkgbmFtZSBlaD9cbiAgICAgICAgYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nOiB0aGlzLmFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyLmJpbmQoXG4gICAgICAgICAgdGhpc1xuICAgICAgICApXG4gICAgICB9LFxuICAgICAgLy8gbGVhdmUgaXQgdG8gbmluamEgZm9ybSB0byB2YWxpZGF0ZSB0aGUgaW5wdXRzXG4gICAgICBlbmFibGVBdXRvVmFsaWRhdGlvbjogZmFsc2UsXG4gICAgICAvLyBsZWF2ZSBpdCB0byBuaW5qYSBmb3JtIHRvIGRlYWwgd2l0aCBmb3JtIHN1Ym1pc3Npb25zXG4gICAgICBlbmFibGVBdXRvU3VibWlzc2lvbjogZmFsc2UsXG4gICAgICAvLyBsb2cgYWN0aW9ucy9ldmVudHMgdG8gY29uc29sZVxuICAgICAgdmVyYm9zZTogdmVyYm9zZVxuICAgIH0pXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5QUkVWSUVXLFxuICAgICAgdGhpcy5vblByZXZpZXcuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlNVQk1JVFRFRCxcbiAgICAgIHRoaXMub25TdWJtaXR0ZWQuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLkdPSU5HX0JBQ0ssXG4gICAgICB0aGlzLm9uR29pbmdCYWNrLmJpbmQodGhpcylcbiAgICApXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5zaG93KClcbiAgfSxcblxuICAvLyBuZWVkZWQgdG8gZ2V0IHRoZSB2aWRlb21haWwga2V5IHdoaWNoIGlzIHJlcXVpcmVkIGJlZm9yZVxuICAvLyBzdWJtaXR0aW5nIHRvIHRoZSB2aWRlb21haWwgc2VydmVyXG4gIG9uUHJldmlldzogZnVuY3Rpb24gKGtleSkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBrZXkpXG4gICAgdGhpcy5maWVsZE1vZGVsLnNldCgndmFsdWUnLCBrZXkpXG5cbiAgICBCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmaWVsZHMnKVxuICAgICAgLy8gY2xlYXJzIGFueSBwcmV2aW91cyBlcnJvcnNcbiAgICAgIC5yZXF1ZXN0KCdyZW1vdmU6ZXJyb3InLCB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpZCcpLCAncmVxdWlyZWQtZXJyb3InKVxuICB9LFxuXG4gIG9uU3VibWl0dGVkOiBmdW5jdGlvbiAodmlkZW9tYWlsKSB7XG4gICAgdmFyIGZvcm1Nb2RlbCA9IEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2FwcCcpLnJlcXVlc3QoJ2dldDpmb3JtJywgdGhpcy5nZXRGb3JtSWQoKSlcblxuICAgIC8vIHRvZG8gaXNuJ3QgJ2Zvcm0tJyArIGZvcm1Nb2RlbC5nZXQoJ2lkJykgdGhlIHNhbWUgYXMgdGhlIGZvcm1JRCBhbHJlYWR5P1xuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIGZvcm1Nb2RlbC5nZXQoJ2lkJykpLnJlcXVlc3QoXG4gICAgICAnYWRkOmV4dHJhJyxcbiAgICAgICd2aWRlb21haWwnLFxuICAgICAgdmlkZW9tYWlsXG4gICAgKVxuXG4gICAgLy8gcmVzdGFydCBzdWJtaXNzaW9uIGFnYWluLCB0aGlzIHRpbWUgdG8gdGhlIHJlYWwgd3Agc2l0ZVxuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIHRoaXMuZ2V0Rm9ybUlkKCkpLnJlcXVlc3QoJ3N1Ym1pdCcsIGZvcm1Nb2RlbClcbiAgfSxcblxuICBvbkdvaW5nQmFjazogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBudWxsKVxuICAgIHRoaXMuaW52YWxpZGF0ZSgpXG4gIH0sXG5cbiAgdmFsaWRhdGVSZXF1aXJlZDogZnVuY3Rpb24gKGVsLCBmaWVsZE1vZGVsKSB7XG4gICAgdmFyIHZhbGlkID0gdGhpcy52YWxpZGF0ZVZpZGVvbWFpbChmaWVsZE1vZGVsKVxuXG4gICAgaWYgKCF2YWxpZCkge1xuICAgICAgdGhpcy5pbnZhbGlkYXRlKClcbiAgICB9XG5cbiAgICByZXR1cm4gdmFsaWRcbiAgfSxcblxuICBpbnZhbGlkYXRlOiBmdW5jdGlvbiAoKSB7XG4gICAgLy8gb3ZlcnJpZGUgZGVmYXVsdCBiZWhhdmlvdXIgc28gdGhhdCB3ZSBjYW4gc2V0IG91ciBvd24gZXJyb3IgdGV4dCBoZXJlXG4gICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZmllbGRzJykucmVxdWVzdChcbiAgICAgICdhZGQ6ZXJyb3InLFxuICAgICAgdGhpcy5maWVsZE1vZGVsLmdldCgnaWQnKSxcbiAgICAgICdyZXF1aXJlZC1lcnJvcicsXG4gICAgICAnUmVjb3JkIGFuZCBjbGljayBvbiBzdG9wIHRvIHNlZSBhIHByZXZpZXcgdmlkZW8uJ1xuICAgIClcbiAgfSxcblxuICB2YWxpZGF0ZVZpZGVvbWFpbDogZnVuY3Rpb24gKGZpZWxkTW9kZWwpIHtcbiAgICBmaWVsZE1vZGVsID0gZmllbGRNb2RlbCB8fCB0aGlzLmZpZWxkTW9kZWxcbiAgICByZXR1cm4gZmllbGRNb2RlbC5nZXQoJ3ZpZGVvbWFpbC1rZXknKSB8fCBmYWxzZVxuICB9LFxuXG4gIGhhc0Vycm9yczogZnVuY3Rpb24gKGZvcm1Nb2RlbCkge1xuICAgIHJldHVybiBmb3JtTW9kZWwuZ2V0KCdlcnJvcnMnKS5sZW5ndGggPiAwXG4gIH0sXG5cbiAgbWF5YmVTdWJtaXQ6IGZ1bmN0aW9uIChmb3JtTW9kZWwpIHtcbiAgICB2YXIgbWF5YmUgPSB0cnVlXG4gICAgdmFyIHZpZGVvbWFpbFN1Ym1pdHRlZCA9IGZvcm1Nb2RlbC5nZXRFeHRyYSgndmlkZW9tYWlsJylcbiAgICB2YXIgdmlkZW9tYWlsUmVjb3JkZWQgPSB0aGlzLnZhbGlkYXRlVmlkZW9tYWlsKClcbiAgICB2YXIgZXJyb3JuZW91cyA9IHRoaXMuaGFzRXJyb3JzKGZvcm1Nb2RlbClcblxuICAgIC8vIGhvbGQgb24gd2l0aCBmaW5hbCBmb3JtIHN1Ym1pc3Npb24gd2hlbiBvbmUgd2FzIHJlY29yZGVkXG4gICAgLy8gYnV0IGhhc24ndCBiZWVuIHN1Ym1pdHRlZCB0byB0aGUgdmlkZW9tYWlsIHNlcnZlciB5ZXRcbiAgICBpZiAoIXZpZGVvbWFpbFN1Ym1pdHRlZCAmJiAhZXJyb3JuZW91cyAmJiB2aWRlb21haWxSZWNvcmRlZCkge1xuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuc3VibWl0KClcbiAgICAgIG1heWJlID0gZmFsc2VcbiAgICB9XG5cbiAgICByZXR1cm4gbWF5YmVcbiAgfSxcblxuICBnZXRNZXJnZVRhZ1ZhbHVlOiBmdW5jdGlvbiAoZmllbGRLZXksIGZvcm1WYWx1ZXMpIHtcbiAgICB2YXIgdmFsdWUgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KGZpZWxkS2V5KVxuXG4gICAgLy8gaXQgY2FuIGhhcHBlbiB0aGF0IHRoZSB1c2VyIGhhcyBjb25maWd1cmVkIHNvbWV0aGluZyB3cm9uZyxcbiAgICAvLyBpLkUuIGFuIGVtcHR5IGVtYWlsX2Zyb20uIGluIHRoYXQgY2FzZSBqdXN0IGlnbm9yZSAuLi5cbiAgICBpZiAodmFsdWUpIHtcbiAgICAgIC8vIGFkbWluIGVtYWlsIGxvY2FsaXplZCBmcm9tIGJhY2tlbmQsIGEgYml0IHVnbHlcbiAgICAgIC8vIHRvZG8gYXNrIGZvciBhbiBlbmRwb2ludCB0byBwcm9jZXNzIHRob3NlIHNwZWNpYWwgbWVyZ2UgdGFnc1xuICAgICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2JpbmFyeWtpdGNoZW4vdmlkZW9tYWlsLWZvci1uaW5qYS1mb3Jtcy9pc3N1ZXMvMzBcbiAgICAgIGlmICh2YWx1ZSA9PT0gJ3t3cDphZG1pbl9lbWFpbH0nKSB7XG4gICAgICAgIHZhbHVlID0gd2luZG93Lm5mVmlkZW9tYWlsLmFkbWluX2VtYWlsXG4gICAgICB9IGVsc2Uge1xuICAgICAgICB2YXIgcmF3RmllbGRLZXlNYXRjaGVzID0gdmFsdWUubWF0Y2goL3tmaWVsZDooLiopfS9pKVxuICAgICAgICB2YXIgcmF3RmllbGRLZXkgPSByYXdGaWVsZEtleU1hdGNoZXMgJiYgcmF3RmllbGRLZXlNYXRjaGVzWzFdXG5cbiAgICAgICAgaWYgKHJhd0ZpZWxkS2V5ICE9PSB2YWx1ZSkge1xuICAgICAgICAgIC8vIHllcyBpdCB3YXMgYSBtZXJnZSB0YWcsIHNvIHVzZSBpdFxuICAgICAgICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgve2ZpZWxkOiguKil9L2ksIGZvcm1WYWx1ZXNbcmF3RmllbGRLZXldKVxuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbHVlXG4gIH0sXG5cbiAgLy8gcmV0dXJucyBhIG1hcCBsaWtlIHRoaXM6XG4gIC8vIHtcbiAgLy8gICBmcm9tX2VtYWlsOiBcIm1pY0tAZGVhZm9uei5laFwiXG4gIC8vICAgZnJvbV9uYW1lOiBcIk1IXCJcbiAgLy8gICBtZXNzYWdlOiBcInNkZnNkZnNkZlwiXG4gIC8vICAgc3ViamVjdDogXCJzZGZzZGZcIlxuICAvLyAgIHN1Ym1pdDogXCJcIlxuICAvLyAgIHZpZGVvX21lc3NhZ2U6IFwiMTFlYi02MWQ3LWRkNTgzMzIwLWFlNjEtMmI4MmJlNmM2ZTNlXCJcbiAgLy8gfVxuICBnZXRGb3JtVmFsdWVzOiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGNvbGxlY3Rpb25cbiAgICB2YXIgZm9ybU1vZGVsID0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnYXBwJykucmVxdWVzdCgnZ2V0OmZvcm0nLCB0aGlzLmdldEZvcm1JZCgpKVxuXG4gICAgaWYgKGZvcm1Nb2RlbCkge1xuICAgICAgY29sbGVjdGlvbiA9IGZvcm1Nb2RlbC5nZXQoJ2ZpZWxkcycpXG4gICAgICAvLyBmYWxsYmFjayBmb3Igb2xkZXIgdmVyc2lvbnNcbiAgICB9IGVsc2UgaWYgKHRoaXMuZmllbGRNb2RlbC5jb2xsZWN0aW9uLm9wdGlvbnMuZm9ybU1vZGVsLmdldCgnZmllbGRzJykubW9kZWxzKSB7XG4gICAgICBjb2xsZWN0aW9uID0gdGhpcy5maWVsZE1vZGVsLmNvbGxlY3Rpb24ub3B0aW9ucy5mb3JtTW9kZWwuZ2V0KCdmaWVsZHMnKS5tb2RlbHNcbiAgICB9XG5cbiAgICByZXR1cm4gY29sbGVjdGlvbi5yZWR1Y2UoZnVuY3Rpb24gKG1lbW8sIGZpZWxkKSB7XG4gICAgICBtZW1vW2ZpZWxkLmdldCgna2V5JyldID0gZmllbGQuZ2V0KCd2YWx1ZScpXG4gICAgICByZXR1cm4gbWVtb1xuICAgIH0sIHt9KVxuICB9LFxuXG4gIGFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyOiBmdW5jdGlvbiAodmlkZW9tYWlsLCBjYikge1xuICAgIHZhciBmb3JtVmFsdWVzID0gdGhpcy5nZXRGb3JtVmFsdWVzKClcblxuICAgIHZpZGVvbWFpbC5mcm9tID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9mcm9tJywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwudG8gPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX3RvJywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwuc3ViamVjdCA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfc3ViamVjdCcsIGZvcm1WYWx1ZXMpXG4gICAgdmlkZW9tYWlsLmJvZHkgPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX2JvZHknLCBmb3JtVmFsdWVzKVxuXG4gICAgY2IobnVsbCwgdmlkZW9tYWlsKVxuICB9LFxuXG4gIG9uQmVmb3JlRGVzdHJveTogZnVuY3Rpb24gKCkge1xuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LnVubG9hZCgpXG4gICAgZGVsZXRlIHRoaXMudmlkZW9tYWlsQ2xpZW50XG4gIH1cbn0pXG5cbmpRdWVyeShkb2N1bWVudCkucmVhZHkoZnVuY3Rpb24gKCkge1xuICByZXR1cm4gbmV3IFZpZGVvbWFpbEZpZWxkQ29udHJvbGxlcigpXG59KVxuIl0sIm5hbWVzIjpbIkRFQlVHIiwiVmlkZW9tYWlsRmllbGRDb250cm9sbGVyIiwiTWFyaW9uZXR0ZSIsIk9iamVjdCIsImV4dGVuZCIsInZpZGVvbWFpbENsaWVudCIsImZpZWxkTW9kZWwiLCJjaGFubmVsIiwiQmFja2JvbmUiLCJSYWRpbyIsImluaXRpYWxpemUiLCJ0aGlzIiwibGlzdGVuVG8iLCJldmVudE5hbWUiLCJjb25zb2xlIiwibG9nIiwicmVnaXN0ZXJWaWRlb21haWxGaWVsZCIsImdldEZvcm1JZCIsImdldCIsImxvYWRWaWRlb21haWxDbGllbnQiLCJyZXBseSIsInZhbGlkYXRlUmVxdWlyZWQiLCJ2YWxpZGF0ZVZpZGVvbWFpbCIsIm1heWJlU3VibWl0IiwiaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSIsInZlcmJvc2UiLCJWaWRlb21haWxDbGllbnQiLCJzaXRlTmFtZSIsInZpZGVvIiwibGltaXRTZWNvbmRzIiwid2lkdGgiLCJjb3VudGRvd24iLCJhdWRpbyIsImVuYWJsZWQiLCJpbWFnZSIsInF1YWxpdHkiLCJzZWxlY3RvcnMiLCJzdWJtaXRCdXR0b25TZWxlY3RvciIsImNhbGxiYWNrcyIsImFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZyIsImFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZ1RvVmlkZW9tYWlsU2VydmVyIiwiYmluZCIsImVuYWJsZUF1dG9WYWxpZGF0aW9uIiwiZW5hYmxlQXV0b1N1Ym1pc3Npb24iLCJvbiIsImV2ZW50cyIsIlBSRVZJRVciLCJvblByZXZpZXciLCJTVUJNSVRURUQiLCJvblN1Ym1pdHRlZCIsIkdPSU5HX0JBQ0siLCJvbkdvaW5nQmFjayIsInNob3ciLCJrZXkiLCJzZXQiLCJyZXF1ZXN0IiwidmlkZW9tYWlsIiwiZm9ybU1vZGVsIiwiaW52YWxpZGF0ZSIsImVsIiwidmFsaWQiLCJoYXNFcnJvcnMiLCJsZW5ndGgiLCJtYXliZSIsInZpZGVvbWFpbFN1Ym1pdHRlZCIsImdldEV4dHJhIiwidmlkZW9tYWlsUmVjb3JkZWQiLCJlcnJvcm5lb3VzIiwic3VibWl0IiwiZ2V0TWVyZ2VUYWdWYWx1ZSIsImZpZWxkS2V5IiwiZm9ybVZhbHVlcyIsInZhbHVlIiwid2luZG93IiwibmZWaWRlb21haWwiLCJhZG1pbl9lbWFpbCIsInJhd0ZpZWxkS2V5IiwicmF3RmllbGRLZXlNYXRjaGVzIiwibWF0Y2giLCJyZXBsYWNlIiwiZ2V0Rm9ybVZhbHVlcyIsImNvbGxlY3Rpb24iLCJvcHRpb25zIiwibW9kZWxzIiwicmVkdWNlIiwibWVtbyIsImZpZWxkIiwiY2IiLCJmcm9tIiwidG8iLCJzdWJqZWN0IiwiYm9keSIsIm9uQmVmb3JlRGVzdHJveSIsInVubG9hZCIsImpRdWVyeSIsImRvY3VtZW50IiwicmVhZHkiXSwibWFwcGluZ3MiOiJBQUNBLElBQUlBLE9BQVEsRUFLUkMseUJBQTJCQyxXQUFXQyxPQUFPQyxPQUFPLENBQ3REQyxnQkFBaUIsS0FFakJDLFdBQVksS0FFWkMsUUFBU0MsU0FBU0MsTUFBTUYsUUFBUSxhQUVoQ0csV0FBWSxXQUNWRixTQUFTQyxNQUFNVCxNQUFRQSxNQUd2QlcsS0FBS0MsU0FBU0QsS0FBS0osUUFBUyxNQUFPLFNBQVVNLEdBQzNDYixPQUFTYyxRQUFRQyxJQUFJLHFDQUFzQ0YsR0FLM0RGLEtBQUtDLFNBQVNELEtBQUtKLFFBQVMsYUFBY0ksS0FBS0ssMkJBSW5EQyxVQUFXLFdBQ1QsT0FBT04s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
