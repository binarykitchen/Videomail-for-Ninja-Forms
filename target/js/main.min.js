var DEBUG=!0,VideomailFieldController=Marionette.Object.extend({videomailClient:null,fieldModel:null,initialize:function(){(Backbone.Radio.DEBUG=DEBUG)&&(this.listenTo(Backbone.Radio.channel("videomail"),"all",function(e,i){console.log("Videomail event triggered:",e,i)}),this.listenTo(Backbone.Radio.channel("forms"),"all",function(e,i){console.log("Forms event triggered:",e,i)}),this.listenTo(Backbone.Radio.channel("app"),"all",function(e,i){console.log("App event triggered:",e,i)}),this.listenTo(Backbone.Radio.channel("fields"),"all",function(e,i){console.log("Fields event triggered:",e,i)})),this.listenTo(Backbone.Radio.channel("videomail"),"init:model",this.registerVideomailField)},getFormId:function(){return this.fieldModel.get("formID")},registerVideomailField:function(e){this.videomailClient||(this.fieldModel=e,this.loadVideomailClient(),Backbone.Radio.channel("videomail").reply("validate:required",this.validateRequired,this),Backbone.Radio.channel("videomail").reply("validate:modelData",this.validateVideomail,this),Backbone.Radio.channel("form-"+this.getFormId()).reply("maybe:submit",this.maybeSubmit,this,e))},loadVideomailClient:function(){var e=this.fieldModel.get("image_quality")||40;100<e?e=100:e<1&&(e=1),this.videomailClient=new VideomailClient({siteName:this.fieldModel.get("site_name"),video:{limitSeconds:this.fieldModel.get("limit_seconds")||90,width:this.fieldModel.get("width")||320,countdown:this.fieldModel.get("countdown")||!1},audio:{enabled:this.fieldModel.get("audio_enabled")},image:{quality:e/100},selectors:{submitButtonSelector:".submit-wrap input"},callbacks:{adjustFormDataBeforePosting:this.adjustFormDataBeforePostingToVideomailServer.bind(this)},enableAutoValidation:!1,enableAutoSubmission:!1,verbose:this.fieldModel.get("verbose")||DEBUG}),this.videomailClient.on(this.videomailClient.events.PREVIEW,this.onPreview.bind(this)),this.videomailClient.on(this.videomailClient.events.SUBMITTED,this.onSubmitted.bind(this)),this.videomailClient.on(this.videomailClient.events.GOING_BACK,this.onGoingBack.bind(this)),this.videomailClient.show()},onPreview:function(e){this.fieldModel.set("videomail-key",e),Backbone.Radio.channel("fields").request("remove:error",this.fieldModel.get("id"),"required-error")},onSubmitted:function(e){var i=nfRadio.channel("app").request("get:form",this.getFormId());nfRadio.channel("form-"+i.get("id")).request("add:extra","videomail",e),nfRadio.channel("form-"+this.getFormId()).request("submit",i)},onGoingBack:function(){this.fieldModel.set("videomail-key",null),this.invalidate()},validateRequired:function(e,i){i=this.validateVideomail(i);return i||this.invalidate(),i},invalidate:function(){Backbone.Radio.channel("fields").request("add:error",this.fieldModel.get("id"),"required-error","Record and click on stop to see a preview video.")},validateVideomail:function(e){return(e=e||this.fieldModel).get("videomail-key")||!1},hasErrors:function(e){return 0<e.get("errors").length},maybeSubmit:function(e){var i=!0,t=e.getExtra("videomail"),o=this.validateVideomail(),e=this.hasErrors(e);return t||e||!o||(this.videomailClient.submit(),i=!1),i},getMergeTagValue:function(e,i){var t=this.fieldModel.get(e);return t&&("{wp:admin_email}"===t?t=window.nfVideomail.admin_email:(e=(e=t.match(/{field:(.*)}/i))&&e[1])!==t&&(t=t.replace(/{field:(.*)}/i,i[e]))),t},getFormValues:function(){return Backbone.Radio.channel("app").request("get:form",this.getFormId()).get("fields").reduce(function(e,i){return e[i.get("key")]=i.get("value"),e},{})},adjustFormDataBeforePostingToVideomailServer:function(e,i){var t=this.getFormValues();e.from=this.getMergeTagValue("email_from",t),e.to=this.getMergeTagValue("email_to",t),e.subject=this.getMergeTagValue("email_subject",t),e.body=this.getMergeTagValue("email_body",t),i(null,e)},onBeforeDestroy:function(){this.videomailClient.unload(),delete this.videomailClient}});jQuery(document).ready(function(){return new VideomailFieldController});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWFpbi5taW4uanMiLCJzb3VyY2VzIjpbIm1haW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gbWFudWFsIHN3aXRjaCB0byBoYXZlIG1vcmUgc3R1ZmYgcHJpbnRlZCB0byBjb25zb2xlXG52YXIgREVCVUcgPSB0cnVlXG5cbi8vIGdvb2QgZG9jdW1lbnRhdGlvbiBvbiBiYWNrYm9uZSBldmVudCBoYW5kbGluZ1xuLy8gaHR0cDovL2JhY2tib25lanMub3JnLyNFdmVudHNcblxudmFyIFZpZGVvbWFpbEZpZWxkQ29udHJvbGxlciA9IE1hcmlvbmV0dGUuT2JqZWN0LmV4dGVuZCh7XG4gIHZpZGVvbWFpbENsaWVudDogbnVsbCxcblxuICAvLyBub3Qgc3VyZSBpZiB0aGlzIGlzIGEgZ29vZCBpZGVhLCBidXQgaSBuZWVkIGEgcmVmZXJlbmNlIHRvIGl0XG4gIGZpZWxkTW9kZWw6IG51bGwsXG5cbiAgaW5pdGlhbGl6ZTogZnVuY3Rpb24gKCkge1xuICAgIEJhY2tib25lLlJhZGlvLkRFQlVHID0gREVCVUdcblxuICAgIGlmIChERUJVRykge1xuICAgICAgdGhpcy5saXN0ZW5UbyhCYWNrYm9uZS5SYWRpby5jaGFubmVsKCd2aWRlb21haWwnKSwgJ2FsbCcsIGZ1bmN0aW9uIChldmVudE5hbWUsIGIpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ1ZpZGVvbWFpbCBldmVudCB0cmlnZ2VyZWQ6JywgZXZlbnROYW1lLCBiKVxuICAgICAgfSlcblxuICAgICAgdGhpcy5saXN0ZW5UbyhCYWNrYm9uZS5SYWRpby5jaGFubmVsKCdmb3JtcycpLCAnYWxsJywgZnVuY3Rpb24gKGV2ZW50TmFtZSwgYikge1xuICAgICAgICBjb25zb2xlLmxvZygnRm9ybXMgZXZlbnQgdHJpZ2dlcmVkOicsIGV2ZW50TmFtZSwgYilcbiAgICAgIH0pXG5cbiAgICAgIHRoaXMubGlzdGVuVG8oQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnYXBwJyksICdhbGwnLCBmdW5jdGlvbiAoZXZlbnROYW1lLCBiKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdBcHAgZXZlbnQgdHJpZ2dlcmVkOicsIGV2ZW50TmFtZSwgYilcbiAgICAgIH0pXG5cbiAgICAgIHRoaXMubGlzdGVuVG8oQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZmllbGRzJyksICdhbGwnLCBmdW5jdGlvbiAoZXZlbnROYW1lLCBiKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKCdGaWVsZHMgZXZlbnQgdHJpZ2dlcmVkOicsIGV2ZW50TmFtZSwgYilcbiAgICAgIH0pXG4gICAgfVxuXG4gICAgdGhpcy5saXN0ZW5UbyhcbiAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ3ZpZGVvbWFpbCcpLFxuICAgICAgJ2luaXQ6bW9kZWwnLFxuICAgICAgdGhpcy5yZWdpc3RlclZpZGVvbWFpbEZpZWxkXG4gICAgKVxuICB9LFxuXG4gIGdldEZvcm1JZDogZnVuY3Rpb24gKCkge1xuICAgIHJldHVybiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdmb3JtSUQnKVxuICB9LFxuXG4gIHJlZ2lzdGVyVmlkZW9tYWlsRmllbGQ6IGZ1bmN0aW9uIChmaWVsZE1vZGVsKSB7XG4gICAgLy8gd29ya2Fyb3VuZCBmb3IgaHR0cHM6Ly9naXRodWIuY29tL3dwbmluamFzL25pbmphLWZvcm1zL2lzc3Vlcy8yNjc1XG4gICAgLy8gYWxzbyBwcmV2ZW50cyBmcm9tIGV2ZW50IGVtaXR0ZXIgbGVha3MgdW5kZXIgcmFjZSBjb25kaXRpb25zXG4gICAgaWYgKCF0aGlzLnZpZGVvbWFpbENsaWVudCkge1xuICAgICAgdGhpcy5maWVsZE1vZGVsID0gZmllbGRNb2RlbFxuXG4gICAgICB0aGlzLmxvYWRWaWRlb21haWxDbGllbnQoKVxuXG4gICAgICAvLyBjdXN0b20gZmllbGQgdmFsaWRhdGlvbiwgc2luY2Ugd2UgYXJlbid0IHVzaW5nIGEgc3RhbmRhcmQgYHZhbHVlYFxuICAgICAgLy8gZm9yIHRoZSB2aWRlb21haWwgaW5wdXRcbiAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ3ZpZGVvbWFpbCcpLnJlcGx5KFxuICAgICAgICAndmFsaWRhdGU6cmVxdWlyZWQnLFxuICAgICAgICB0aGlzLnZhbGlkYXRlUmVxdWlyZWQsXG4gICAgICAgIHRoaXNcbiAgICAgIClcblxuICAgICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgndmlkZW9tYWlsJykucmVwbHkoXG4gICAgICAgICd2YWxpZGF0ZTptb2RlbERhdGEnLFxuICAgICAgICB0aGlzLnZhbGlkYXRlVmlkZW9tYWlsLFxuICAgICAgICB0aGlzXG4gICAgICApXG5cbiAgICAgIC8vIGNvbnRyb2wgc3VibWlzc2lvbiBwcm9ncmVzcyxcbiAgICAgIC8vIHNvIHRoYXQgd2UgY2FuIFBPU1QgdG8gdGhlIFZpZGVvbWFpbCBzZXJ2ZXIgZmlyc3RcbiAgICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2Zvcm0tJyArIHRoaXMuZ2V0Rm9ybUlkKCkpLnJlcGx5KFxuICAgICAgICAnbWF5YmU6c3VibWl0JyxcbiAgICAgICAgdGhpcy5tYXliZVN1Ym1pdCxcbiAgICAgICAgdGhpcyxcbiAgICAgICAgZmllbGRNb2RlbFxuICAgICAgKVxuICAgIH1cbiAgfSxcblxuICBsb2FkVmlkZW9tYWlsQ2xpZW50OiBmdW5jdGlvbiAoKSB7XG4gICAgdmFyIGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgPSB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdpbWFnZV9xdWFsaXR5JykgfHwgNDBcblxuICAgIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlID4gMTAwKSB7XG4gICAgICBpbWFnZVF1YWxpdHlQZXJjZW50YWdlID0gMTAwXG4gICAgfSBlbHNlIGlmIChpbWFnZVF1YWxpdHlQZXJjZW50YWdlIDwgMSkge1xuICAgICAgaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSA9IDFcbiAgICB9XG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudCA9IG5ldyBWaWRlb21haWxDbGllbnQoe1xuICAgICAgc2l0ZU5hbWU6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3NpdGVfbmFtZScpLFxuICAgICAgdmlkZW86IHtcbiAgICAgICAgbGltaXRTZWNvbmRzOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdsaW1pdF9zZWNvbmRzJykgfHwgOTAsXG4gICAgICAgIHdpZHRoOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCd3aWR0aCcpIHx8IDMyMCxcbiAgICAgICAgY291bnRkb3duOiB0aGlzLmZpZWxkTW9kZWwuZ2V0KCdjb3VudGRvd24nKSB8fCBmYWxzZVxuICAgICAgfSxcbiAgICAgIGF1ZGlvOiB7XG4gICAgICAgIGVuYWJsZWQ6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ2F1ZGlvX2VuYWJsZWQnKVxuICAgICAgfSxcbiAgICAgIGltYWdlOiB7XG4gICAgICAgIHF1YWxpdHk6IGltYWdlUXVhbGl0eVBlcmNlbnRhZ2UgLyAxMDAgLy8gbXVzdCBiZSBhIGZsb2F0XG4gICAgICB9LFxuICAgICAgc2VsZWN0b3JzOiB7XG4gICAgICAgIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiAnLnN1Ym1pdC13cmFwIGlucHV0J1xuICAgICAgfSxcbiAgICAgIGNhbGxiYWNrczoge1xuICAgICAgICAvLyB1Z2x5IG5hbWUgZWg/XG4gICAgICAgIGFkanVzdEZvcm1EYXRhQmVmb3JlUG9zdGluZzogdGhpcy5hZGp1c3RGb3JtRGF0YUJlZm9yZVBvc3RpbmdUb1ZpZGVvbWFpbFNlcnZlci5iaW5kKFxuICAgICAgICAgIHRoaXNcbiAgICAgICAgKVxuICAgICAgfSxcbiAgICAgIC8vIGxlYXZlIGl0IHRvIG5pbmphIGZvcm0gdG8gdmFsaWRhdGUgdGhlIGlucHV0c1xuICAgICAgZW5hYmxlQXV0b1ZhbGlkYXRpb246IGZhbHNlLFxuICAgICAgLy8gbGVhdmUgaXQgdG8gbmluamEgZm9ybSB0byBkZWFsIHdpdGggZm9ybSBzdWJtaXNzaW9uc1xuICAgICAgZW5hYmxlQXV0b1N1Ym1pc3Npb246IGZhbHNlLFxuICAgICAgLy8gbG9nIGFjdGlvbnMvZXZlbnRzIHRvIGNvbnNvbGVcbiAgICAgIHZlcmJvc2U6IHRoaXMuZmllbGRNb2RlbC5nZXQoJ3ZlcmJvc2UnKSB8fCBERUJVR1xuICAgIH0pXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5vbihcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LmV2ZW50cy5QUkVWSUVXLFxuICAgICAgdGhpcy5vblByZXZpZXcuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLlNVQk1JVFRFRCxcbiAgICAgIHRoaXMub25TdWJtaXR0ZWQuYmluZCh0aGlzKVxuICAgIClcblxuICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50Lm9uKFxuICAgICAgdGhpcy52aWRlb21haWxDbGllbnQuZXZlbnRzLkdPSU5HX0JBQ0ssXG4gICAgICB0aGlzLm9uR29pbmdCYWNrLmJpbmQodGhpcylcbiAgICApXG5cbiAgICB0aGlzLnZpZGVvbWFpbENsaWVudC5zaG93KClcbiAgfSxcblxuICAvLyBuZWVkZWQgdG8gZ2V0IHRoZSB2aWRlb21haWwga2V5IHdoaWNoIGlzIHJlcXVpcmVkIGJlZm9yZVxuICAvLyBzdWJtaXR0aW5nIHRvIHRoZSB2aWRlb21haWwgc2VydmVyXG4gIG9uUHJldmlldzogZnVuY3Rpb24gKGtleSkge1xuICAgIHRoaXMuZmllbGRNb2RlbC5zZXQoJ3ZpZGVvbWFpbC1rZXknLCBrZXkpXG4gICAgQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnZmllbGRzJylcbiAgICAgIC8vIGNsZWFycyBhbnkgcHJldmlvdXMgZXJyb3JzXG4gICAgICAucmVxdWVzdCgncmVtb3ZlOmVycm9yJywgdGhpcy5maWVsZE1vZGVsLmdldCgnaWQnKSwgJ3JlcXVpcmVkLWVycm9yJylcbiAgfSxcblxuICBvblN1Ym1pdHRlZDogZnVuY3Rpb24gKHZpZGVvbWFpbCkge1xuICAgIHZhciBmb3JtTW9kZWwgPSBuZlJhZGlvLmNoYW5uZWwoJ2FwcCcpLnJlcXVlc3QoJ2dldDpmb3JtJywgdGhpcy5nZXRGb3JtSWQoKSlcblxuICAgIC8vIHRvZG8gaXNuJ3QgJ2Zvcm0tJyArIGZvcm1Nb2RlbC5nZXQoJ2lkJykgdGhlIHNhbWUgYXMgdGhlIGZvcm1JRCBhbHJlYWR5P1xuICAgIG5mUmFkaW9cbiAgICAgIC5jaGFubmVsKCdmb3JtLScgKyBmb3JtTW9kZWwuZ2V0KCdpZCcpKVxuICAgICAgLnJlcXVlc3QoJ2FkZDpleHRyYScsICd2aWRlb21haWwnLCB2aWRlb21haWwpXG5cbiAgICAvLyByZXN0YXJ0IHN1Ym1pc3Npb24gYWdhaW4sIHRoaXMgdGltZSB0byB0aGUgcmVhbCB3cCBzaXRlXG4gICAgbmZSYWRpby5jaGFubmVsKCdmb3JtLScgKyB0aGlzLmdldEZvcm1JZCgpKS5yZXF1ZXN0KCdzdWJtaXQnLCBmb3JtTW9kZWwpXG4gIH0sXG5cbiAgb25Hb2luZ0JhY2s6IGZ1bmN0aW9uICgpIHtcbiAgICB0aGlzLmZpZWxkTW9kZWwuc2V0KCd2aWRlb21haWwta2V5JywgbnVsbClcbiAgICB0aGlzLmludmFsaWRhdGUoKVxuICB9LFxuXG4gIHZhbGlkYXRlUmVxdWlyZWQ6IGZ1bmN0aW9uIChlbCwgZmllbGRNb2RlbCkge1xuICAgIHZhciB2YWxpZCA9IHRoaXMudmFsaWRhdGVWaWRlb21haWwoZmllbGRNb2RlbClcblxuICAgIGlmICghdmFsaWQpIHtcbiAgICAgIHRoaXMuaW52YWxpZGF0ZSgpXG4gICAgfVxuXG4gICAgcmV0dXJuIHZhbGlkXG4gIH0sXG5cbiAgaW52YWxpZGF0ZTogZnVuY3Rpb24gKCkge1xuICAgIC8vIG92ZXJyaWRlIGRlZmF1bHQgYmVoYXZpb3VyIHNvIHRoYXQgd2UgY2FuIHNldCBvdXIgb3duIGVycm9yIHRleHQgaGVyZVxuICAgIEJhY2tib25lLlJhZGlvLmNoYW5uZWwoJ2ZpZWxkcycpLnJlcXVlc3QoXG4gICAgICAnYWRkOmVycm9yJyxcbiAgICAgIHRoaXMuZmllbGRNb2RlbC5nZXQoJ2lkJyksXG4gICAgICAncmVxdWlyZWQtZXJyb3InLFxuICAgICAgJ1JlY29yZCBhbmQgY2xpY2sgb24gc3RvcCB0byBzZWUgYSBwcmV2aWV3IHZpZGVvLidcbiAgICApXG4gIH0sXG5cbiAgdmFsaWRhdGVWaWRlb21haWw6IGZ1bmN0aW9uIChmaWVsZE1vZGVsKSB7XG4gICAgZmllbGRNb2RlbCA9IGZpZWxkTW9kZWwgfHwgdGhpcy5maWVsZE1vZGVsXG4gICAgcmV0dXJuIGZpZWxkTW9kZWwuZ2V0KCd2aWRlb21haWwta2V5JykgfHwgZmFsc2VcbiAgfSxcblxuICBoYXNFcnJvcnM6IGZ1bmN0aW9uIChmb3JtTW9kZWwpIHtcbiAgICByZXR1cm4gZm9ybU1vZGVsLmdldCgnZXJyb3JzJykubGVuZ3RoID4gMFxuICB9LFxuXG4gIG1heWJlU3VibWl0OiBmdW5jdGlvbiAoZm9ybU1vZGVsKSB7XG4gICAgdmFyIG1heWJlID0gdHJ1ZVxuICAgIHZhciB2aWRlb21haWxTdWJtaXR0ZWQgPSBmb3JtTW9kZWwuZ2V0RXh0cmEoJ3ZpZGVvbWFpbCcpXG4gICAgdmFyIHZpZGVvbWFpbFJlY29yZGVkID0gdGhpcy52YWxpZGF0ZVZpZGVvbWFpbCgpXG4gICAgdmFyIGVycm9ybmVvdXMgPSB0aGlzLmhhc0Vycm9ycyhmb3JtTW9kZWwpXG5cbiAgICAvLyBob2xkIG9uIHdpdGggZmluYWwgZm9ybSBzdWJtaXNzaW9uIHdoZW4gb25lIHdhcyByZWNvcmRlZFxuICAgIC8vIGJ1dCBoYXNuJ3QgYmVlbiBzdWJtaXR0ZWQgdG8gdGhlIHZpZGVvbWFpbCBzZXJ2ZXIgeWV0XG4gICAgaWYgKCF2aWRlb21haWxTdWJtaXR0ZWQgJiYgIWVycm9ybmVvdXMgJiYgdmlkZW9tYWlsUmVjb3JkZWQpIHtcbiAgICAgIHRoaXMudmlkZW9tYWlsQ2xpZW50LnN1Ym1pdCgpXG4gICAgICBtYXliZSA9IGZhbHNlXG4gICAgfVxuXG4gICAgcmV0dXJuIG1heWJlXG4gIH0sXG5cbiAgZ2V0TWVyZ2VUYWdWYWx1ZTogZnVuY3Rpb24gKGZpZWxkS2V5LCBmb3JtVmFsdWVzKSB7XG4gICAgdmFyIHZhbHVlID0gdGhpcy5maWVsZE1vZGVsLmdldChmaWVsZEtleSlcblxuICAgIC8vIGl0IGNhbiBoYXBwZW4gdGhhdCB0aGUgdXNlciBoYXMgY29uZmlndXJlZCBzb21ldGhpbmcgd3JvbmcsXG4gICAgLy8gaS5FLiBhbiBlbXB0eSBlbWFpbF9mcm9tLiBpbiB0aGF0IGNhc2UganVzdCBpZ25vcmUgLi4uXG4gICAgaWYgKHZhbHVlKSB7XG4gICAgICAvLyBhZG1pbiBlbWFpbCBsb2NhbGl6ZWQgZnJvbSBiYWNrZW5kLCBhIGJpdCB1Z2x5XG4gICAgICAvLyB0b2RvIGFzayBmb3IgYW4gZW5kcG9pbnQgdG8gcHJvY2VzcyB0aG9zZSBzcGVjaWFsIG1lcmdlIHRhZ3NcbiAgICAgIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9iaW5hcnlraXRjaGVuL3ZpZGVvbWFpbC1mb3ItbmluamEtZm9ybXMvaXNzdWVzLzMwXG4gICAgICBpZiAodmFsdWUgPT09ICd7d3A6YWRtaW5fZW1haWx9Jykge1xuICAgICAgICB2YWx1ZSA9IHdpbmRvdy5uZlZpZGVvbWFpbC5hZG1pbl9lbWFpbFxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdmFyIHJhd0ZpZWxkS2V5TWF0Y2hlcyA9IHZhbHVlLm1hdGNoKC97ZmllbGQ6KC4qKX0vaSlcbiAgICAgICAgdmFyIHJhd0ZpZWxkS2V5ID0gcmF3RmllbGRLZXlNYXRjaGVzICYmIHJhd0ZpZWxkS2V5TWF0Y2hlc1sxXVxuXG4gICAgICAgIGlmIChyYXdGaWVsZEtleSAhPT0gdmFsdWUpIHtcbiAgICAgICAgICAvLyB5ZXMgaXQgd2FzIGEgbWVyZ2UgdGFnLCBzbyB1c2UgaXRcbiAgICAgICAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL3tmaWVsZDooLiopfS9pLCBmb3JtVmFsdWVzW3Jhd0ZpZWxkS2V5XSlcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB2YWx1ZVxuICB9LFxuXG4gIGdldEZvcm1WYWx1ZXM6IGZ1bmN0aW9uICgpIHtcbiAgICB2YXIgZm9ybU1vZGVsID0gQmFja2JvbmUuUmFkaW8uY2hhbm5lbCgnYXBwJykucmVxdWVzdCgnZ2V0OmZvcm0nLCB0aGlzLmdldEZvcm1JZCgpKVxuICAgIHZhciBmaWVsZHNDb2xsZWN0aW9uID0gZm9ybU1vZGVsLmdldCgnZmllbGRzJylcblxuICAgIHJldHVybiBmaWVsZHNDb2xsZWN0aW9uLnJlZHVjZShmdW5jdGlvbiAobWVtbywgZmllbGQpIHtcbiAgICAgIG1lbW9bZmllbGQuZ2V0KCdrZXknKV0gPSBmaWVsZC5nZXQoJ3ZhbHVlJylcbiAgICAgIHJldHVybiBtZW1vXG4gICAgfSwge30pXG4gIH0sXG5cbiAgYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nVG9WaWRlb21haWxTZXJ2ZXI6IGZ1bmN0aW9uICh2aWRlb21haWwsIGNiKSB7XG4gICAgdmFyIGZvcm1WYWx1ZXMgPSB0aGlzLmdldEZvcm1WYWx1ZXMoKVxuXG4gICAgdmlkZW9tYWlsLmZyb20gPSB0aGlzLmdldE1lcmdlVGFnVmFsdWUoJ2VtYWlsX2Zyb20nLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC50byA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfdG8nLCBmb3JtVmFsdWVzKVxuICAgIHZpZGVvbWFpbC5zdWJqZWN0ID0gdGhpcy5nZXRNZXJnZVRhZ1ZhbHVlKCdlbWFpbF9zdWJqZWN0JywgZm9ybVZhbHVlcylcbiAgICB2aWRlb21haWwuYm9keSA9IHRoaXMuZ2V0TWVyZ2VUYWdWYWx1ZSgnZW1haWxfYm9keScsIGZvcm1WYWx1ZXMpXG5cbiAgICBjYihudWxsLCB2aWRlb21haWwpXG4gIH0sXG5cbiAgb25CZWZvcmVEZXN0cm95OiBmdW5jdGlvbiAoKSB7XG4gICAgdGhpcy52aWRlb21haWxDbGllbnQudW5sb2FkKClcbiAgICBkZWxldGUgdGhpcy52aWRlb21haWxDbGllbnRcbiAgfVxufSlcblxualF1ZXJ5KGRvY3VtZW50KS5yZWFkeShmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBuZXcgVmlkZW9tYWlsRmllbGRDb250cm9sbGVyKClcbn0pXG4iXSwibmFtZXMiOlsiREVCVUciLCJWaWRlb21haWxGaWVsZENvbnRyb2xsZXIiLCJNYXJpb25ldHRlIiwiT2JqZWN0IiwiZXh0ZW5kIiwidmlkZW9tYWlsQ2xpZW50IiwiZmllbGRNb2RlbCIsImluaXRpYWxpemUiLCJCYWNrYm9uZSIsIlJhZGlvIiwidGhpcyIsImxpc3RlblRvIiwiY2hhbm5lbCIsImV2ZW50TmFtZSIsImIiLCJjb25zb2xlIiwibG9nIiwicmVnaXN0ZXJWaWRlb21haWxGaWVsZCIsImdldEZvcm1JZCIsImdldCIsImxvYWRWaWRlb21haWxDbGllbnQiLCJyZXBseSIsInZhbGlkYXRlUmVxdWlyZWQiLCJ2YWxpZGF0ZVZpZGVvbWFpbCIsIm1heWJlU3VibWl0IiwiaW1hZ2VRdWFsaXR5UGVyY2VudGFnZSIsIlZpZGVvbWFpbENsaWVudCIsInNpdGVOYW1lIiwidmlkZW8iLCJsaW1pdFNlY29uZHMiLCJ3aWR0aCIsImNvdW50ZG93biIsImF1ZGlvIiwiZW5hYmxlZCIsImltYWdlIiwicXVhbGl0eSIsInNlbGVjdG9ycyIsInN1Ym1pdEJ1dHRvblNlbGVjdG9yIiwiY2FsbGJhY2tzIiwiYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nIiwiYWRqdXN0Rm9ybURhdGFCZWZvcmVQb3N0aW5nVG9WaWRlb21haWxTZXJ2ZXIiLCJiaW5kIiwiZW5hYmxlQXV0b1ZhbGlkYXRpb24iLCJlbmFibGVBdXRvU3VibWlzc2lvbiIsInZlcmJvc2UiLCJvbiIsImV2ZW50cyIsIlBSRVZJRVciLCJvblByZXZpZXciLCJTVUJNSVRURUQiLCJvblN1Ym1pdHRlZCIsIkdPSU5HX0JBQ0siLCJvbkdvaW5nQmFjayIsInNob3ciLCJrZXkiLCJzZXQiLCJyZXF1ZXN0IiwidmlkZW9tYWlsIiwiZm9ybU1vZGVsIiwibmZSYWRpbyIsImludmFsaWRhdGUiLCJlbCIsInZhbGlkIiwiaGFzRXJyb3JzIiwibGVuZ3RoIiwibWF5YmUiLCJ2aWRlb21haWxTdWJtaXR0ZWQiLCJnZXRFeHRyYSIsInZpZGVvbWFpbFJlY29yZGVkIiwiZXJyb3JuZW91cyIsInN1Ym1pdCIsImdldE1lcmdlVGFnVmFsdWUiLCJmaWVsZEtleSIsImZvcm1WYWx1ZXMiLCJ2YWx1ZSIsIndpbmRvdyIsIm5mVmlkZW9tYWlsIiwiYWRtaW5fZW1haWwiLCJyYXdGaWVsZEtleSIsInJhd0ZpZWxkS2V5TWF0Y2hlcyIsIm1hdGNoIiwicmVwbGFjZSIsImdldEZvcm1WYWx1ZXMiLCJyZWR1Y2UiLCJtZW1vIiwiZmllbGQiLCJjYiIsImZyb20iLCJ0byIsInN1YmplY3QiLCJib2R5Iiwib25CZWZvcmVEZXN0cm95IiwidW5sb2FkIiwialF1ZXJ5IiwiZG9jdW1lbnQiLCJyZWFkeSJdLCJtYXBwaW5ncyI6IkFBQ0EsSUFBSUEsT0FBUSxFQUtSQyx5QkFBMkJDLFdBQVdDLE9BQU9DLE9BQU8sQ0FDdERDLGdCQUFpQixLQUdqQkMsV0FBWSxLQUVaQyxXQUFZLFlBQ1ZDLFNBQVNDLE1BQU1ULE1BQVFBLFNBR3JCVSxLQUFLQyxTQUFTSCxTQUFTQyxNQUFNRyxRQUFRLGFBQWMsTUFBTyxTQUFVQyxFQUFXQyxHQUM3RUMsUUFBUUMsSUFBSSw2QkFBOEJILEVBQVdDLEtBR3ZESixLQUFLQyxTQUFTSCxTQUFTQyxNQUFNRyxRQUFRLFNBQVUsTUFBTyxTQUFVQyxFQUFXQyxHQUN6RUMsUUFBUUMsSUFBSSx5QkFBMEJILEVBQVdDLEtBR25ESixLQUFLQyxTQUFTSCxTQUFTQyxNQUFNRyxRQUFRLE9BQVEsTUFBTyxTQUFVQyxFQUFXQyxHQUN2RUMsUUFBUUMsSUFBSSx1QkFBd0JILEVBQVdDLEtBR2pESixLQUFLQyxTQUFTSCxTQUFTQyxNQUFNRyxRQUFRLFVBQVcsTUFBTyxTQUFVQyxFQUFXQyxHQUMxRUMsUUFBUUMsSUFBSSwwQkFBMkJILEVBQVdDLE1BSXRESixLQUFLQyxTQUNISCxTQUFTQyxNQUFNRyxRQUFRLGFBQ3ZCLGFBQ0FGLEtBQUtPLHlCQUlUQyxVQUFXLFdBQ1QsT0FBT1IsS0FBS0osV0FBV2EsSUFBSSxXQUc3QkYsdUJBQXdCLFNBQVVYLEdBRzNCSSxLQUFL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
